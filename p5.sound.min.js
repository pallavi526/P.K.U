/*! p5.sound.min.js v0.3.11 2019-03-14 */
;!function(a,b){"function"==typeof define&&define.amd?define("p5.sound",["p5"],function(c){b(c)}):b("object"==typeof exports?require("../p5"):a.p5)}(this,function(aT){var bc;bc=function(){!function(){function e(h){h&&(h.setTargetAtTime||(h.setTargetAtTime=h.setTargetValueAtTime))}window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")&&(window.AudioContext=window.webkitAudioContext,"function"!=typeof AudioContext.prototype.createGain&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),"function"!=typeof AudioContext.prototype.createDelay&&(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),"function"!=typeof AudioContext.prototype.createScriptProcessor&&(AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode),"function"!=typeof AudioContext.prototype.createPeriodicWave&&(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain,AudioContext.prototype.createGain=function(){var h=this.internal_createGain();return e(h.gain),h},AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay,AudioContext.prototype.createDelay=function(j){var h=j?this.internal_createDelay(j):this.internal_createDelay();return e(h.delayTime),h},AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource,AudioContext.prototype.createBufferSource=function(){var h=this.internal_createBufferSource();return h.start?(h.internal_start=h.start,h.start=function(k,j,l){"undefined"!=typeof l?h.internal_start(k||0,j,l):h.internal_start(k||0,j||0)}):h.start=function(k,l,j){l||j?this.noteGrainOn(k||0,l,j):this.noteOn(k||0)},h.stop?(h.internal_stop=h.stop,h.stop=function(i){h.internal_stop(i||0)}):h.stop=function(i){this.noteOff(i||0)},e(h.playbackRate),h},AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor,AudioContext.prototype.createDynamicsCompressor=function(){var h=this.internal_createDynamicsCompressor();return e(h.threshold),e(h.knee),e(h.ratio),e(h.reduction),e(h.attack),e(h.release),h},AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter,AudioContext.prototype.createBiquadFilter=function(){var h=this.internal_createBiquadFilter();return e(h.frequency),e(h.detune),e(h.Q),e(h.gain),h},"function"!=typeof AudioContext.prototype.createOscillator&&(AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator,AudioContext.prototype.createOscillator=function(){var h=this.internal_createOscillator();return h.start?(h.internal_start=h.start,h.start=function(i){h.internal_start(i||0)}):h.start=function(i){this.noteOn(i||0)},h.stop?(h.internal_stop=h.stop,h.stop=function(i){h.internal_stop(i||0)}):h.stop=function(i){this.noteOff(i||0)},h.setPeriodicWave||(h.setPeriodicWave=h.setWaveTable),e(h.frequency),e(h.detune),h})),window.hasOwnProperty("webkitOfflineAudioContext")&&!window.hasOwnProperty("OfflineAudioContext")&&(window.OfflineAudioContext=window.webkitOfflineAudioContext)}(window),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var d=document.createElement("audio");aT.prototype.isSupported=function(){return !!d.canPlayType};var a=function(){return !!d.canPlayType&&d.canPlayType('audio/ogg; codecs="vorbis"')},g=function(){return !!d.canPlayType&&d.canPlayType("audio/mpeg;")},f=function(){return !!d.canPlayType&&d.canPlayType('audio/wav; codecs="1"')},c=function(){return !!d.canPlayType&&(d.canPlayType("audio/x-m4a;")||d.canPlayType("audio/aac;"))},b=function(){return !!d.canPlayType&&d.canPlayType("audio/x-aiff;")};aT.prototype.isFileSupported=function(e){switch(e.toLowerCase()){case"mp3":return g();case"wav":return f();case"ogg":return a();case"aac":case"m4a":case"mp4":return c();case"aif":case"aiff":return b();default:return !1}}}();var a7;!function(a,b){a7=function(){return b()}()}(this,function(){function b(j){var k=j.createBuffer(1,1,j.sampleRate),h=j.createBufferSource();h.buffer=k,h.connect(j.destination),h.start(0),j.resume&&j.resume()}function d(e){return"running"===e.state}function a(h,e){function j(){d(h)?e():(requestAnimationFrame(j),h.resume&&h.resume())}d(h)?e():j()}function g(j,l,h){if(Array.isArray(j)||NodeList&&j instanceof NodeList){for(var m=0;m<j.length;m++){g(j[m],l,h)}}else{if("string"==typeof j){g(document.querySelectorAll(j),l,h)}else{if(j.jquery&&"function"==typeof j.toArray){g(j.toArray(),l,h)}else{if(Element&&j instanceof Element){var k=new c(j,h);l.push(k)}}}}}function f(h,k,l){var j=new Promise(function(m){a(h,m)}),i=[];return k||(k=document.body),g(k,i,h),j.then(function(){for(var e=0;e<i.length;e++){i[e].dispose()}i=null,l&&l()}),j}var c=function(h,i){this._dragged=!1,this._element=h,this._bindedMove=this._moved.bind(this),this._bindedEnd=this._ended.bind(this,i),h.addEventListener("touchstart",this._bindedEnd),h.addEventListener("touchmove",this._bindedMove),h.addEventListener("touchend",this._bindedEnd),h.addEventListener("mouseup",this._bindedEnd)};return c.prototype._moved=function(e){this._dragged=!0},c.prototype._ended=function(h){this._dragged||b(h),this._dragged=!1},c.prototype.dispose=function(){this._element.removeEventListener("touchstart",this._bindedEnd),this._element.removeEventListener("touchmove",this._bindedMove),this._element.removeEventListener("touchend",this._bindedEnd),this._element.removeEventListener("mouseup",this._bindedEnd),this._bindedMove=null,this._bindedEnd=null,this._element=null},f});var a1;a1=function(){var a=function(c,d){this.isUndef(c)||1===c?this.input=this.context.createGain():c>1&&(this.input=new Array(c)),this.isUndef(d)||1===d?this.output=this.context.createGain():d>1&&(this.output=new Array(c))};a.prototype.set=function(k,j,h){if(this.isObject(k)){h=j}else{if(this.isString(k)){var g={};g[k]=j,k=g}}a:for(var d in k){j=k[d];var t=this;if(-1!==d.indexOf(".")){for(var m=d.split("."),q=0;q<m.length-1;q++){if(t=t[m[q]],t instanceof a){m.splice(0,q+1);var l=m.join(".");t.set(l,j);continue a}}d=m[m.length-1]}var f=t[d];this.isUndef(f)||(a.Signal&&f instanceof a.Signal||a.Param&&f instanceof a.Param?f.value!==j&&(this.isUndef(h)?f.value=j:f.rampTo(j,h)):f instanceof AudioParam?f.value!==j&&(f.value=j):f instanceof a?f.set(j):f!==j&&(t[d]=j))}return this},a.prototype.get=function(k){this.isUndef(k)?k=this._collectDefaults(this.constructor):this.isString(k)&&(k=[k]);for(var j={},h=0;h<k.length;h++){var g=k[h],d=this,t=j;if(-1!==g.indexOf(".")){for(var m=g.split("."),q=0;q<m.length-1;q++){var l=m[q];t[l]=t[l]||{},t=t[l],d=d[l]}g=m[m.length-1]}var f=d[g];this.isObject(k[g])?t[g]=f.get():a.Signal&&f instanceof a.Signal?t[g]=f.value:a.Param&&f instanceof a.Param?t[g]=f.value:f instanceof AudioParam?t[g]=f.value:f instanceof a?t[g]=f.get():this.isFunction(f)||this.isUndef(f)||(t[g]=f)}return j},a.prototype._collectDefaults=function(d){var f=[];if(this.isUndef(d.defaults)||(f=Object.keys(d.defaults)),!this.isUndef(d._super)){for(var c=this._collectDefaults(d._super),g=0;g<c.length;g++){-1===f.indexOf(c[g])&&f.push(c[g])}}return f},a.prototype.toString=function(){for(var d in a){var c=d[0].match(/^[A-Z]$/),f=a[d]===this.constructor;if(this.isFunction(a[d])&&c&&f){return d}}return"Tone"},Object.defineProperty(a.prototype,"numberOfInputs",{get:function(){return this.input?this.isArray(this.input)?this.input.length:1:0}}),Object.defineProperty(a.prototype,"numberOfOutputs",{get:function(){return this.output?this.isArray(this.output)?this.output.length:1:0}}),a.prototype.dispose=function(){return this.isUndef(this.input)||(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),this.isUndef(this.output)||(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this},a.prototype.connect=function(d,f,c){return Array.isArray(this.output)?(f=this.defaultArg(f,0),this.output[f].connect(d,0,c)):this.output.connect(d,f,c),this},a.prototype.disconnect=function(d,f,c){this.isArray(this.output)?this.isNumber(d)?this.output[d].disconnect():(f=this.defaultArg(f,0),this.output[f].disconnect(d,0,c)):this.output.disconnect.apply(this.output,arguments)},a.prototype.connectSeries=function(){if(arguments.length>1){for(var d=arguments[0],f=1;f<arguments.length;f++){var c=arguments[f];d.connect(c),d=c}}return this},a.prototype.chain=function(){if(arguments.length>0){for(var d=this,f=0;f<arguments.length;f++){var c=arguments[f];d.connect(c),d=c}}return this},a.prototype.fan=function(){if(arguments.length>0){for(var c=0;c<arguments.length;c++){this.connect(arguments[c])}}return this},AudioNode.prototype.chain=a.prototype.chain,AudioNode.prototype.fan=a.prototype.fan,a.prototype.defaultArg=function(d,f){if(this.isObject(d)&&this.isObject(f)){var c={};for(var h in d){c[h]=this.defaultArg(f[h],d[h])}for(var g in f){c[g]=this.defaultArg(d[g],f[g])}return c}return this.isUndef(d)?f:d},a.prototype.optionsObject=function(d,f,c){var h={};if(1===d.length&&this.isObject(d[0])){h=d[0]}else{for(var g=0;g<f.length;g++){h[f[g]]=d[g]}}return this.isUndef(c)?h:this.defaultArg(h,c)},a.prototype.isUndef=function(c){return"undefined"==typeof c},a.prototype.isFunction=function(c){return"function"==typeof c},a.prototype.isNumber=function(c){return"number"==typeof c},a.prototype.isObject=function(c){return"[object Object]"===Object.prototype.toString.call(c)&&c.constructor===Object},a.prototype.isBoolean=function(c){return"boolean"==typeof c},a.prototype.isArray=function(c){return Array.isArray(c)},a.prototype.isString=function(c){return"string"==typeof c},a.noOp=function(){},a.prototype._readOnly=function(c){if(Array.isArray(c)){for(var d=0;d<c.length;d++){this._readOnly(c[d])}}else{Object.defineProperty(this,c,{writable:!1,enumerable:!0})}},a.prototype._writable=function(c){if(Array.isArray(c)){for(var d=0;d<c.length;d++){this._writable(c[d])}}else{Object.defineProperty(this,c,{writable:!0})}},a.State={Started:"started",Stopped:"stopped",Paused:"paused"},a.prototype.equalPowerScale=function(c){var d=0.5*Math.PI;return Math.sin(c*d)},a.prototype.dbToGain=function(c){return Math.pow(2,c/6)},a.prototype.gainToDb=function(c){return 20*(Math.log(c)/Math.LN10)},a.prototype.intervalToFrequencyRatio=function(c){return Math.pow(2,c/12)},a.prototype.now=function(){return a.context.now()},a.now=function(){return a.context.now()},a.extend=function(d,c){function f(){}a.prototype.isUndef(c)&&(c=a),f.prototype=c.prototype,d.prototype=new f,d.prototype.constructor=d,d._super=c};var b;return Object.defineProperty(a,"context",{get:function(){return b},set:function(c){b=a.Context&&c instanceof a.Context?c:new a.Context(c),a.Context&&a.Context.emit("init",b)}}),Object.defineProperty(a.prototype,"context",{get:function(){return a.context}}),a.setContext=function(c){a.context=c},Object.defineProperty(a.prototype,"blockTime",{get:function(){return 128/this.context.sampleRate}}),Object.defineProperty(a.prototype,"sampleTime",{get:function(){return 1/this.context.sampleRate}}),Object.defineProperty(a,"supported",{get:function(){var d=window.hasOwnProperty("AudioContext")||window.hasOwnProperty("webkitAudioContext"),f=window.hasOwnProperty("Promise"),c=window.hasOwnProperty("Worker");return d&&f&&c}}),a.version="r10",!window.TONE_SILENCE_VERSION_LOGGING,a}();var aZ;aZ=function(a){return a.Emitter=function(){this._events={}},a.extend(a.Emitter),a.Emitter.prototype.on=function(c,d){for(var b=c.split(/\W+/),g=0;g<b.length;g++){var f=b[g];this._events.hasOwnProperty(f)||(this._events[f]=[]),this._events[f].push(d)}return this},a.Emitter.prototype.off=function(f,b){for(var h=f.split(/\W+/),g=0;g<h.length;g++){if(f=h[g],this._events.hasOwnProperty(f)){if(a.prototype.isUndef(b)){this._events[f]=[]}else{for(var d=this._events[f],c=0;c<d.length;c++){d[c]===b&&d.splice(c,1)}}}}return this},a.Emitter.prototype.emit=function(c){if(this._events){var d=Array.apply(null,arguments).slice(1);if(this._events.hasOwnProperty(c)){for(var b=this._events[c],g=0,f=b.length;f>g;g++){b[g].apply(this,d)}}}return this},a.Emitter.mixin=function(d){var b=["on","off","emit"];d._events={};for(var g=0;g<b.length;g++){var f=b[g],c=a.Emitter.prototype[f];d[f]=c}},a.Emitter.prototype.dispose=function(){return a.prototype.dispose.call(this),this._events=null,this},a.Emitter}(a1);var aV;aV=function(a){function b(){function d(k,h,l){if(k.input){Array.isArray(k.input)?(a.prototype.isUndef(l)&&(l=0),this.connect(k.input[l])):this.connect(k.input,h,l)}else{try{k instanceof AudioNode?g.call(this,k,h,l):g.call(this,k,h)}catch(j){throw new Error("error connecting to node: "+k+"\n"+j)}}}function c(k,h,l){if(k&&k.input&&Array.isArray(k.input)){a.prototype.isUndef(l)&&(l=0),this.disconnect(k.input[l],h,l)}else{if(k&&k.input){this.disconnect(k.input,h,l)}else{try{f.apply(this,arguments)}catch(j){throw new Error("error disconnecting node: "+k+"\n"+j)}}}}var g=AudioNode.prototype.connect,f=AudioNode.prototype.disconnect;AudioNode.prototype.connect!==d&&(AudioNode.prototype.connect=d,AudioNode.prototype.disconnect=c)}return !window.hasOwnProperty("AudioContext")&&window.hasOwnProperty("webkitAudioContext")&&(window.AudioContext=window.webkitAudioContext),a.Context=function(d){a.Emitter.call(this),d||(d=new window.AudioContext),this._context=d;for(var c in this._context){this._defineProperty(this._context,c)}this._latencyHint="interactive",this._lookAhead=0.1,this._updateInterval=this._lookAhead/3,this._computedUpdateInterval=0,this._worker=this._createWorker(),this._constants={}},a.extend(a.Context,a.Emitter),a.Emitter.mixin(a.Context),a.Context.prototype._defineProperty=function(c,d){this.isUndef(this[d])&&Object.defineProperty(this,d,{get:function(){return"function"==typeof c[d]?c[d].bind(c):c[d]},set:function(e){c[d]=e}})},a.Context.prototype.now=function(){return this._context.currentTime},a.Context.prototype._createWorker=function(){window.URL=window.URL||window.webkitURL;var d=new Blob(["var timeoutTime = "+(1000*this._updateInterval).toFixed(1)+";self.onmessage = function(msg){	timeoutTime = parseInt(msg.data);};function tick(){	setTimeout(tick, timeoutTime);	self.postMessage('tick');}tick();"]),f=URL.createObjectURL(d),c=new Worker(f);return c.addEventListener("message",function(){this.emit("tick")}.bind(this)),c.addEventListener("message",function(){var g=this.now();if(this.isNumber(this._lastUpdate)){var h=g-this._lastUpdate;this._computedUpdateInterval=Math.max(h,0.97*this._computedUpdateInterval)}this._lastUpdate=g}.bind(this)),c},a.Context.prototype.getConstant=function(d){if(this._constants[d]){return this._constants[d]}for(var f=this._context.createBuffer(1,128,this._context.sampleRate),c=f.getChannelData(0),h=0;h<c.length;h++){c[h]=d}var g=this._context.createBufferSource();return g.channelCount=1,g.channelCountMode="explicit",g.buffer=f,g.loop=!0,g.start(0),this._constants[d]=g,g},Object.defineProperty(a.Context.prototype,"lag",{get:function(){var c=this._computedUpdateInterval-this._updateInterval;return c=Math.max(c,0)}}),Object.defineProperty(a.Context.prototype,"lookAhead",{get:function(){return this._lookAhead},set:function(c){this._lookAhead=c}}),Object.defineProperty(a.Context.prototype,"updateInterval",{get:function(){return this._updateInterval},set:function(c){this._updateInterval=Math.max(c,a.prototype.blockTime),this._worker.postMessage(Math.max(1000*c,1))}}),Object.defineProperty(a.Context.prototype,"latencyHint",{get:function(){return this._latencyHint},set:function(c){var d=c;if(this._latencyHint=c,this.isString(c)){switch(c){case"interactive":d=0.1,this._context.latencyHint=c;break;case"playback":d=0.8,this._context.latencyHint=c;break;case"balanced":d=0.25,this._context.latencyHint=c;break;case"fastest":d=0.01}}this.lookAhead=d,this.updateInterval=d/3}}),a.supported?(b(),a.context=new a.Context):console.warn("This browser does not support Tone.js"),a.Context}(a1);var aU;aU=function(b,a,d){const c=new window.AudioContext;return d.context.dispose(),d.setContext(c),aT.prototype.getAudioContext=function(){return c},aT.prototype.userStartAudio=function(e,g){var f=e;return e instanceof aT.Element?f=e.elt:e instanceof Array&&e[0] instanceof aT.Element&&(f=e.map(function(h){return h.elt})),b(c,f,g)},c}(a7,aV,a1);var bg;bg=function(b){var a=function(){this.input=b.createGain(),this.output=b.createGain(),this.limiter=b.createDynamicsCompressor(),this.limiter.threshold.value=-3,this.limiter.ratio.value=20,this.limiter.knee.value=1,this.audiocontext=b,this.output.disconnect(),this.input.connect(this.limiter),this.limiter.connect(this.output),this.meter=b.createGain(),this.fftMeter=b.createGain(),this.output.connect(this.meter),this.output.connect(this.fftMeter),this.output.connect(this.audiocontext.destination),this.soundArray=[],this.parts=[],this.extensions=[]},c=new a;return aT.prototype.getMasterVolume=function(){return c.output.gain.value},aT.prototype.masterVolume=function(f,h,d){if("number"==typeof f){var h=h||0,d=d||0,j=c.audiocontext.currentTime,g=c.output.gain.value;c.output.gain.cancelScheduledValues(j+d),c.output.gain.linearRampToValueAtTime(g,j+d),c.output.gain.linearRampToValueAtTime(f,j+d+h)}else{if(!f){return c.output.gain}f.connect(c.output.gain)}},aT.prototype.soundOut=aT.soundOut=c,aT.soundOut._silentNode=c.audiocontext.createGain(),aT.soundOut._silentNode.gain.value=0,aT.soundOut._silentNode.connect(c.audiocontext.destination),c}(aU);var aS;aS=function(){function d(w){var n,i;n=w.getChannelData(0),i=w.numberOfChannels>1?w.getChannelData(1):n;var x=a(n,i),q=new window.ArrayBuffer(44+2*x.length),v=new window.DataView(q);g(v,0,"RIFF"),v.setUint32(4,36+2*x.length,!0),g(v,8,"WAVE"),g(v,12,"fmt "),v.setUint32(16,16,!0),v.setUint16(20,1,!0),v.setUint16(22,2,!0),v.setUint32(24,f.audiocontext.sampleRate,!0),v.setUint32(28,4*f.audiocontext.sampleRate,!0),v.setUint16(32,4,!0),v.setUint16(34,16,!0),g(v,36,"data"),v.setUint32(40,2*x.length,!0);for(var o=x.length,j=44,m=1,k=0;o>k;k++){v.setInt16(j,x[k]*(32767*m),!0),j+=2}return v}function a(j,l){for(var h=j.length+l.length,p=new Float32Array(h),m=0,k=0;h>k;){p[k++]=j[m],p[k++]=l[m],m++}return p}function g(j,k,h){for(var m=h.length,l=0;m>l;l++){j.setUint8(k+l,h.charCodeAt(l))}}var f=bg;aT.prototype.sampleRate=function(){return f.audiocontext.sampleRate},aT.prototype.freqToMidi=function(j){var k=Math.log(j/440)/Math.log(2),h=Math.round(12*k)+69;return h};var c=aT.prototype.midiToFreq=function(e){return 440*Math.pow(2,(e-69)/12)},b=function(j){if("string"!=typeof j){return j}var k={A:21,B:23,C:24,D:26,E:28,F:29,G:31},h=k[j[0].toUpperCase()],l=~~j.slice(-1);switch(h+=12*(l-1),j[1]){case"#":h+=1;break;case"b":h-=1}return c(h)};return aT.prototype.soundFormats=function(){f.extensions=[];for(var e=0;e<arguments.length;e++){if(arguments[e]=arguments[e].toLowerCase(),!(["mp3","wav","ogg","m4a","aac"].indexOf(arguments[e])>-1)){throw arguments[e]+" is not a valid sound format!"}f.extensions.push(arguments[e])}},aT.prototype.disposeSound=function(){for(var e=0;e<f.soundArray.length;e++){f.soundArray[e].dispose()}},aT.prototype.registerMethod("remove",aT.prototype.disposeSound),aT.prototype._checkFileFormats=function(m){var l;if("string"==typeof m){l=m;var k=l.split(".").pop();if(["mp3","wav","ogg","m4a","aac"].indexOf(k)>-1){if(aT.prototype.isFileSupported(k)){l=l}else{for(var h=l.split("."),v=h[h.length-1],q=0;q<f.extensions.length;q++){var t=f.extensions[q],o=aT.prototype.isFileSupported(t);if(o){v="",2===h.length&&(v+=h[0]);for(var q=1;q<=h.length-2;q++){var j=h[q];v+="."+j}l=v+=".",l=l+=t;break}}}}else{for(var q=0;q<f.extensions.length;q++){var t=f.extensions[q],o=aT.prototype.isFileSupported(t);if(o){l=l+"."+t;break}}}}else{if("object"==typeof m){for(var q=0;q<m.length;q++){var t=m[q].split(".").pop(),o=aT.prototype.isFileSupported(t);if(o){l=m[q];break}}}}return l},aT.prototype._mathChain=function(j,l,h,p,m){for(var k in j.mathOps){j.mathOps[k] instanceof m&&(j.mathOps[k].dispose(),h=k,h<j.mathOps.length-1&&(p=j.mathOps[k+1]))}return j.mathOps[h-1].disconnect(),j.mathOps[h-1].connect(l),l.connect(p),j.mathOps[h]=l,j},{convertToWav:d,midiToFreq:c,noteToFreq:b}}(bg);var be;be=function(){var a=function(c,f,b){var h,g,d=new Error;d.name=c,d.originalStack=d.stack+f,h=d.stack+f,d.failedPath=b;var g=h.split("\n");return g=g.filter(function(e){return !e.match(/(p5.|native code|globalInit)/g)}),d.stack=g.join("\n"),d};return a}();var aY;aY=function(){var b=bg,a=b.audiocontext;"undefined"!=typeof a.createStereoPanner?(aT.Panner=function(c,d){this.stereoPanner=this.input=a.createStereoPanner(),c.connect(this.stereoPanner),this.stereoPanner.connect(d)},aT.Panner.prototype.pan=function(c,d){var g=d||0,f=a.currentTime+g;this.stereoPanner.pan.linearRampToValueAtTime(c,f)},aT.Panner.prototype.inputChannels=function(){},aT.Panner.prototype.connect=function(c){this.stereoPanner.connect(c)},aT.Panner.prototype.disconnect=function(){this.stereoPanner&&this.stereoPanner.disconnect()}):(aT.Panner=function(c,d,f){this.input=a.createGain(),c.connect(this.input),this.left=a.createGain(),this.right=a.createGain(),this.left.channelInterpretation="discrete",this.right.channelInterpretation="discrete",f>1?(this.splitter=a.createChannelSplitter(2),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0)):(this.input.connect(this.left),this.input.connect(this.right)),this.output=a.createChannelMerger(2),this.left.connect(this.output,0,1),this.right.connect(this.output,0,0),this.output.connect(d)},aT.Panner.prototype.pan=function(d,h){var j=h||0,i=a.currentTime+j,g=(d+1)/2,f=Math.cos(g*Math.PI/2),c=Math.sin(g*Math.PI/2);this.left.gain.linearRampToValueAtTime(c,i),this.right.gain.linearRampToValueAtTime(f,i)},aT.Panner.prototype.inputChannels=function(c){1===c?(this.input.disconnect(),this.input.connect(this.left),this.input.connect(this.right)):2===c&&(this.splitter=a.createChannelSplitter(2),this.input.disconnect(),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0))},aT.Panner.prototype.connect=function(c){this.output.connect(c)},aT.Panner.prototype.disconnect=function(){this.output&&this.output.disconnect()})}(bg);var a8;a8=function(){function z(f,l){for(var d={},p=f.length,m=0;p>m;m++){if(f[m]>l){var h=f[m],g=new C(h,m);d[m]=g,m+=6000}m++}return d}function t(F){for(var m=[],l=Object.keys(F).sort(),h=0;h<l.length;h++){for(var g=0;10>g;g++){var d=F[l[h]],G=F[l[h+g]];if(d&&G){var y=d.sampleIndex,E=G.sampleIndex,v=E-y;v>0&&d.intervals.push(v);var f=m.some(function(e){return e.interval===v?(e.count++,e):void 0});f||m.push({interval:v,count:1})}}}return m}function j(f,g){var d=[];return f.forEach(function(e){try{var l=Math.abs(60/(e.interval/g));l=a(l);var i=d.some(function(m){return m.tempo===l?m.count+=e.count:void 0});if(!i){if(isNaN(l)){return}d.push({tempo:Math.round(l),count:e.count})}}catch(h){throw h}}),d}function c(F,r,l,g){for(var f=[],G=Object.keys(F).sort(),y=0;y<G.length;y++){for(var E=G[y],v=F[E],d=0;d<v.intervals.length;d++){var m=Math.round(Math.abs(60/(v.intervals[d]/l)));m=a(m),Math.abs(m-r)<g&&f.push(v.sampleIndex/l)}}return f=f.filter(function(o,p,h){var s=h[p+1]-o;return s>0.01?!0:void 0})}function a(d){if(isFinite(d)&&0!==d){for(;90>d;){d*=2}for(;d>180&&d>90;){d/=2}return d}}function D(d){var f=d.inputBuffer.getChannelData(0);this._lastPos=f[f.length-1]||0,this._onTimeUpdate(self._lastPos)}function b(f){const g=f.target,d=this;g._playing=!1,g.removeEventListener("ended",d._clearOnEnd),d._onended(d),d.bufferSourceNodes.forEach(function(h,i){h._playing===!1&&d.bufferSourceNodes.splice(i)}),0===d.bufferSourceNodes.length&&(d._playing=!1)}var u=be,q=bg,x=q.audiocontext,A=aS.midiToFreq,k=aS.convertToWav;aT.SoundFile=function(g,d,l,h){if("undefined"!=typeof g){if("string"==typeof g||"string"==typeof g[0]){var f=aT.prototype._checkFileFormats(g);this.url=f}else{if("object"==typeof g&&!(window.File&&window.FileReader&&window.FileList&&window.Blob)){throw"Unable to load file because the File API is not supported"}}g.file&&(g=g.file),this.file=g}this._onended=function(){},this._looping=!1,this._playing=!1,this._paused=!1,this._pauseTime=0,this._cues=[],this._cueIDCounter=0,this._lastPos=0,this._counterNode=null,this._scopeNode=null,this.bufferSourceNodes=[],this.bufferSourceNode=null,this.buffer=null,this.playbackRate=1,this.input=q.audiocontext.createGain(),this.output=q.audiocontext.createGain(),this.reversed=!1,this.startTime=0,this.endTime=null,this.pauseTime=0,this.mode="sustain",this.startMillis=null,this.panPosition=0,this.panner=new aT.Panner(this.output,q.input,2),(this.url||this.file)&&this.load(d,l),q.soundArray.push(this),"function"==typeof h?this._whileLoading=h:this._whileLoading=function(){},this._onAudioProcess=D.bind(this),this._clearOnEnd=b.bind(this)},aT.prototype.registerPreloadMethod("loadSound",aT.prototype),aT.prototype.loadSound=function(h,d,m,l){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&window.alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var g=this,f=new aT.SoundFile(h,function(){"function"==typeof d&&d.apply(g,arguments),"function"==typeof g._decrementPreload&&g._decrementPreload()},m,l);return f},aT.SoundFile.prototype.load=function(f,h){var d=this,m=(new Error).stack;if(void 0!==this.url&&""!==this.url){var l=new XMLHttpRequest;l.addEventListener("progress",function(e){d._updateProgress(e)},!1),l.open("GET",this.url,!0),l.responseType="arraybuffer",l.onload=function(){if(200===l.status){if(!d.panner){return}x.decodeAudioData(l.response,function(n){d.panner&&(d.buffer=n,d.panner.inputChannels(n.numberOfChannels),f&&f(d))},function(){if(d.panner){var n=new u("decodeAudioData",m,d.url),p="AudioContext error at decodeAudioData for "+d.url;h?(n.msg=p,h(n)):console.error(p+"\n The error stack trace includes: \n"+n.stack)}})}else{if(!d.panner){return}var i=new u("loadSound",m,d.url),e="Unable to load "+d.url+". The request status was: "+l.status+" ("+l.statusText+")";h?(i.message=e,h(i)):console.error(e+"\n The error stack trace includes: \n"+i.stack)}},l.onerror=function(){var e=new u("loadSound",m,d.url),i="There was no response from the server at "+d.url+". Check the url and internet connectivity.";h?(e.message=i,h(e)):console.error(i+"\n The error stack trace includes: \n"+e.stack)},l.send()}else{if(void 0!==this.file){var g=new FileReader;g.onload=function(){d.panner&&x.decodeAudioData(g.result,function(i){d.panner&&(d.buffer=i,d.panner.inputChannels(i.numberOfChannels),f&&f(d))})},g.onerror=function(e){d.panner&&onerror&&onerror(e)},g.readAsArrayBuffer(this.file)}}},aT.SoundFile.prototype._updateProgress=function(d){if(d.lengthComputable){var f=d.loaded/d.total*0.99;this._whileLoading(f,d)}else{this._whileLoading("size unknown")}},aT.SoundFile.prototype.isLoaded=function(){return this.buffer?!0:!1},aT.SoundFile.prototype.play=function(v,l,h,g,f){if(!this.output){return void console.warn("SoundFile.play() called after dispose")}var d,y,m=q.audiocontext.currentTime,p=v||0;if(0>p&&(p=0),p+=m,"undefined"!=typeof l&&this.rate(l),"undefined"!=typeof h&&this.setVolume(h),!this.buffer){throw"not ready to play file, buffer has yet to load. Try preload()"}if(this._pauseTime=0,"restart"===this.mode&&this.buffer&&this.bufferSourceNode&&(this.bufferSourceNode.stop(p),this._counterNode.stop(p)),"untildone"!==this.mode||!this.isPlaying()){if(this.bufferSourceNode=this._initSourceNode(),delete this._counterNode,this._counterNode=this._initCounterNode(),g){if(!(g>=0&&g<this.buffer.duration)){throw"start time out of range"}d=g}else{d=0}f&&(f=f<=this.buffer.duration-d?f:this.buffer.duration),this._paused?(this.bufferSourceNode.start(p,this.pauseTime,f),this._counterNode.start(p,this.pauseTime,f)):(this.bufferSourceNode.start(p,d,f),this._counterNode.start(p,d,f)),this._playing=!0,this._paused=!1,this.bufferSourceNodes.push(this.bufferSourceNode),this.bufferSourceNode._arrayIndex=this.bufferSourceNodes.length-1,this.bufferSourceNode.addEventListener("ended",this._clearOnEnd),this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping,this._looping===!0&&(y=f?f:d-1e-15,this.bufferSourceNode.loopStart=d,this.bufferSourceNode.loopEnd=y,this._counterNode.loopStart=d,this._counterNode.loopEnd=y)}},aT.SoundFile.prototype.playMode=function(f){var g=f.toLowerCase();if("restart"===g&&this.buffer&&this.bufferSourceNode){for(var d=0;d<this.bufferSourceNodes.length-1;d++){var h=q.audiocontext.currentTime;this.bufferSourceNodes[d].stop(h)}}if("restart"!==g&&"sustain"!==g&&"untildone"!==g){throw'Invalid play mode. Must be either "restart" or "sustain"'}this.mode=g},aT.SoundFile.prototype.pause=function(f){var g=q.audiocontext.currentTime,d=f||0,h=d+g;this.isPlaying()&&this.buffer&&this.bufferSourceNode?(this.pauseTime=this.currentTime(),this.bufferSourceNode.stop(h),this._counterNode.stop(h),this._paused=!0,this._playing=!1,this._pauseTime=this.currentTime()):this._pauseTime=0},aT.SoundFile.prototype.loop=function(f,g,d,l,h){this._looping=!0,this.play(f,g,d,l,h)},aT.SoundFile.prototype.setLoop=function(d){if(d===!0){this._looping=!0}else{if(d!==!1){throw"Error: setLoop accepts either true or false"}this._looping=!1}this.bufferSourceNode&&(this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping)},aT.SoundFile.prototype.isLooping=function(){return this.bufferSourceNode&&this._looping===!0&&this.isPlaying()===!0?!0:!1},aT.SoundFile.prototype.isPlaying=function(){return this._playing},aT.SoundFile.prototype.isPaused=function(){return this._paused},aT.SoundFile.prototype.stop=function(f){var g=f||0;if("sustain"===this.mode||"untildone"===this.mode){this.stopAll(g),this._playing=!1,this.pauseTime=0,this._paused=!1}else{if(this.buffer&&this.bufferSourceNode){var d=q.audiocontext.currentTime,h=g||0;this.pauseTime=0,this.bufferSourceNode.stop(d+h),this._counterNode.stop(d+h),this._playing=!1,this._paused=!1}}},aT.SoundFile.prototype.stopAll=function(f){var h=q.audiocontext.currentTime,d=f||0;if(this.buffer&&this.bufferSourceNode){for(var m in this.bufferSourceNodes){const l=this.bufferSourceNodes[m];if(l){try{l.stop(h+d)}catch(g){}}}this._counterNode.stop(h+d),this._onended(this)}},aT.SoundFile.prototype.setVolume=function(f,l,d){if("number"==typeof f){var p=l||0,m=d||0,h=q.audiocontext.currentTime,g=this.output.gain.value;this.output.gain.cancelScheduledValues(h+m),this.output.gain.linearRampToValueAtTime(g,h+m),this.output.gain.linearRampToValueAtTime(f,h+m+p)}else{if(!f){return this.output.gain}f.connect(this.output.gain)}},aT.SoundFile.prototype.amp=aT.SoundFile.prototype.setVolume,aT.SoundFile.prototype.fade=aT.SoundFile.prototype.setVolume,aT.SoundFile.prototype.getVolume=function(){return this.output.gain.value},aT.SoundFile.prototype.pan=function(d,f){this.panPosition=d,this.panner.pan(d,f)},aT.SoundFile.prototype.getPan=function(){return this.panPosition},aT.SoundFile.prototype.rate=function(f){var g=!1;if("undefined"==typeof f){return this.playbackRate}if(this.playbackRate=f,0===f?f=1e-13:0>f&&!this.reversed?(f=Math.abs(f),g=!0):f>0&&this.reversed&&(g=!0),this.bufferSourceNode){var d=q.audiocontext.currentTime;this.bufferSourceNode.playbackRate.cancelScheduledValues(d),this.bufferSourceNode.playbackRate.linearRampToValueAtTime(Math.abs(f),d),this._counterNode.playbackRate.cancelScheduledValues(d),this._counterNode.playbackRate.linearRampToValueAtTime(Math.abs(f),d)}return g&&this.reverseBuffer(),this.playbackRate},aT.SoundFile.prototype.setPitch=function(d){var f=A(d)/A(60);this.rate(f)},aT.SoundFile.prototype.getPlaybackRate=function(){return this.playbackRate},aT.SoundFile.prototype.duration=function(){return this.buffer?this.buffer.duration:0},aT.SoundFile.prototype.currentTime=function(){return this.reversed?Math.abs(this._lastPos-this.buffer.length)/x.sampleRate:this._lastPos/x.sampleRate},aT.SoundFile.prototype.jump=function(f,g){if(0>f||f>this.buffer.duration){throw"jump time out of range"}if(g>this.buffer.duration-f){throw"end time out of range"}var d=f||0,h=g||void 0;this.isPlaying()&&this.stop(0),this.play(0,this.playbackRate,this.output.gain.value,d,h)},aT.SoundFile.prototype.channels=function(){return this.buffer.numberOfChannels},aT.SoundFile.prototype.sampleRate=function(){return this.buffer.sampleRate},aT.SoundFile.prototype.frames=function(){return this.buffer.length},aT.SoundFile.prototype.getPeaks=function(L){if(!this.buffer){throw"Cannot load peaks yet, buffer is not loaded"}if(L||(L=5*window.width),this.buffer){for(var H=this.buffer,E=H.length/L,v=~~(E/10)||1,m=H.numberOfChannels,d=new Float32Array(Math.round(L)),M=0;m>M;M++){for(var J=H.getChannelData(M),K=0;L>K;K++){for(var I=~~(K*E),g=~~(I+E),F=0,y=I;g>y;y+=v){var G=J[y];G>F?F=G:-G>F&&(F=G)}(0===M||Math.abs(F)>d[K])&&(d[K]=F)}}return d}},aT.SoundFile.prototype.reverseBuffer=function(){if(!this.buffer){throw"SoundFile is not done loading"}var f=this._lastPos/x.sampleRate,g=this.getVolume();this.setVolume(0,0.001);const d=this.buffer.numberOfChannels;for(var h=0;d>h;h++){this.buffer.getChannelData(h).reverse()}this.reversed=!this.reversed,f&&this.jump(this.duration()-f),this.setVolume(g,0.001)},aT.SoundFile.prototype.onended=function(d){return this._onended=d,this},aT.SoundFile.prototype.add=function(){},aT.SoundFile.prototype.dispose=function(){var f=q.audiocontext.currentTime,g=q.soundArray.indexOf(this);if(q.soundArray.splice(g,1),this.stop(f),this.buffer&&this.bufferSourceNode){for(var d=0;d<this.bufferSourceNodes.length-1;d++){if(null!==this.bufferSourceNodes[d]){this.bufferSourceNodes[d].disconnect();try{this.bufferSourceNodes[d].stop(f)}catch(h){console.warning("no buffer source node to dispose")}this.bufferSourceNodes[d]=null}}if(this.isPlaying()){try{this._counterNode.stop(f)}catch(h){console.log(h)}this._counterNode=null}}this.output&&(this.output.disconnect(),this.output=null),this.panner&&(this.panner.disconnect(),this.panner=null)},aT.SoundFile.prototype.connect=function(d){d?d.hasOwnProperty("input")?this.panner.connect(d.input):this.panner.connect(d):this.panner.connect(q.input)},aT.SoundFile.prototype.disconnect=function(){this.panner&&this.panner.disconnect()},aT.SoundFile.prototype.getLevel=function(){console.warn("p5.SoundFile.getLevel has been removed from the library. Use p5.Amplitude instead")},aT.SoundFile.prototype.setPath=function(f,d){var g=aT.prototype._checkFileFormats(f);this.url=g,this.load(d)},aT.SoundFile.prototype.setBuffer=function(f){var h=f.length,d=f[0].length,m=x.createBuffer(h,d,x.sampleRate);f[0] instanceof Float32Array||(f[0]=new Float32Array(f[0]));for(var l=0;h>l;l++){var g=m.getChannelData(l);g.set(f[l])}this.buffer=m,this.panner.inputChannels(h)};var B=function(f){const g=f.length,d=x.createBuffer(1,f.length,x.sampleRate),l=d.getChannelData(0);for(var h=0;g>h;h++){l[h]=h}return d};aT.SoundFile.prototype._initCounterNode=function(){var f=this,d=x.currentTime,g=x.createBufferSource();return f._scopeNode&&(f._scopeNode.disconnect(),f._scopeNode.removeEventListener("audioprocess",f._onAudioProcess),delete f._scopeNode),f._scopeNode=x.createScriptProcessor(256,1,1),g.buffer=B(f.buffer),g.playbackRate.setValueAtTime(f.playbackRate,d),g.connect(f._scopeNode),f._scopeNode.connect(aT.soundOut._silentNode),f._scopeNode.addEventListener("audioprocess",f._onAudioProcess),g},aT.SoundFile.prototype._initSourceNode=function(){var d=x.createBufferSource();return d.buffer=this.buffer,d.playbackRate.value=this.playbackRate,d.connect(this.output),d},aT.SoundFile.prototype.processPeaks=function(N,e,O,K){var M=this.buffer.length,I=this.buffer.sampleRate,i=this.buffer,E=[],o=e||0.9,G=o,H=O||0.22,n=K||200,J=new window.OfflineAudioContext(1,M,I),L=J.createBufferSource();L.buffer=i;var F=J.createBiquadFilter();F.type="lowpass",L.connect(F),F.connect(J.destination),L.start(0),J.startRendering(),J.oncomplete=function(m){if(self.panner){var h=m.renderedBuffer,f=h.getChannelData(0);do{E=z(f,G),G-=0.005}while(Object.keys(E).length<n&&G>=H);var g=t(E),Q=j(g,h.sampleRate),v=Q.sort(function(l,p){return p.count-l.count}).splice(0,5);this.tempo=v[0].tempo;var d=5,P=c(E,v[0].tempo,h.sampleRate,d);N(P)}}};var C=function(d,f){this.sampleIndex=f,this.amplitude=d,this.tempos=[],this.intervals=[]},w=function(f,g,d,h){this.callback=f,this.time=g,this.id=d,this.val=h};aT.SoundFile.prototype.addCue=function(f,g,d){var l=this._cueIDCounter++,h=new w(g,f,l,d);return this._cues.push(h),l},aT.SoundFile.prototype.removeCue=function(f){for(var g=this._cues.length,d=0;g>d;d++){var h=this._cues[d];if(h.id===f){this._cues.splice(d,1);break}}0===this._cues.length},aT.SoundFile.prototype.clearCues=function(){this._cues=[]},aT.SoundFile.prototype._onTimeUpdate=function(f){for(var l=f/this.buffer.sampleRate,d=this._cues.length,p=0;d>p;p++){var m=this._cues[p],h=m.time,g=m.val;this._prevTime<h&&l>=h&&m.callback(g)}this._prevTime=l},aT.SoundFile.prototype.save=function(f){const d=k(this.buffer);aT.prototype.saveSound([d],f,"wav")},aT.SoundFile.prototype.getBlob=function(){const d=k(this.buffer);return new Blob([d],{type:"audio/wav"})}}(be,bg,aS,aS);var a3;a3=function(){var a=bg;aT.Amplitude=function(b){this.bufferSize=2048,this.audiocontext=a.audiocontext,this.processor=this.audiocontext.createScriptProcessor(this.bufferSize,2,1),this.input=this.processor,this.output=this.audiocontext.createGain(),this.smoothing=b||0,this.volume=0,this.average=0,this.stereoVol=[0,0],this.stereoAvg=[0,0],this.stereoVolNorm=[0,0],this.volMax=0.001,this.normalize=!1,this.processor.onaudioprocess=this._audioProcess.bind(this),this.processor.connect(this.output),this.output.gain.value=0,this.output.connect(this.audiocontext.destination),a.meter.connect(this.processor),a.soundArray.push(this)},aT.Amplitude.prototype.setInput=function(b,c){a.meter.disconnect(),c&&(this.smoothing=c),null==b?(console.log("Amplitude input source is not ready! Connecting to master output instead"),a.meter.connect(this.processor)):b instanceof aT.Signal?b.output.connect(this.processor):b?(b.connect(this.processor),this.processor.disconnect(),this.processor.connect(this.output)):a.meter.connect(this.processor)},aT.Amplitude.prototype.connect=function(b){b?b.hasOwnProperty("input")?this.output.connect(b.input):this.output.connect(b):this.output.connect(this.panner.connect(a.input))},aT.Amplitude.prototype.disconnect=function(){this.output&&this.output.disconnect()},aT.Amplitude.prototype._audioProcess=function(w){for(var l=0;l<w.inputBuffer.numberOfChannels;l++){for(var j,g=w.inputBuffer.getChannelData(l),f=g.length,b=0,x=0,q=0;f>q;q++){j=g[q],this.normalize?(b+=Math.max(Math.min(j/this.volMax,1),-1),x+=Math.max(Math.min(j/this.volMax,1),-1)*Math.max(Math.min(j/this.volMax,1),-1)):(b+=j,x+=j*j)}var v=b/f,m=Math.sqrt(x/f);this.stereoVol[l]=Math.max(m,this.stereoVol[l]*this.smoothing),this.stereoAvg[l]=Math.max(v,this.stereoVol[l]*this.smoothing),this.volMax=Math.max(this.stereoVol[l],this.volMax)}var d=this,k=this.stereoVol.reduce(function(h,n,c){return d.stereoVolNorm[c-1]=Math.max(Math.min(d.stereoVol[c-1]/d.volMax,1),0),d.stereoVolNorm[c]=Math.max(Math.min(d.stereoVol[c]/d.volMax,1),0),h+n});this.volume=k/this.stereoVol.length,this.volNorm=Math.max(Math.min(this.volume/this.volMax,1),0)},aT.Amplitude.prototype.getLevel=function(b){return"undefined"!=typeof b?this.normalize?this.stereoVolNorm[b]:this.stereoVol[b]:this.normalize?this.volNorm:this.volume},aT.Amplitude.prototype.toggleNormalize=function(b){"boolean"==typeof b?this.normalize=b:this.normalize=!this.normalize},aT.Amplitude.prototype.smooth=function(b){b>=0&&1>b?this.smoothing=b:console.log("Error: smoothing must be between 0 and 1")},aT.Amplitude.prototype.dispose=function(){var b=a.soundArray.indexOf(this);a.soundArray.splice(b,1),this.input&&(this.input.disconnect(),delete this.input),this.output&&(this.output.disconnect(),delete this.output),delete this.processor}}(bg);var bb;bb=function(){var c=bg;aT.FFT=function(g,e){this.input=this.analyser=c.audiocontext.createAnalyser(),Object.defineProperties(this,{bins:{get:function(){return this.analyser.fftSize/2},set:function(h){this.analyser.fftSize=2*h},configurable:!0,enumerable:!0},smoothing:{get:function(){return this.analyser.smoothingTimeConstant},set:function(h){this.analyser.smoothingTimeConstant=h},configurable:!0,enumerable:!0}}),this.smooth(g),this.bins=e||1024,c.fftMeter.connect(this.analyser),this.freqDomain=new Uint8Array(this.analyser.frequencyBinCount),this.timeDomain=new Uint8Array(this.analyser.frequencyBinCount),this.bass=[20,140],this.lowMid=[140,400],this.mid=[400,2600],this.highMid=[2600,5200],this.treble=[5200,14000],c.soundArray.push(this)},aT.FFT.prototype.setInput=function(e){e?(e.output?e.output.connect(this.analyser):e.connect&&e.connect(this.analyser),c.fftMeter.disconnect()):c.fftMeter.connect(this.analyser)},aT.FFT.prototype.waveform=function(){for(var l,j,m,k=0;k<arguments.length;k++){"number"==typeof arguments[k]&&(l=arguments[k],this.analyser.fftSize=2*l),"string"==typeof arguments[k]&&(j=arguments[k])}if(j&&!aT.prototype._isSafari()){return d(this,this.timeDomain),this.analyser.getFloatTimeDomainData(this.timeDomain),this.timeDomain}b(this,this.timeDomain),this.analyser.getByteTimeDomainData(this.timeDomain);for(var m=new Array,g=0;g<this.timeDomain.length;g++){var h=aT.prototype.map(this.timeDomain[g],0,255,-1,1);m.push(h)}return m},aT.FFT.prototype.analyze=function(){for(var g,h=0;h<arguments.length;h++){"number"==typeof arguments[h]&&(this.bins=arguments[h],this.analyser.fftSize=2*this.bins),"string"==typeof arguments[h]&&(g=arguments[h])}if(g&&"db"===g.toLowerCase()){return a(this),this.analyser.getFloatFrequencyData(this.freqDomain),this.freqDomain}f(this,this.freqDomain),this.analyser.getByteFrequencyData(this.freqDomain);var i=Array.apply([],this.freqDomain);return i.length===this.analyser.fftSize,i.constructor===Array,i},aT.FFT.prototype.getEnergy=function(x,l){var k=c.audiocontext.sampleRate/2;if("bass"===x?(x=this.bass[0],l=this.bass[1]):"lowMid"===x?(x=this.lowMid[0],l=this.lowMid[1]):"mid"===x?(x=this.mid[0],l=this.mid[1]):"highMid"===x?(x=this.highMid[0],l=this.highMid[1]):"treble"===x&&(x=this.treble[0],l=this.treble[1]),"number"!=typeof x){throw"invalid input for getEnergy()"}if(l){if(x&&l){if(x>l){var j=l;l=x,x=j}for(var e=Math.round(x/k*this.freqDomain.length),y=Math.round(l/k*this.freqDomain.length),v=0,w=0,q=e;y>=q;q++){v+=this.freqDomain[q],w+=1}var g=v/w;return g}throw"invalid input for getEnergy()"}var m=Math.round(x/k*this.freqDomain.length);return this.freqDomain[m]},aT.FFT.prototype.getFreq=function(h,j){console.log("getFreq() is deprecated. Please use getEnergy() instead.");var g=this.getEnergy(h,j);return g},aT.FFT.prototype.getCentroid=function(){for(var g=c.audiocontext.sampleRate/2,e=0,l=0,k=0;k<this.freqDomain.length;k++){e+=k*this.freqDomain[k],l+=this.freqDomain[k]}var j=0;0!==l&&(j=e/l);var h=j*(g/this.freqDomain.length);return h},aT.FFT.prototype.smooth=function(e){return"undefined"!=typeof e&&(this.smoothing=e),this.smoothing},aT.FFT.prototype.dispose=function(){var e=c.soundArray.indexOf(this);c.soundArray.splice(e,1),this.analyser&&(this.analyser.disconnect(),delete this.analyser)},aT.FFT.prototype.linAverages=function(h){for(var h=h||16,l=this.freqDomain,g=l.length,p=Math.floor(g/h),m=new Array(h),k=0,j=0;g>j;j++){m[k]=void 0!==m[k]?(m[k]+l[j])/2:l[j],j%p===p-1&&k++}return m},aT.FFT.prototype.logAverages=function(j){for(var h=c.audiocontext.sampleRate/2,p=this.freqDomain,m=p.length,l=new Array(j.length),k=0,e=0;m>e;e++){var g=Math.round(e*h/this.freqDomain.length);g>j[k].hi&&k++,l[k]=void 0!==l[k]?(l[k]+p[e])/2:p[e]}return l},aT.FFT.prototype.getOctaveBands=function(g,e){var g=g||3,e=e||15.625,l=[],k={lo:e/Math.pow(2,1/(2*g)),ctr:e,hi:e*Math.pow(2,1/(2*g))};l.push(k);for(var j=c.audiocontext.sampleRate/2;k.hi<j;){var h={};h.lo=k.hi,h.ctr=k.ctr*Math.pow(2,1/g),h.hi=h.ctr*Math.pow(2,1/(2*g)),l.push(h),k=h}return l};var a=function(e){e.freqDomain instanceof Float32Array==!1&&(e.freqDomain=new Float32Array(e.analyser.frequencyBinCount))},f=function(e){e.freqDomain instanceof Uint8Array==!1&&(e.freqDomain=new Uint8Array(e.analyser.frequencyBinCount))},d=function(e){e.timeDomain instanceof Float32Array==!1&&(e.timeDomain=new Float32Array(e.analyser.frequencyBinCount))},b=function(e){e.timeDomain instanceof Uint8Array==!1&&(e.timeDomain=new Uint8Array(e.analyser.frequencyBinCount))}}(bg);var bd;bd=function(a){return a.SignalBase=function(){},a.extend(a.SignalBase),a.SignalBase.prototype.connect=function(c,b,d){return a.Signal&&a.Signal===c.constructor||a.Param&&a.Param===c.constructor||a.TimelineSignal&&a.TimelineSignal===c.constructor?(c._param.cancelScheduledValues(0),c._param.value=0,c.overridden=!0):c instanceof AudioParam&&(c.cancelScheduledValues(0),c.value=0),a.prototype.connect.call(this,c,b,d),this},a.SignalBase}(a1);var a2;a2=function(a){return a.WaveShaper=function(b,c){this._shaper=this.input=this.output=this.context.createWaveShaper(),this._curve=null,Array.isArray(b)?this.curve=b:isFinite(b)||this.isUndef(b)?this._curve=new Float32Array(this.defaultArg(b,1024)):this.isFunction(b)&&(this._curve=new Float32Array(this.defaultArg(c,1024)),this.setMap(b))},a.extend(a.WaveShaper,a.SignalBase),a.WaveShaper.prototype.setMap=function(c){for(var d=0,b=this._curve.length;b>d;d++){var f=d/(b-1)*2-1;this._curve[d]=c(f,d)}return this._shaper.curve=this._curve,this},Object.defineProperty(a.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(b){this._curve=new Float32Array(b),this._shaper.curve=this._curve}}),Object.defineProperty(a.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(b){if(-1===["none","2x","4x"].indexOf(b)){throw new RangeError("Tone.WaveShaper: oversampling must be either 'none', '2x', or '4x'")}this._shaper.oversample=b}}),a.WaveShaper.prototype.dispose=function(){return a.prototype.dispose.call(this),this._shaper.disconnect(),this._shaper=null,this._curve=null,this},a.WaveShaper}(a1);var aO;aO=function(a){return a.TimeBase=function(c,b){if(!(this instanceof a.TimeBase)){return new a.TimeBase(c,b)}if(this._expr=this._noOp,c instanceof a.TimeBase){this.copy(c)}else{if(!this.isUndef(b)||this.isNumber(c)){b=this.defaultArg(b,this._defaultUnits);var d=this._primaryExpressions[b].method;this._expr=d.bind(this,c)}else{this.isString(c)?this.set(c):this.isUndef(c)&&(this._expr=this._defaultExpr())}}},a.extend(a.TimeBase),a.TimeBase.prototype.set=function(b){return this._expr=this._parseExprString(b),this},a.TimeBase.prototype.clone=function(){var b=new this.constructor;return b.copy(this),b},a.TimeBase.prototype.copy=function(b){var c=b._expr();return this.set(c)},a.TimeBase.prototype._primaryExpressions={n:{regexp:/^(\d+)n/i,method:function(b){return b=parseInt(b),1===b?this._beatsToUnits(this._timeSignature()):this._beatsToUnits(4/b)}},t:{regexp:/^(\d+)t/i,method:function(b){return b=parseInt(b),this._beatsToUnits(8/(3*parseInt(b)))}},m:{regexp:/^(\d+)m/i,method:function(b){return this._beatsToUnits(parseInt(b)*this._timeSignature())}},i:{regexp:/^(\d+)i/i,method:function(b){return this._ticksToUnits(parseInt(b))}},hz:{regexp:/^(\d+(?:\.\d+)?)hz/i,method:function(b){return this._frequencyToUnits(parseFloat(b))}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(c,d,b){var f=0;return c&&"0"!==c&&(f+=this._beatsToUnits(this._timeSignature()*parseFloat(c))),d&&"0"!==d&&(f+=this._beatsToUnits(parseFloat(d))),b&&"0"!==b&&(f+=this._beatsToUnits(parseFloat(b)/4)),f}},s:{regexp:/^(\d+(?:\.\d+)?s)/,method:function(b){return this._secondsToUnits(parseFloat(b))}},samples:{regexp:/^(\d+)samples/,method:function(b){return parseInt(b)/this.context.sampleRate}},"default":{regexp:/^(\d+(?:\.\d+)?)/,method:function(b){return this._primaryExpressions[this._defaultUnits].method.call(this,b)}}},a.TimeBase.prototype._binaryExpressions={"+":{regexp:/^\+/,precedence:2,method:function(b,c){return b()+c()}},"-":{regexp:/^\-/,precedence:2,method:function(b,c){return b()-c()}},"*":{regexp:/^\*/,precedence:1,method:function(b,c){return b()*c()}},"/":{regexp:/^\//,precedence:1,method:function(b,c){return b()/c()}}},a.TimeBase.prototype._unaryExpressions={neg:{regexp:/^\-/,method:function(b){return -b()}}},a.TimeBase.prototype._syntaxGlue={"(":{regexp:/^\(/},")":{regexp:/^\)/}},a.TimeBase.prototype._tokenize=function(c){function d(v,m){for(var l=["_binaryExpressions","_unaryExpressions","_primaryExpressions","_syntaxGlue"],k=0;k<l.length;k++){var j=m[l[k]];for(var h in j){var w=j[h],p=w.regexp,q=v.match(p);if(null!==q){return{method:w.method,precedence:w.precedence,regexp:w.regexp,value:q[0]}}}}throw new SyntaxError("Tone.TimeBase: Unexpected token "+v)}for(var b=-1,g=[];c.length>0;){c=c.trim();var f=d(c,this);g.push(f),c=c.substr(f.value.length)}return{next:function(){return g[++b]},peek:function(){return g[b+1]}}},a.TimeBase.prototype._matchGroup=function(c,f,b){var h=!1;if(!this.isUndef(c)){for(var g in f){var d=f[g];if(d.regexp.test(c.value)){if(this.isUndef(b)){return d}if(d.precedence===b){return d}}}}return h},a.TimeBase.prototype._parseBinary=function(c,d){this.isUndef(d)&&(d=2);var b;b=0>d?this._parseUnary(c):this._parseBinary(c,d-1);for(var f=c.peek();f&&this._matchGroup(f,this._binaryExpressions,d);){f=c.next(),b=f.method.bind(this,b,this._parseBinary(c,d-1)),f=c.peek()}return b},a.TimeBase.prototype._parseUnary=function(c){var d,b;d=c.peek();var f=this._matchGroup(d,this._unaryExpressions);return f?(d=c.next(),b=this._parseUnary(c),f.method.bind(this,b)):this._parsePrimary(c)},a.TimeBase.prototype._parsePrimary=function(c){var d,b;if(d=c.peek(),this.isUndef(d)){throw new SyntaxError("Tone.TimeBase: Unexpected end of expression")}if(this._matchGroup(d,this._primaryExpressions)){d=c.next();var f=d.value.match(d.regexp);return d.method.bind(this,f[1],f[2],f[3])}if(d&&"("===d.value){if(c.next(),b=this._parseBinary(c),d=c.next(),!d||")"!==d.value){throw new SyntaxError("Expected )")}return b}throw new SyntaxError("Tone.TimeBase: Cannot process token "+d.value)},a.TimeBase.prototype._parseExprString=function(c){this.isString(c)||(c=c.toString());var d=this._tokenize(c),b=this._parseBinary(d);return b},a.TimeBase.prototype._noOp=function(){return 0},a.TimeBase.prototype._defaultExpr=function(){return this._noOp},a.TimeBase.prototype._defaultUnits="s",a.TimeBase.prototype._frequencyToUnits=function(b){return 1/b},a.TimeBase.prototype._beatsToUnits=function(b){return 60/a.Transport.bpm.value*b},a.TimeBase.prototype._secondsToUnits=function(b){return b},a.TimeBase.prototype._ticksToUnits=function(b){return b*(this._beatsToUnits(1)/a.Transport.PPQ)},a.TimeBase.prototype._timeSignature=function(){return a.Transport.timeSignature},a.TimeBase.prototype._pushExpr=function(c,b,d){return c instanceof a.TimeBase||(c=new this.constructor(c,d)),this._expr=this._binaryExpressions[b].method.bind(this,this._expr,c._expr),this},a.TimeBase.prototype.add=function(b,c){return this._pushExpr(b,"+",c)},a.TimeBase.prototype.sub=function(b,c){return this._pushExpr(b,"-",c)},a.TimeBase.prototype.mult=function(b,c){return this._pushExpr(b,"*",c)},a.TimeBase.prototype.div=function(b,c){return this._pushExpr(b,"/",c)},a.TimeBase.prototype.valueOf=function(){return this._expr()},a.TimeBase.prototype.dispose=function(){this._expr=null},a.TimeBase}(a1);var aR;aR=function(a){return a.Time=function(c,b){return this instanceof a.Time?(this._plusNow=!1,void a.TimeBase.call(this,c,b)):new a.Time(c,b)},a.extend(a.Time,a.TimeBase),a.Time.prototype._unaryExpressions=Object.create(a.TimeBase.prototype._unaryExpressions),a.Time.prototype._unaryExpressions.quantize={regexp:/^@/,method:function(b){return a.Transport.nextSubdivision(b())}},a.Time.prototype._unaryExpressions.now={regexp:/^\+/,method:function(b){return this._plusNow=!0,b()}},a.Time.prototype.quantize=function(b,c){return c=this.defaultArg(c,1),this._expr=function(f,h,d){f=f(),h=h.toSeconds();var k=Math.round(f/h),j=k*h,g=j-f;return f+g*d}.bind(this,this._expr,new this.constructor(b),c),this},a.Time.prototype.addNow=function(){return this._plusNow=!0,this},a.Time.prototype._defaultExpr=function(){return this._plusNow=!0,this._noOp},a.Time.prototype.copy=function(b){return a.TimeBase.prototype.copy.call(this,b),this._plusNow=b._plusNow,this},a.Time.prototype.toNotation=function(){var c=this.toSeconds(),d=["1m","2n","4n","8n","16n","32n","64n","128n"],b=this._toNotationHelper(c,d),g=["1m","2n","2t","4n","4t","8n","8t","16n","16t","32n","32t","64n","64t","128n"],f=this._toNotationHelper(c,g);return f.split("+").length<b.split("+").length?f:b},a.Time.prototype._toNotationHelper=function(d,h){for(var c=this._notationToUnits(h[h.length-1]),k="",j=0;j<h.length;j++){var g=this._notationToUnits(h[j]),f=d/g,b=0.000001;if(b>1-f%1&&(f+=b),f=Math.floor(f),f>0){if(k+=1===f?h[j]:f.toString()+"*"+h[j],d-=f*g,c>d){break}k+=" + "}}return""===k&&(k="0"),k},a.Time.prototype._notationToUnits=function(c){for(var f=this._primaryExpressions,b=[f.n,f.t,f.m],h=0;h<b.length;h++){var g=b[h],d=c.match(g.regexp);if(d){return g.method.call(this,d[1])}}},a.Time.prototype.toBarsBeatsSixteenths=function(){var c=this._beatsToUnits(1),d=this.toSeconds()/c,b=Math.floor(d/this._timeSignature()),g=d%1*4;d=Math.floor(d)%this._timeSignature(),g=g.toString(),g.length>3&&(g=parseFloat(g).toFixed(3));var f=[b,d,g];return f.join(":")},a.Time.prototype.toTicks=function(){var c=this._beatsToUnits(1),b=this.valueOf()/c;return Math.floor(b*a.Transport.PPQ)},a.Time.prototype.toSamples=function(){return this.toSeconds()*this.context.sampleRate},a.Time.prototype.toFrequency=function(){return 1/this.toSeconds()},a.Time.prototype.toSeconds=function(){return this.valueOf()},a.Time.prototype.toMilliseconds=function(){return 1000*this.toSeconds()},a.Time.prototype.valueOf=function(){var b=this._expr();return b+(this._plusNow?this.now():0)},a.Time}(a1);var a9;a9=function(b){b.Frequency=function(f,d){return this instanceof b.Frequency?void b.TimeBase.call(this,f,d):new b.Frequency(f,d)},b.extend(b.Frequency,b.TimeBase),b.Frequency.prototype._primaryExpressions=Object.create(b.TimeBase.prototype._primaryExpressions),b.Frequency.prototype._primaryExpressions.midi={regexp:/^(\d+(?:\.\d+)?midi)/,method:function(d){return this.midiToFrequency(d)}},b.Frequency.prototype._primaryExpressions.note={regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method:function(e,d){var g=c[e.toLowerCase()],f=g+12*(parseInt(d)+1);return this.midiToFrequency(f)}},b.Frequency.prototype._primaryExpressions.tr={regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(f,g,d){var h=1;return f&&"0"!==f&&(h*=this._beatsToUnits(this._timeSignature()*parseFloat(f))),g&&"0"!==g&&(h*=this._beatsToUnits(parseFloat(g))),d&&"0"!==d&&(h*=this._beatsToUnits(parseFloat(d)/4)),h}},b.Frequency.prototype.transpose=function(d){return this._expr=function(g,h){var f=g();return f*this.intervalToFrequencyRatio(h)}.bind(this,this._expr,d),this},b.Frequency.prototype.harmonize=function(d){return this._expr=function(g,h){for(var f=g(),k=[],j=0;j<h.length;j++){k[j]=f*this.intervalToFrequencyRatio(h[j])}return k}.bind(this,this._expr,d),this},b.Frequency.prototype.toMidi=function(){return this.frequencyToMidi(this.valueOf())},b.Frequency.prototype.toNote=function(){var g=this.valueOf(),i=Math.log(g/b.Frequency.A4)/Math.LN2,h=Math.round(12*i)+57,f=Math.floor(h/12);0>f&&(h+=-12*f);var d=a[h%12];return d+f.toString()},b.Frequency.prototype.toSeconds=function(){return 1/this.valueOf()},b.Frequency.prototype.toFrequency=function(){return this.valueOf()},b.Frequency.prototype.toTicks=function(){var f=this._beatsToUnits(1),d=this.valueOf()/f;return Math.floor(d*b.Transport.PPQ)},b.Frequency.prototype._frequencyToUnits=function(d){return d},b.Frequency.prototype._ticksToUnits=function(d){return 1/(60*d/(b.Transport.bpm.value*b.Transport.PPQ))},b.Frequency.prototype._beatsToUnits=function(d){return 1/b.TimeBase.prototype._beatsToUnits.call(this,d)},b.Frequency.prototype._secondsToUnits=function(d){return 1/d},b.Frequency.prototype._defaultUnits="hz";var c={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},a=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return b.Frequency.A4=440,b.Frequency.prototype.midiToFrequency=function(d){return b.Frequency.A4*Math.pow(2,(d-69)/12)},b.Frequency.prototype.frequencyToMidi=function(d){return 69+12*Math.log(d/b.Frequency.A4)/Math.LN2},b.Frequency}(a1);var bh;bh=function(a){return a.TransportTime=function(c,b){return this instanceof a.TransportTime?void a.Time.call(this,c,b):new a.TransportTime(c,b)},a.extend(a.TransportTime,a.Time),a.TransportTime.prototype._unaryExpressions=Object.create(a.Time.prototype._unaryExpressions),a.TransportTime.prototype._unaryExpressions.quantize={regexp:/^@/,method:function(c){var b=this._secondsToTicks(c()),d=Math.ceil(a.Transport.ticks/b);return this._ticksToUnits(d*b)}},a.TransportTime.prototype._secondsToTicks=function(c){var b=this._beatsToUnits(1),d=c/b;return Math.round(d*a.Transport.PPQ)},a.TransportTime.prototype.valueOf=function(){var b=this._secondsToTicks(this._expr());return b+(this._plusNow?a.Transport.ticks:0)},a.TransportTime.prototype.toTicks=function(){return this.valueOf()},a.TransportTime.prototype.toSeconds=function(){var b=this._expr();return b+(this._plusNow?a.Transport.seconds:0)},a.TransportTime.prototype.toFrequency=function(){return 1/this.toSeconds()},a.TransportTime}(a1);var ag;ag=function(a){return a.Type={Default:"number",Time:"time",Frequency:"frequency",TransportTime:"transportTime",Ticks:"ticks",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Cents:"cents",Degrees:"degrees",MIDI:"midi",BarsBeatsSixteenths:"barsBeatsSixteenths",Samples:"samples",Hertz:"hertz",Note:"note",Milliseconds:"milliseconds",Seconds:"seconds",Notation:"notation"},a.prototype.toSeconds=function(b){return this.isNumber(b)?b:this.isUndef(b)?this.now():this.isString(b)?new a.Time(b).toSeconds():b instanceof a.TimeBase?b.toSeconds():void 0},a.prototype.toFrequency=function(b){return this.isNumber(b)?b:this.isString(b)||this.isUndef(b)?new a.Frequency(b).valueOf():b instanceof a.TimeBase?b.toFrequency():void 0},a.prototype.toTicks=function(b){return this.isNumber(b)||this.isString(b)?new a.TransportTime(b).toTicks():this.isUndef(b)?a.Transport.ticks:b instanceof a.TimeBase?b.toTicks():void 0},a}(a1,aR,a9,bh);var bf;bf=function(a){return a.Param=function(){var b=this.optionsObject(arguments,["param","units","convert"],a.Param.defaults);this._param=this.input=b.param,this.units=b.units,this.convert=b.convert,this.overridden=!1,this._lfo=null,this.isObject(b.lfo)?this.value=b.lfo:this.isUndef(b.value)||(this.value=b.value)},a.extend(a.Param),a.Param.defaults={units:a.Type.Default,convert:!0,param:void 0},Object.defineProperty(a.Param.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(c){if(this.isObject(c)){if(this.isUndef(a.LFO)){throw new Error("Include 'Tone.LFO' to use an LFO as a Param value.")}this._lfo&&this._lfo.dispose(),this._lfo=new a.LFO(c).start(),this._lfo.connect(this.input)}else{var b=this._fromUnits(c);this._param.cancelScheduledValues(0),this._param.value=b}}}),a.Param.prototype._fromUnits=function(b){if(!this.convert&&!this.isUndef(this.convert)){return b}switch(this.units){case a.Type.Time:return this.toSeconds(b);case a.Type.Frequency:return this.toFrequency(b);case a.Type.Decibels:return this.dbToGain(b);case a.Type.NormalRange:return Math.min(Math.max(b,0),1);case a.Type.AudioRange:return Math.min(Math.max(b,-1),1);case a.Type.Positive:return Math.max(b,0);default:return b}},a.Param.prototype._toUnits=function(b){if(!this.convert&&!this.isUndef(this.convert)){return b}switch(this.units){case a.Type.Decibels:return this.gainToDb(b);default:return b}},a.Param.prototype._minOutput=0.00001,a.Param.prototype.setValueAtTime=function(b,c){return b=this._fromUnits(b),c=this.toSeconds(c),c<=this.now()+this.blockTime?this._param.value=b:this._param.setValueAtTime(b,c),this},a.Param.prototype.setRampPoint=function(b){b=this.defaultArg(b,this.now());var c=this._param.value;return 0===c&&(c=this._minOutput),this._param.setValueAtTime(c,b),this},a.Param.prototype.linearRampToValueAtTime=function(b,c){return b=this._fromUnits(b),this._param.linearRampToValueAtTime(b,this.toSeconds(c)),this},a.Param.prototype.exponentialRampToValueAtTime=function(b,c){return b=this._fromUnits(b),b=Math.max(this._minOutput,b),this._param.exponentialRampToValueAtTime(b,this.toSeconds(c)),this},a.Param.prototype.exponentialRampToValue=function(c,d,b){return b=this.toSeconds(b),this.setRampPoint(b),this.exponentialRampToValueAtTime(c,b+this.toSeconds(d)),this},a.Param.prototype.linearRampToValue=function(c,d,b){return b=this.toSeconds(b),this.setRampPoint(b),this.linearRampToValueAtTime(c,b+this.toSeconds(d)),this},a.Param.prototype.setTargetAtTime=function(c,d,b){return c=this._fromUnits(c),c=Math.max(this._minOutput,c),b=Math.max(this._minOutput,b),this._param.setTargetAtTime(c,this.toSeconds(d),b),this},a.Param.prototype.setValueCurveAtTime=function(c,d,b){for(var f=0;f<c.length;f++){c[f]=this._fromUnits(c[f])}return this._param.setValueCurveAtTime(c,this.toSeconds(d),this.toSeconds(b)),this},a.Param.prototype.cancelScheduledValues=function(b){return this._param.cancelScheduledValues(this.toSeconds(b)),this},a.Param.prototype.rampTo=function(c,b,d){return b=this.defaultArg(b,0),this.units===a.Type.Frequency||this.units===a.Type.BPM||this.units===a.Type.Decibels?this.exponentialRampToValue(c,b,d):this.linearRampToValue(c,b,d),this},Object.defineProperty(a.Param.prototype,"lfo",{get:function(){return this._lfo}}),a.Param.prototype.dispose=function(){return a.prototype.dispose.call(this),this._param=null,this._lfo&&(this._lfo.dispose(),this._lfo=null),this},a.Param}(a1);var aP;aP=function(a){return window.GainNode&&!AudioContext.prototype.createGain&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),a.Gain=function(){var b=this.optionsObject(arguments,["gain","units"],a.Gain.defaults);this.input=this.output=this._gainNode=this.context.createGain(),this.gain=new a.Param({param:this._gainNode.gain,units:b.units,value:b.gain,convert:b.convert}),this._readOnly("gain")},a.extend(a.Gain),a.Gain.defaults={gain:1,convert:!0},a.Gain.prototype.dispose=function(){a.Param.prototype.dispose.call(this),this._gainNode.disconnect(),this._gainNode=null,this._writable("gain"),this.gain.dispose(),this.gain=null},a.prototype.createInsOuts=function(c,b){1===c?this.input=new a.Gain:c>1&&(this.input=new Array(c)),1===b?this.output=new a.Gain:b>1&&(this.output=new Array(c))},a.Gain}(a1,bf);var ai;ai=function(a){return a.Signal=function(){var b=this.optionsObject(arguments,["value","units"],a.Signal.defaults);this.output=this._gain=this.context.createGain(),b.param=this._gain.gain,a.Param.call(this,b),this.input=this._param=this._gain.gain,this.context.getConstant(1).chain(this._gain)},a.extend(a.Signal,a.Param),a.Signal.defaults={value:0,units:a.Type.Default,convert:!0},a.Signal.prototype.connect=a.SignalBase.prototype.connect,a.Signal.prototype.dispose=function(){return a.Param.prototype.dispose.call(this),this._param=null,this._gain.disconnect(),this._gain=null,this},a.Signal}(a1,a2,ag,bf);var aQ;aQ=function(a){return a.Add=function(b){this.createInsOuts(2,0),this._sum=this.input[0]=this.input[1]=this.output=new a.Gain,this._param=this.input[1]=new a.Signal(b),this._param.connect(this._sum)},a.extend(a.Add,a.Signal),a.Add.prototype.dispose=function(){return a.prototype.dispose.call(this),this._sum.dispose(),this._sum=null,this._param.dispose(),this._param=null,this},a.Add}(a1,ai);var aE;aE=function(a){return a.Multiply=function(b){this.createInsOuts(2,0),this._mult=this.input[0]=this.output=new a.Gain,this._param=this.input[1]=this.output.gain,this._param.value=this.defaultArg(b,0)},a.extend(a.Multiply,a.Signal),a.Multiply.prototype.dispose=function(){return a.prototype.dispose.call(this),this._mult.dispose(),this._mult=null,this._param=null,this},a.Multiply}(a1,ai);var al;al=function(a){return a.Scale=function(c,b){this._outputMin=this.defaultArg(c,0),this._outputMax=this.defaultArg(b,1),this._scale=this.input=new a.Multiply(1),this._add=this.output=new a.Add(0),this._scale.connect(this._add),this._setRange()},a.extend(a.Scale,a.SignalBase),Object.defineProperty(a.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(b){this._outputMin=b,this._setRange()}}),Object.defineProperty(a.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(b){this._outputMax=b,this._setRange()}}),a.Scale.prototype._setRange=function(){this._add.value=this._outputMin,this._scale.value=this._outputMax-this._outputMin},a.Scale.prototype.dispose=function(){return a.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null,this},a.Scale}(a1,aQ,aE);var a4;a4=function(){var b=ai,a=aQ,d=aE,c=al;aT.Signal=function(f){var e=new b(f);return e},b.prototype.fade=b.prototype.linearRampToValueAtTime,d.prototype.fade=b.prototype.fade,a.prototype.fade=b.prototype.fade,c.prototype.fade=b.prototype.fade,b.prototype.setInput=function(e){e.connect(this)},d.prototype.setInput=b.prototype.setInput,a.prototype.setInput=b.prototype.setInput,c.prototype.setInput=b.prototype.setInput,b.prototype.add=function(f){var g=new a(f);return this.connect(g),g},d.prototype.add=b.prototype.add,a.prototype.add=b.prototype.add,c.prototype.add=b.prototype.add,b.prototype.mult=function(f){var g=new d(f);return this.connect(g),g},d.prototype.mult=b.prototype.mult,a.prototype.mult=b.prototype.mult,c.prototype.mult=b.prototype.mult,b.prototype.scale=function(l,h,m,k){var j,f;4===arguments.length?(j=aT.prototype.map(m,l,h,0,1)-0.5,f=aT.prototype.map(k,l,h,0,1)-0.5):(j=arguments[0],f=arguments[1]);var g=new c(j,f);return this.connect(g),g},d.prototype.scale=b.prototype.scale,a.prototype.scale=b.prototype.scale,c.prototype.scale=b.prototype.scale}(ai,aQ,aE,al);var am;am=function(){var c=bg,a=aQ,f=aE,d=al;aT.Oscillator=function(e,h){if("string"==typeof e){var g=h;h=e,e=g}if("number"==typeof h){var g=h;h=e,e=g}this.started=!1,this.phaseAmount=void 0,this.oscillator=c.audiocontext.createOscillator(),this.f=e||440,this.oscillator.type=h||"sine",this.oscillator.frequency.setValueAtTime(this.f,c.audiocontext.currentTime),this.output=c.audiocontext.createGain(),this._freqMods=[],this.output.gain.value=0.5,this.output.gain.setValueAtTime(0.5,c.audiocontext.currentTime),this.oscillator.connect(this.output),this.panPosition=0,this.connection=c.input,this.panner=new aT.Panner(this.output,this.connection,1),this.mathOps=[this.output],c.soundArray.push(this)},aT.Oscillator.prototype.start=function(g,e){if(this.started){var l=c.audiocontext.currentTime;this.stop(l)}if(!this.started){var k=e||this.f,j=this.oscillator.type;this.oscillator&&(this.oscillator.disconnect(),delete this.oscillator),this.oscillator=c.audiocontext.createOscillator(),this.oscillator.frequency.value=Math.abs(k),this.oscillator.type=j,this.oscillator.connect(this.output),g=g||0,this.oscillator.start(g+c.audiocontext.currentTime),this.freqNode=this.oscillator.frequency;for(var h in this._freqMods){"undefined"!=typeof this._freqMods[h].connect&&this._freqMods[h].connect(this.oscillator.frequency)}this.started=!0}},aT.Oscillator.prototype.stop=function(g){if(this.started){var e=g||0,h=c.audiocontext.currentTime;this.oscillator.stop(e+h),this.started=!1}},aT.Oscillator.prototype.amp=function(g,e,k){var j=this;if("number"==typeof g){var e=e||0,k=k||0,h=c.audiocontext.currentTime;this.output.gain.linearRampToValueAtTime(g,h+k+e)}else{if(!g){return this.output.gain}g.connect(j.output.gain)}},aT.Oscillator.prototype.fade=aT.Oscillator.prototype.amp,aT.Oscillator.prototype.getAmp=function(){return this.output.gain.value},aT.Oscillator.prototype.freq=function(g,e,j){if("number"!=typeof g||isNaN(g)){if(!g){return this.oscillator.frequency}g.output&&(g=g.output),g.connect(this.oscillator.frequency),this._freqMods.push(g)}else{this.f=g;var h=c.audiocontext.currentTime,e=e||0,j=j||0;0===e?this.oscillator.frequency.setValueAtTime(g,j+h):g>0?this.oscillator.frequency.exponentialRampToValueAtTime(g,j+e+h):this.oscillator.frequency.linearRampToValueAtTime(g,j+e+h),this.phaseAmount&&this.phase(this.phaseAmount)}},aT.Oscillator.prototype.getFreq=function(){return this.oscillator.frequency.value},aT.Oscillator.prototype.setType=function(e){this.oscillator.type=e},aT.Oscillator.prototype.getType=function(){return this.oscillator.type},aT.Oscillator.prototype.connect=function(e){e?e.hasOwnProperty("input")?(this.panner.connect(e.input),this.connection=e.input):(this.panner.connect(e),this.connection=e):this.panner.connect(c.input)},aT.Oscillator.prototype.disconnect=function(){this.output&&this.output.disconnect(),this.panner&&(this.panner.disconnect(),this.output&&this.output.connect(this.panner)),this.oscMods=[]},aT.Oscillator.prototype.pan=function(g,h){this.panPosition=g,this.panner.pan(g,h)},aT.Oscillator.prototype.getPan=function(){return this.panPosition},aT.Oscillator.prototype.dispose=function(){var g=c.soundArray.indexOf(this);if(c.soundArray.splice(g,1),this.oscillator){var e=c.audiocontext.currentTime;this.stop(e),this.disconnect(),this.panner=null,this.oscillator=null}this.osc2&&this.osc2.dispose()},aT.Oscillator.prototype.phase=function(e){var h=aT.prototype.map(e,0,1,0,1/this.f),g=c.audiocontext.currentTime;this.phaseAmount=e,this.dNode||(this.dNode=c.audiocontext.createDelay(),this.oscillator.disconnect(),this.oscillator.connect(this.dNode),this.dNode.connect(this.output)),this.dNode.delayTime.setValueAtTime(h,g)};var b=function(h,l,g,p,m){var k=h.oscillator;for(var j in h.mathOps){h.mathOps[j] instanceof m&&(k.disconnect(),h.mathOps[j].dispose(),g=j,g<h.mathOps.length-2&&(p=h.mathOps[j+1]))}return g===h.mathOps.length-1&&h.mathOps.push(p),j>0&&(k=h.mathOps[j-1]),k.disconnect(),k.connect(l),l.connect(p),h.mathOps[g]=l,h};aT.Oscillator.prototype.add=function(g){var h=new a(g),j=this.mathOps.length-1,i=this.output;return b(this,h,j,i,a)},aT.Oscillator.prototype.mult=function(h){var j=new f(h),g=this.mathOps.length-1,k=this.output;return b(this,j,g,k,f)},aT.Oscillator.prototype.scale=function(m,k,j,t){var q,r;4===arguments.length?(q=aT.prototype.map(j,m,k,0,1)-0.5,r=aT.prototype.map(t,m,k,0,1)-0.5):(q=arguments[0],r=arguments[1]);var o=new d(q,r),g=this.mathOps.length-1,l=this.output;return b(this,o,g,l,d)},aT.SinOsc=function(g){aT.Oscillator.call(this,g,"sine")},aT.SinOsc.prototype=Object.create(aT.Oscillator.prototype),aT.TriOsc=function(g){aT.Oscillator.call(this,g,"triangle")},aT.TriOsc.prototype=Object.create(aT.Oscillator.prototype),aT.SawOsc=function(g){aT.Oscillator.call(this,g,"sawtooth")},aT.SawOsc.prototype=Object.create(aT.Oscillator.prototype),aT.SqrOsc=function(g){aT.Oscillator.call(this,g,"square")},aT.SqrOsc.prototype=Object.create(aT.Oscillator.prototype)}(bg,aQ,aE,al);var az;az=function(a){return a.Timeline=function(){var b=this.optionsObject(arguments,["memory"],a.Timeline.defaults);this._timeline=[],this._toRemove=[],this._iterating=!1,this.memory=b.memory},a.extend(a.Timeline),a.Timeline.defaults={memory:1/0},Object.defineProperty(a.Timeline.prototype,"length",{get:function(){return this._timeline.length}}),a.Timeline.prototype.add=function(c){if(this.isUndef(c.time)){throw new Error("Tone.Timeline: events must have a time attribute")}if(this._timeline.length){var d=this._search(c.time);this._timeline.splice(d+1,0,c)}else{this._timeline.push(c)}if(this.length>this.memory){var b=this.length-this.memory;this._timeline.splice(0,b)}return this},a.Timeline.prototype.remove=function(b){if(this._iterating){this._toRemove.push(b)}else{var c=this._timeline.indexOf(b);-1!==c&&this._timeline.splice(c,1)}return this},a.Timeline.prototype.get=function(b){var c=this._search(b);return -1!==c?this._timeline[c]:null},a.Timeline.prototype.peek=function(){return this._timeline[0]},a.Timeline.prototype.shift=function(){return this._timeline.shift()},a.Timeline.prototype.getAfter=function(b){var c=this._search(b);return c+1<this._timeline.length?this._timeline[c+1]:null},a.Timeline.prototype.getBefore=function(c){var d=this._timeline.length;if(d>0&&this._timeline[d-1].time<c){return this._timeline[d-1]}var b=this._search(c);return b-1>=0?this._timeline[b-1]:null},a.Timeline.prototype.cancel=function(c){if(this._timeline.length>1){var d=this._search(c);if(d>=0){if(this._timeline[d].time===c){for(var b=d;b>=0&&this._timeline[b].time===c;b--){d=b}this._timeline=this._timeline.slice(0,d)}else{this._timeline=this._timeline.slice(0,d+1)}}else{this._timeline=[]}}else{1===this._timeline.length&&this._timeline[0].time>=c&&(this._timeline=[])}return this},a.Timeline.prototype.cancelBefore=function(b){if(this._timeline.length){var c=this._search(b);c>=0&&(this._timeline=this._timeline.slice(c+1))}return this},a.Timeline.prototype._search=function(k){var g=0,f=this._timeline.length,d=f;if(f>0&&this._timeline[f-1].time<=k){return f-1}for(;d>g;){var c=Math.floor(g+(d-g)/2),b=this._timeline[c],l=this._timeline[c+1];if(b.time===k){for(var h=c;h<this._timeline.length;h++){var j=this._timeline[h];j.time===k&&(c=h)}return c}if(b.time<k&&l.time>k){return c}b.time>k?d=c:b.time<k&&(g=c+1)}return -1},a.Timeline.prototype._iterate=function(c,f,b){this._iterating=!0,f=this.defaultArg(f,0),b=this.defaultArg(b,this._timeline.length-1);for(var h=f;b>=h;h++){c(this._timeline[h])}if(this._iterating=!1,this._toRemove.length>0){for(var g=0;g<this._toRemove.length;g++){var d=this._timeline.indexOf(this._toRemove[g]);-1!==d&&this._timeline.splice(d,1)}this._toRemove=[]}},a.Timeline.prototype.forEach=function(b){return this._iterate(b),this},a.Timeline.prototype.forEachBefore=function(c,d){var b=this._search(c);return -1!==b&&this._iterate(d,0,b),this},a.Timeline.prototype.forEachAfter=function(c,d){var b=this._search(c);return this._iterate(d,b+1),this},a.Timeline.prototype.forEachFrom=function(c,d){for(var b=this._search(c);b>=0&&this._timeline[b].time>=c;){b--}return this._iterate(d,b+1),this},a.Timeline.prototype.forEachAtTime=function(c,d){var b=this._search(c);return -1!==b&&this._iterate(function(e){e.time===c&&d(e)},0,b),this},a.Timeline.prototype.dispose=function(){a.prototype.dispose.call(this),this._timeline=null,this._toRemove=null},a.Timeline}(a1);var aW;aW=function(a){return a.TimelineSignal=function(){var b=this.optionsObject(arguments,["value","units"],a.Signal.defaults);this._events=new a.Timeline(10),a.Signal.apply(this,b),b.param=this._param,a.Param.call(this,b),this._initial=this._fromUnits(this._param.value)},a.extend(a.TimelineSignal,a.Param),a.TimelineSignal.Type={Linear:"linear",Exponential:"exponential",Target:"target",Curve:"curve",Set:"set"},Object.defineProperty(a.TimelineSignal.prototype,"value",{get:function(){var b=this.now(),c=this.getValueAtTime(b);return this._toUnits(c)},set:function(b){var c=this._fromUnits(b);this._initial=c,this.cancelScheduledValues(),this._param.value=c}}),a.TimelineSignal.prototype.setValueAtTime=function(c,b){return c=this._fromUnits(c),b=this.toSeconds(b),this._events.add({type:a.TimelineSignal.Type.Set,value:c,time:b}),this._param.setValueAtTime(c,b),this},a.TimelineSignal.prototype.linearRampToValueAtTime=function(c,b){return c=this._fromUnits(c),b=this.toSeconds(b),this._events.add({type:a.TimelineSignal.Type.Linear,value:c,time:b}),this._param.linearRampToValueAtTime(c,b),this},a.TimelineSignal.prototype.exponentialRampToValueAtTime=function(c,b){b=this.toSeconds(b);var f=this._searchBefore(b);f&&0===f.value&&this.setValueAtTime(this._minOutput,f.time),c=this._fromUnits(c);var d=Math.max(c,this._minOutput);return this._events.add({type:a.TimelineSignal.Type.Exponential,value:d,time:b}),c<this._minOutput?(this._param.exponentialRampToValueAtTime(this._minOutput,b-this.sampleTime),this.setValueAtTime(0,b)):this._param.exponentialRampToValueAtTime(c,b),this},a.TimelineSignal.prototype.setTargetAtTime=function(c,b,d){return c=this._fromUnits(c),c=Math.max(this._minOutput,c),d=Math.max(this._minOutput,d),b=this.toSeconds(b),this._events.add({type:a.TimelineSignal.Type.Target,value:c,time:b,constant:d}),this._param.setTargetAtTime(c,b,d),this},a.TimelineSignal.prototype.setValueCurveAtTime=function(h,d,k,j){j=this.defaultArg(j,1);for(var g=new Array(h.length),f=0;f<g.length;f++){g[f]=this._fromUnits(h[f])*j}d=this.toSeconds(d),k=this.toSeconds(k),this._events.add({type:a.TimelineSignal.Type.Curve,value:g,time:d,duration:k}),this._param.setValueAtTime(g[0],d);for(var b=1;b<g.length;b++){var c=d+b/(g.length-1)*k;this._param.linearRampToValueAtTime(g[b],c)}return this},a.TimelineSignal.prototype.cancelScheduledValues=function(b){return b=this.toSeconds(b),this._events.cancel(b),this._param.cancelScheduledValues(b),this},a.TimelineSignal.prototype.setRampPoint=function(c){c=this.toSeconds(c);var b=this._toUnits(this.getValueAtTime(c)),f=this._searchBefore(c);if(f&&f.time===c){this.cancelScheduledValues(c+this.sampleTime)}else{if(f&&f.type===a.TimelineSignal.Type.Curve&&f.time+f.duration>c){this.cancelScheduledValues(c),this.linearRampToValueAtTime(b,c)}else{var d=this._searchAfter(c);d&&(this.cancelScheduledValues(c),d.type===a.TimelineSignal.Type.Linear?this.linearRampToValueAtTime(b,c):d.type===a.TimelineSignal.Type.Exponential&&this.exponentialRampToValueAtTime(b,c)),this.setValueAtTime(b,c)}}return this},a.TimelineSignal.prototype.linearRampToValueBetween=function(c,d,b){return this.setRampPoint(d),this.linearRampToValueAtTime(c,b),this},a.TimelineSignal.prototype.exponentialRampToValueBetween=function(c,d,b){return this.setRampPoint(d),this.exponentialRampToValueAtTime(c,b),this},a.TimelineSignal.prototype._searchBefore=function(b){return this._events.get(b)},a.TimelineSignal.prototype._searchAfter=function(b){return this._events.getAfter(b)},a.TimelineSignal.prototype.getValueAtTime=function(f){f=this.toSeconds(f);var b=this._searchAfter(f),h=this._searchBefore(f),g=this._initial;if(null===h){g=this._initial}else{if(h.type===a.TimelineSignal.Type.Target){var d,c=this._events.getBefore(h.time);d=null===c?this._initial:c.value,g=this._exponentialApproach(h.time,d,h.value,h.constant,f)}else{g=h.type===a.TimelineSignal.Type.Curve?this._curveInterpolate(h.time,h.value,h.duration,f):null===b?h.value:b.type===a.TimelineSignal.Type.Linear?this._linearInterpolate(h.time,h.value,b.time,b.value,f):b.type===a.TimelineSignal.Type.Exponential?this._exponentialInterpolate(h.time,h.value,b.time,b.value,f):h.value}}return g},a.TimelineSignal.prototype.connect=a.SignalBase.prototype.connect,a.TimelineSignal.prototype._exponentialApproach=function(c,d,b,g,f){return b+(d-b)*Math.exp(-(f-c)/g)},a.TimelineSignal.prototype._linearInterpolate=function(c,d,b,g,f){return d+(g-d)*((f-c)/(b-c))},a.TimelineSignal.prototype._exponentialInterpolate=function(c,d,b,g,f){return d=Math.max(this._minOutput,d),d*Math.pow(g/d,(f-c)/(b-c))},a.TimelineSignal.prototype._curveInterpolate=function(m,h,g,f){var d=h.length;if(f>=m+g){return h[d-1]}if(m>=f){return h[0]}var b=(f-m)/g,p=Math.floor((d-1)*b),k=Math.ceil((d-1)*b),l=h[p],j=h[k];return k===p?l:this._linearInterpolate(p,l,k,j,b*(d-1))},a.TimelineSignal.prototype.dispose=function(){a.Signal.prototype.dispose.call(this),a.Param.prototype.dispose.call(this),this._events.dispose(),this._events=null},a.TimelineSignal}(a1,ai);var ao;ao=function(){var c=bg,a=aQ,f=aE,d=al,b=aW;aT.Envelope=function(h,g,l,k,j,e){this.aTime=h||0.1,this.aLevel=g||1,this.dTime=l||0.5,this.dLevel=k||0,this.rTime=j||0,this.rLevel=e||0,this._rampHighPercentage=0.98,this._rampLowPercentage=0.02,this.output=c.audiocontext.createGain(),this.control=new b,this._init(),this.control.connect(this.output),this.connection=null,this.mathOps=[this.control],this.isExponential=!1,this.sourceToClear=null,this.wasTriggered=!1,c.soundArray.push(this)},aT.Envelope.prototype._init=function(){var g=c.audiocontext.currentTime,e=g;this.control.setTargetAtTime(0.00001,e,0.001),this._setRampAD(this.aTime,this.dTime)},aT.Envelope.prototype.set=function(h,k,g,m,l,j){this.aTime=h,this.aLevel=k,this.dTime=g||0,this.dLevel=m||0,this.rTime=l||0,this.rLevel=j||0,this._setRampAD(h,g)},aT.Envelope.prototype.setADSR=function(h,j,g,k){this.aTime=h,this.dTime=j||0,this.sPercent=g||0,this.dLevel="undefined"!=typeof g?g*(this.aLevel-this.rLevel)+this.rLevel:0,this.rTime=k||0,this._setRampAD(h,j)},aT.Envelope.prototype.setRange=function(g,h){this.aLevel=g||1,this.rLevel=h||0},aT.Envelope.prototype._setRampAD=function(h,j){this._rampAttackTime=this.checkExpInput(h),this._rampDecayTime=this.checkExpInput(j);var g=1;g=Math.log(1/this.checkExpInput(1-this._rampHighPercentage)),this._rampAttackTC=h/this.checkExpInput(g),g=Math.log(1/this._rampLowPercentage),this._rampDecayTC=j/this.checkExpInput(g)},aT.Envelope.prototype.setRampPercentages=function(h,j){this._rampHighPercentage=this.checkExpInput(h),this._rampLowPercentage=this.checkExpInput(j);var g=1;g=Math.log(1/this.checkExpInput(1-this._rampHighPercentage)),this._rampAttackTC=this._rampAttackTime/this.checkExpInput(g),g=Math.log(1/this._rampLowPercentage),this._rampDecayTC=this._rampDecayTime/this.checkExpInput(g)},aT.Envelope.prototype.setInput=function(){for(var e=0;e<arguments.length;e++){this.connect(arguments[e])}},aT.Envelope.prototype.setExp=function(e){this.isExponential=e},aT.Envelope.prototype.checkExpInput=function(e){return 0>=e&&(e=1e-8),e},aT.Envelope.prototype.play=function(h,j,g){var k=j||0,g=g||0;h&&this.connection!==h&&this.connect(h),this.triggerAttack(h,k),this.triggerRelease(h,k+this.aTime+this.dTime+g)},aT.Envelope.prototype.triggerAttack=function(g,e){var l=c.audiocontext.currentTime,k=e||0,j=l+k;this.lastAttack=j,this.wasTriggered=!0,g&&this.connection!==g&&this.connect(g);var h=this.control.getValueAtTime(j);this.isExponential===!0?this.control.exponentialRampToValueAtTime(this.checkExpInput(h),j):this.control.linearRampToValueAtTime(h,j),j+=this.aTime,this.isExponential===!0?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.aLevel),j),h=this.checkExpInput(this.control.getValueAtTime(j)),this.control.cancelScheduledValues(j),this.control.exponentialRampToValueAtTime(h,j)):(this.control.linearRampToValueAtTime(this.aLevel,j),h=this.control.getValueAtTime(j),this.control.cancelScheduledValues(j),this.control.linearRampToValueAtTime(h,j)),j+=this.dTime,this.isExponential===!0?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.dLevel),j),h=this.checkExpInput(this.control.getValueAtTime(j)),this.control.cancelScheduledValues(j),this.control.exponentialRampToValueAtTime(h,j)):(this.control.linearRampToValueAtTime(this.dLevel,j),h=this.control.getValueAtTime(j),this.control.cancelScheduledValues(j),this.control.linearRampToValueAtTime(h,j))},aT.Envelope.prototype.triggerRelease=function(g,e){if(this.wasTriggered){var l=c.audiocontext.currentTime,k=e||0,j=l+k;g&&this.connection!==g&&this.connect(g);var h=this.control.getValueAtTime(j);this.isExponential===!0?this.control.exponentialRampToValueAtTime(this.checkExpInput(h),j):this.control.linearRampToValueAtTime(h,j),j+=this.rTime,this.isExponential===!0?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.rLevel),j),h=this.checkExpInput(this.control.getValueAtTime(j)),this.control.cancelScheduledValues(j),this.control.exponentialRampToValueAtTime(h,j)):(this.control.linearRampToValueAtTime(this.rLevel,j),h=this.control.getValueAtTime(j),this.control.cancelScheduledValues(j),this.control.linearRampToValueAtTime(h,j)),this.wasTriggered=!1}},aT.Envelope.prototype.ramp=function(v,k,j,h){var e=c.audiocontext.currentTime,w=k||0,m=e+w,q=this.checkExpInput(j),l="undefined"!=typeof h?this.checkExpInput(h):void 0;v&&this.connection!==v&&this.connect(v);var g=this.checkExpInput(this.control.getValueAtTime(m));q>g?(this.control.setTargetAtTime(q,m,this._rampAttackTC),m+=this._rampAttackTime):g>q&&(this.control.setTargetAtTime(q,m,this._rampDecayTC),m+=this._rampDecayTime),void 0!==l&&(l>q?this.control.setTargetAtTime(l,m,this._rampAttackTC):q>l&&this.control.setTargetAtTime(l,m,this._rampDecayTC))},aT.Envelope.prototype.connect=function(e){this.connection=e,(e instanceof aT.Oscillator||e instanceof aT.SoundFile||e instanceof aT.AudioIn||e instanceof aT.Reverb||e instanceof aT.Noise||e instanceof aT.Filter||e instanceof aT.Delay)&&(e=e.output.gain),e instanceof AudioParam&&e.setValueAtTime(0,c.audiocontext.currentTime),e instanceof aT.Signal&&e.setValue(0),this.output.connect(e)},aT.Envelope.prototype.disconnect=function(){this.output&&this.output.disconnect()},aT.Envelope.prototype.add=function(h){var j=new a(h),i=this.mathOps.length,g=this.output;return aT.prototype._mathChain(this,j,i,g,a)},aT.Envelope.prototype.mult=function(j){var g=new f(j),k=this.mathOps.length,h=this.output;return aT.prototype._mathChain(this,g,k,h,f)},aT.Envelope.prototype.scale=function(m,j,o,l){var k=new d(m,j,o,l),g=this.mathOps.length,h=this.output;return aT.prototype._mathChain(this,k,g,h,d)},aT.Envelope.prototype.dispose=function(){var g=c.soundArray.indexOf(this);c.soundArray.splice(g,1),this.disconnect(),this.control&&(this.control.dispose(),this.control=null);for(var e=1;e<this.mathOps.length;e++){this.mathOps[e].dispose()}},aT.Env=function(k,g,m,l,j,h){console.warn("WARNING: p5.Env is now deprecated and may be removed in future versions. Please use the new p5.Envelope instead."),aT.Envelope.call(this,k,g,m,l,j,h)},aT.Env.prototype=Object.create(aT.Envelope.prototype)}(bg,aQ,aE,al,aW);var aA;aA=function(){function b(){for(var c=a.audiocontext,f=c.createBuffer(1,2048,c.sampleRate),h=f.getChannelData(0),g=0;2048>g;g++){h[g]=1}var d=c.createBufferSource();return d.buffer=f,d.loop=!0,d}var a=bg;aT.Pulse=function(e,d){aT.Oscillator.call(this,e,"sawtooth"),this.w=d||0,this.osc2=new aT.SawOsc(e),this.dNode=a.audiocontext.createDelay(),this.dcOffset=b(),this.dcGain=a.audiocontext.createGain(),this.dcOffset.connect(this.dcGain),this.dcGain.connect(this.output),this.f=e||440;var c=this.w/this.oscillator.frequency.value;this.dNode.delayTime.value=c,this.dcGain.gain.value=1.7*(0.5-this.w),this.osc2.disconnect(),this.osc2.panner.disconnect(),this.osc2.amp(-1),this.osc2.output.connect(this.dNode),this.dNode.connect(this.output),this.output.gain.value=1,this.output.connect(this.panner)},aT.Pulse.prototype=Object.create(aT.Oscillator.prototype),aT.Pulse.prototype.width=function(d){if("number"==typeof d){if(1>=d&&d>=0){this.w=d;var c=this.w/this.oscillator.frequency.value;this.dNode.delayTime.value=c}this.dcGain.gain.value=1.7*(0.5-this.w)}else{d.connect(this.dNode.delayTime);var f=new aT.SignalAdd(-0.5);f.setInput(d),f=f.mult(-1),f=f.mult(1.7),f.connect(this.dcGain.gain)}},aT.Pulse.prototype.start=function(d,h){var g=a.audiocontext.currentTime,f=h||0;if(!this.started){var e=d||this.f,c=this.oscillator.type;this.oscillator=a.audiocontext.createOscillator(),this.oscillator.frequency.setValueAtTime(e,g),this.oscillator.type=c,this.oscillator.connect(this.output),this.oscillator.start(f+g),this.osc2.oscillator=a.audiocontext.createOscillator(),this.osc2.oscillator.frequency.setValueAtTime(e,f+g),this.osc2.oscillator.type=c,this.osc2.oscillator.connect(this.osc2.output),this.osc2.start(f+g),this.freqNode=[this.oscillator.frequency,this.osc2.oscillator.frequency],this.dcOffset=b(),this.dcOffset.connect(this.dcGain),this.dcOffset.start(f+g),void 0!==this.mods&&void 0!==this.mods.frequency&&(this.mods.frequency.connect(this.freqNode[0]),this.mods.frequency.connect(this.freqNode[1])),this.started=!0,this.osc2.started=!0}},aT.Pulse.prototype.stop=function(c){if(this.started){var d=c||0,f=a.audiocontext.currentTime;this.oscillator.stop(d+f),this.osc2.oscillator&&this.osc2.oscillator.stop(d+f),this.dcOffset.stop(d+f),this.started=!1,this.osc2.started=!1}},aT.Pulse.prototype.freq=function(c,f,h){if("number"==typeof c){this.f=c;var g=a.audiocontext.currentTime,f=f||0,h=h||0,d=this.oscillator.frequency.value;this.oscillator.frequency.cancelScheduledValues(g),this.oscillator.frequency.setValueAtTime(d,g+h),this.oscillator.frequency.exponentialRampToValueAtTime(c,h+f+g),this.osc2.oscillator.frequency.cancelScheduledValues(g),this.osc2.oscillator.frequency.setValueAtTime(d,g+h),this.osc2.oscillator.frequency.exponentialRampToValueAtTime(c,h+f+g),this.freqMod&&(this.freqMod.output.disconnect(),this.freqMod=null)}else{c.output&&(c.output.disconnect(),c.output.connect(this.oscillator.frequency),c.output.connect(this.osc2.oscillator.frequency),this.freqMod=c)}}}(bg,am);var ae;ae=function(){var b=bg;aT.Noise=function(g){var f;aT.Oscillator.call(this),delete this.f,delete this.freq,delete this.oscillator,f="brown"===g?c:"pink"===g?d:a,this.buffer=f},aT.Noise.prototype=Object.create(aT.Oscillator.prototype);var a=function(){for(var f=2*b.audiocontext.sampleRate,e=b.audiocontext.createBuffer(1,f,b.audiocontext.sampleRate),h=e.getChannelData(0),g=0;f>g;g++){h[g]=2*Math.random()-1}return e.type="white",e}(),d=function(){var y,m,j,g,e,z,w,x=2*b.audiocontext.sampleRate,v=b.audiocontext.createBuffer(1,x,b.audiocontext.sampleRate),f=v.getChannelData(0);y=m=j=g=e=z=w=0;for(var q=0;x>q;q++){var k=2*Math.random()-1;y=0.99886*y+0.0555179*k,m=0.99332*m+0.0750759*k,j=0.969*j+0.153852*k,g=0.8665*g+0.3104856*k,e=0.55*e+0.5329522*k,z=-0.7616*z-0.016898*k,f[q]=y+m+j+g+e+z+w+0.5362*k,f[q]*=0.11,w=0.115926*k}return v.type="pink",v}(),c=function(){for(var f=2*b.audiocontext.sampleRate,e=b.audiocontext.createBuffer(1,f,b.audiocontext.sampleRate),k=e.getChannelData(0),j=0,h=0;f>h;h++){var g=2*Math.random()-1;k[h]=(j+0.02*g)/1.02,j=k[h],k[h]*=3.5}return e.type="brown",e}();aT.Noise.prototype.setType=function(e){switch(e){case"white":this.buffer=a;break;case"pink":this.buffer=d;break;case"brown":this.buffer=c;break;default:this.buffer=a}if(this.started){var f=b.audiocontext.currentTime;this.stop(f),this.start(f+0.01)}},aT.Noise.prototype.getType=function(){return this.buffer.type},aT.Noise.prototype.start=function(){this.started&&this.stop(),this.noise=b.audiocontext.createBufferSource(),this.noise.buffer=this.buffer,this.noise.loop=!0,this.noise.connect(this.output);var e=b.audiocontext.currentTime;this.noise.start(e),this.started=!0},aT.Noise.prototype.stop=function(){var e=b.audiocontext.currentTime;this.noise&&(this.noise.stop(e),this.started=!1)},aT.Noise.prototype.dispose=function(){var f=b.audiocontext.currentTime,e=b.soundArray.indexOf(this);b.soundArray.splice(e,1),this.noise&&(this.noise.disconnect(),this.stop(f)),this.output&&this.output.disconnect(),this.panner&&this.panner.disconnect(),this.output=null,this.panner=null,this.buffer=null,this.noise=null}}(bg);var aj;aj=function(){var a=bg;a.inputSources=[],aT.AudioIn=function(b){this.input=a.audiocontext.createGain(),this.output=a.audiocontext.createGain(),this.stream=null,this.mediaStream=null,this.currentSource=null,this.enabled=!1,this.amplitude=new aT.Amplitude,this.output.connect(this.amplitude.input),window.MediaStreamTrack&&window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia||(b?b():window.alert("This browser does not support MediaStreamTrack and mediaDevices")),a.soundArray.push(this)},aT.AudioIn.prototype.start=function(c,b){var f=this;this.stream&&this.stop();var e=a.inputSources[f.currentSource],d={audio:{sampleRate:a.audiocontext.sampleRate,echoCancellation:!1}};a.inputSources[this.currentSource]&&(d.audio.deviceId=e.deviceId),window.navigator.mediaDevices.getUserMedia(d).then(function(g){f.stream=g,f.enabled=!0,f.mediaStream=a.audiocontext.createMediaStreamSource(g),f.mediaStream.connect(f.output),f.amplitude.setInput(f.output),c&&c()})["catch"](function(g){b?b(g):console.error(g)})},aT.AudioIn.prototype.stop=function(){this.stream&&(this.stream.getTracks().forEach(function(b){b.stop()}),this.mediaStream.disconnect(),delete this.mediaStream,delete this.stream)},aT.AudioIn.prototype.connect=function(b){b?b.hasOwnProperty("input")?this.output.connect(b.input):b.hasOwnProperty("analyser")?this.output.connect(b.analyser):this.output.connect(b):this.output.connect(a.input)},aT.AudioIn.prototype.disconnect=function(){this.output&&(this.output.disconnect(),this.output.connect(this.amplitude.input))},aT.AudioIn.prototype.getLevel=function(b){return b&&(this.amplitude.smoothing=b),this.amplitude.getLevel()},aT.AudioIn.prototype.amp=function(c,b){if(b){var e=b||0,d=this.output.gain.value;this.output.gain.cancelScheduledValues(a.audiocontext.currentTime),this.output.gain.setValueAtTime(d,a.audiocontext.currentTime),this.output.gain.linearRampToValueAtTime(c,e+a.audiocontext.currentTime)}else{this.output.gain.cancelScheduledValues(a.audiocontext.currentTime),this.output.gain.setValueAtTime(c,a.audiocontext.currentTime)}},aT.AudioIn.prototype.getSources=function(c,b){return new Promise(function(e,d){window.navigator.mediaDevices.enumerateDevices().then(function(f){a.inputSources=f.filter(function(g){return"audioinput"===g.kind}),e(a.inputSources),c&&c(a.inputSources)})["catch"](function(f){d(f),b?b(f):console.error("This browser does not support MediaStreamTrack.getSources()")})})},aT.AudioIn.prototype.setSource=function(b){a.inputSources.length>0&&b<a.inputSources.length?(this.currentSource=b,console.log("set source to ",a.inputSources[this.currentSource])):console.log("unable to set input source"),this.stream&&this.stream.active&&this.start()},aT.AudioIn.prototype.dispose=function(){var b=a.soundArray.indexOf(this);a.soundArray.splice(b,1),this.stop(),this.output&&this.output.disconnect(),this.amplitude&&this.amplitude.disconnect(),delete this.amplitude,delete this.output}}(bg);var aC;aC=function(a){return a.Negate=function(){this._multiply=this.input=this.output=new a.Multiply(-1)},a.extend(a.Negate,a.SignalBase),a.Negate.prototype.dispose=function(){return a.prototype.dispose.call(this),this._multiply.dispose(),this._multiply=null,this},a.Negate}(a1,aE);var aB;aB=function(a){return a.Subtract=function(b){this.createInsOuts(2,0),this._sum=this.input[0]=this.output=new a.Gain,this._neg=new a.Negate,this._param=this.input[1]=new a.Signal(b),this._param.chain(this._neg,this._sum)},a.extend(a.Subtract,a.Signal),a.Subtract.prototype.dispose=function(){return a.prototype.dispose.call(this),this._neg.dispose(),this._neg=null,this._sum.disconnect(),this._sum=null,this._param.dispose(),this._param=null,this},a.Subtract}(a1,aQ,aC,ai);var an;an=function(a){return a.GreaterThanZero=function(){this._thresh=this.output=new a.WaveShaper(function(b){return 0>=b?0:1},127),this._scale=this.input=new a.Multiply(10000),this._scale.connect(this._thresh)},a.extend(a.GreaterThanZero,a.SignalBase),a.GreaterThanZero.prototype.dispose=function(){return a.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._thresh.dispose(),this._thresh=null,this},a.GreaterThanZero}(a1,ai,aE);var aD;aD=function(a){return a.GreaterThan=function(b){this.createInsOuts(2,0),this._param=this.input[0]=new a.Subtract(b),this.input[1]=this._param.input[1],this._gtz=this.output=new a.GreaterThanZero,this._param.connect(this._gtz)},a.extend(a.GreaterThan,a.Signal),a.GreaterThan.prototype.dispose=function(){return a.prototype.dispose.call(this),this._param.dispose(),this._param=null,this._gtz.dispose(),this._gtz=null,this},a.GreaterThan}(a1,an,aB);var af;af=function(a){return a.Abs=function(){this._abs=this.input=this.output=new a.WaveShaper(function(b){return 0===b?0:Math.abs(b)},127)},a.extend(a.Abs,a.SignalBase),a.Abs.prototype.dispose=function(){return a.prototype.dispose.call(this),this._abs.dispose(),this._abs=null,this},a.Abs}(a1,a2);var av;av=function(a){return a.Modulo=function(b){this.createInsOuts(1,0),this._shaper=new a.WaveShaper(Math.pow(2,16)),this._multiply=new a.Multiply,this._subtract=this.output=new a.Subtract,this._modSignal=new a.Signal(b),this.input.fan(this._shaper,this._subtract),this._modSignal.connect(this._multiply,0,0),this._shaper.connect(this._multiply,0,1),this._multiply.connect(this._subtract,0,1),this._setWaveShaper(b)},a.extend(a.Modulo,a.SignalBase),a.Modulo.prototype._setWaveShaper=function(b){this._shaper.setMap(function(d){var c=Math.floor((d+0.0001)/b);return c})},Object.defineProperty(a.Modulo.prototype,"value",{get:function(){return this._modSignal.value},set:function(b){this._modSignal.value=b,this._setWaveShaper(b)}}),a.Modulo.prototype.dispose=function(){return a.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this._multiply.dispose(),this._multiply=null,this._subtract.dispose(),this._subtract=null,this._modSignal.dispose(),this._modSignal=null,this},a.Modulo}(a1,a2,aE);var ay;ay=function(a){return a.Pow=function(b){this._exp=this.defaultArg(b,1),this._expScaler=this.input=this.output=new a.WaveShaper(this._expFunc(this._exp),8192)},a.extend(a.Pow,a.SignalBase),Object.defineProperty(a.Pow.prototype,"value",{get:function(){return this._exp},set:function(b){this._exp=b,this._expScaler.setMap(this._expFunc(this._exp))}}),a.Pow.prototype._expFunc=function(b){return function(c){return Math.pow(Math.abs(c),b)}},a.Pow.prototype.dispose=function(){return a.prototype.dispose.call(this),this._expScaler.dispose(),this._expScaler=null,this},a.Pow}(a1);var ap;ap=function(a){return a.AudioToGain=function(){this._norm=this.input=this.output=new a.WaveShaper(function(b){return(b+1)/2})},a.extend(a.AudioToGain,a.SignalBase),a.AudioToGain.prototype.dispose=function(){return a.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},a.AudioToGain}(a1,a2);var a6;a6=function(b){function c(h,j,g){var k=new h;return g._eval(j[0]).connect(k,0,0),g._eval(j[1]).connect(k,0,1),k}function a(h,j,g){var k=new h;return g._eval(j[0]).connect(k,0,0),k}function f(e){return e?parseFloat(e):void 0}function d(e){return e&&e.args?parseFloat(e.args):void 0}return b.Expr=function(){var h=this._replacements(Array.prototype.slice.call(arguments)),k=this._parseInputs(h);this._nodes=[],this.input=new Array(k);for(var g=0;k>g;g++){this.input[g]=this.context.createGain()}var m,l=this._parseTree(h);try{m=this._eval(l)}catch(j){throw this._disposeNodes(),new Error("Tone.Expr: Could evaluate expression: "+h)}this.output=m},b.extend(b.Expr,b.SignalBase),b.Expr._Expressions={value:{signal:{regexp:/^\d+\.\d+|^\d+/,method:function(h){var g=new b.Signal(f(h));return g}},input:{regexp:/^\$\d/,method:function(g,h){return h.input[f(g.substr(1))]}}},glue:{"(":{regexp:/^\(/},")":{regexp:/^\)/},",":{regexp:/^,/}},func:{abs:{regexp:/^abs/,method:a.bind(this,b.Abs)},mod:{regexp:/^mod/,method:function(j,g){var k=d(j[1]),h=new b.Modulo(k);return g._eval(j[0]).connect(h),h}},pow:{regexp:/^pow/,method:function(j,g){var k=d(j[1]),h=new b.Pow(k);return g._eval(j[0]).connect(h),h}},a2g:{regexp:/^a2g/,method:function(h,g){var j=new b.AudioToGain;return g._eval(h[0]).connect(j),j}}},binary:{"+":{regexp:/^\+/,precedence:1,method:c.bind(this,b.Add)},"-":{regexp:/^\-/,precedence:1,method:function(g,e){return 1===g.length?a(b.Negate,g,e):c(b.Subtract,g,e)}},"*":{regexp:/^\*/,precedence:0,method:c.bind(this,b.Multiply)}},unary:{"-":{regexp:/^\-/,method:a.bind(this,b.Negate)},"!":{regexp:/^\!/,method:a.bind(this,b.NOT)}}},b.Expr.prototype._parseInputs=function(h){var j=h.match(/\$\d/g),g=0;if(null!==j){for(var l=0;l<j.length;l++){var k=parseInt(j[l].substr(1))+1;g=Math.max(g,k)}}return g},b.Expr.prototype._replacements=function(h){for(var j=h.shift(),g=0;g<h.length;g++){j=j.replace(/\%/i,h[g])}return j},b.Expr.prototype._tokenize=function(j){function g(u){for(var p in b.Expr._Expressions){var w=b.Expr._Expressions[p];for(var v in w){var t=w[v],q=t.regexp,m=u.match(q);if(null!==m){return{type:p,value:m[0],method:t.method}}}}throw new SyntaxError("Tone.Expr: Unexpected token "+u)}for(var l=-1,k=[];j.length>0;){j=j.trim();var h=g(j);k.push(h),j=j.substr(h.value.length)}return{next:function(){return k[++l]},peek:function(){return k[l+1]}}},b.Expr.prototype._parseTree=function(m){function l(i,n){return !h(i)&&"glue"===i.type&&i.value===n}function k(z,u,B){var A=!1,y=b.Expr._Expressions[u];if(!h(z)){for(var x in y){var p=y[x];if(p.regexp.test(z.value)){if(h(B)){return !0}if(p.precedence===B){return !0}}}}return A}function j(o){h(o)&&(o=5);var p;p=0>o?g():j(o-1);for(var n=q.peek();k(n,"binary",o);){n=q.next(),p={operator:n.value,method:n.method,args:[p,j(o-1)]},n=q.peek()}return p}function g(){var i,n;return i=q.peek(),k(i,"unary")?(i=q.next(),n=g(),{operator:i.value,method:i.method,args:[n]}):w()}function w(){var i,n;if(i=q.peek(),h(i)){throw new SyntaxError("Tone.Expr: Unexpected termination of expression")}if("func"===i.type){return i=q.next(),t(i)}if("value"===i.type){return i=q.next(),{method:i.method,args:i.value}}if(l(i,"(")){if(q.next(),n=j(),i=q.next(),!l(i,")")){throw new SyntaxError("Expected )")}return n}throw new SyntaxError("Tone.Expr: Parse error, cannot process token "+i.value)}function t(i){var o,p=[];if(o=q.next(),!l(o,"(")){throw new SyntaxError('Tone.Expr: Expected ( in a function call "'+i.value+'"')}if(o=q.peek(),l(o,")")||(p=v()),o=q.next(),!l(o,")")){throw new SyntaxError('Tone.Expr: Expected ) in a function call "'+i.value+'"')}return{method:i.method,args:p,name:name}}function v(){for(var i,o,p=[];;){if(o=j(),h(o)){break}if(p.push(o),i=q.peek(),!l(i,",")){break}q.next()}return p}var q=this._tokenize(m),h=this.isUndef.bind(this);return j()},b.Expr.prototype._eval=function(g){if(!this.isUndef(g)){var h=g.method(g.args,this);return this._nodes.push(h),h}},b.Expr.prototype._disposeNodes=function(){for(var g=0;g<this._nodes.length;g++){var h=this._nodes[g];this.isFunction(h.dispose)?h.dispose():this.isFunction(h.disconnect)&&h.disconnect(),h=null,this._nodes[g]=null}this._nodes=null},b.Expr.prototype.dispose=function(){b.prototype.dispose.call(this),this._disposeNodes()},b.Expr}(a1,aQ,aB,aE,aD,an,af,aC,av,ay);var aa;aa=function(a){return a.EqualPowerGain=function(){this._eqPower=this.input=this.output=new a.WaveShaper(function(b){return Math.abs(b)<0.001?0:this.equalPowerScale(b)}.bind(this),4096)},a.extend(a.EqualPowerGain,a.SignalBase),a.EqualPowerGain.prototype.dispose=function(){return a.prototype.dispose.call(this),this._eqPower.dispose(),this._eqPower=null,this},a.EqualPowerGain}(a1);var ac;ac=function(a){return a.CrossFade=function(b){this.createInsOuts(2,1),this.a=this.input[0]=new a.Gain,this.b=this.input[1]=new a.Gain,this.fade=new a.Signal(this.defaultArg(b,0.5),a.Type.NormalRange),this._equalPowerA=new a.EqualPowerGain,this._equalPowerB=new a.EqualPowerGain,this._invert=new a.Expr("1 - $0"),this.a.connect(this.output),this.b.connect(this.output),this.fade.chain(this._equalPowerB,this.b.gain),this.fade.chain(this._invert,this._equalPowerA,this.a.gain),this._readOnly("fade")},a.extend(a.CrossFade),a.CrossFade.prototype.dispose=function(){return a.prototype.dispose.call(this),this._writable("fade"),this._equalPowerA.dispose(),this._equalPowerA=null,this._equalPowerB.dispose(),this._equalPowerB=null,this.fade.dispose(),this.fade=null,this._invert.dispose(),this._invert=null,this.a.dispose(),this.a=null,this.b.dispose(),this.b=null,this},a.CrossFade}(a1,ai,a6,aa);var ab;ab=function(){var b=bg,a=ac;return aT.Effect=function(){this.ac=b.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this._drywet=new a(1),this.wet=this.ac.createGain(),this.input.connect(this._drywet.a),this.wet.connect(this._drywet.b),this._drywet.connect(this.output),this.connect(),b.soundArray.push(this)},aT.Effect.prototype.amp=function(d,c,g){var c=c||0,g=g||0,f=b.audiocontext.currentTime,e=this.output.gain.value;this.output.gain.cancelScheduledValues(f),this.output.gain.linearRampToValueAtTime(e,f+g+0.001),this.output.gain.linearRampToValueAtTime(d,f+g+c+0.001)},aT.Effect.prototype.chain=function(){if(arguments.length>0){this.connect(arguments[0]);for(var c=1;c<arguments.length;c+=1){arguments[c-1].connect(arguments[c])}}return this},aT.Effect.prototype.drywet=function(c){return"undefined"!=typeof c&&(this._drywet.fade.value=c),this._drywet.fade.value},aT.Effect.prototype.connect=function(d){var c=d||aT.soundOut.input;this.output.connect(c.input?c.input:c)},aT.Effect.prototype.disconnect=function(){this.output&&this.output.disconnect()},aT.Effect.prototype.dispose=function(){var c=b.soundArray.indexOf(this);b.soundArray.splice(c,1),this.input&&(this.input.disconnect(),delete this.input),this.output&&(this.output.disconnect(),delete this.output),this._drywet&&(this._drywet.disconnect(),delete this._drywet),this.wet&&(this.wet.disconnect(),delete this.wet),this.ac=void 0},aT.Effect}(bg,ac);var aN;aN=function(){var a=ab;return aT.Filter=function(b){a.call(this),this.biquad=this.ac.createBiquadFilter(),this.input.connect(this.biquad),this.biquad.connect(this.wet),b&&this.setType(b),this._on=!0,this._untoggledType=this.biquad.type},aT.Filter.prototype=Object.create(a.prototype),aT.Filter.prototype.process=function(c,d,b,f){c.connect(this.input),this.set(d,b,f)},aT.Filter.prototype.set=function(c,d,b){c&&this.freq(c,b),d&&this.res(d,b)},aT.Filter.prototype.freq=function(c,d){var b=d||0;return 0>=c&&(c=1),"number"==typeof c?(this.biquad.frequency.cancelScheduledValues(this.ac.currentTime+0.01+b),this.biquad.frequency.exponentialRampToValueAtTime(c,this.ac.currentTime+0.02+b)):c&&c.connect(this.biquad.frequency),this.biquad.frequency.value},aT.Filter.prototype.res=function(c,d){var b=d||0;return"number"==typeof c?(this.biquad.Q.value=c,this.biquad.Q.cancelScheduledValues(this.ac.currentTime+0.01+b),this.biquad.Q.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):c&&c.connect(this.biquad.Q),this.biquad.Q.value},aT.Filter.prototype.gain=function(c,d){var b=d||0;return"number"==typeof c?(this.biquad.gain.value=c,this.biquad.gain.cancelScheduledValues(this.ac.currentTime+0.01+b),this.biquad.gain.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):c&&c.connect(this.biquad.gain),this.biquad.gain.value},aT.Filter.prototype.toggle=function(){return this._on=!this._on,this._on===!0?this.biquad.type=this._untoggledType:this._on===!1&&(this.biquad.type="allpass"),this._on},aT.Filter.prototype.setType=function(b){this.biquad.type=b,this._untoggledType=this.biquad.type},aT.Filter.prototype.dispose=function(){a.prototype.dispose.apply(this),this.biquad&&(this.biquad.disconnect(),delete this.biquad)},aT.LowPass=function(){aT.Filter.call(this,"lowpass")},aT.LowPass.prototype=Object.create(aT.Filter.prototype),aT.HighPass=function(){aT.Filter.call(this,"highpass")},aT.HighPass.prototype=Object.create(aT.Filter.prototype),aT.BandPass=function(){aT.Filter.call(this,"bandpass")},aT.BandPass.prototype=Object.create(aT.Filter.prototype),aT.Filter}(bg,ab);var ad;ad=function(){var b=aN,a=bg,c=function(e,d){b.call(this,"peaking"),this.disconnect(),this.set(e,d),this.biquad.gain.value=0,delete this.input,delete this.output,delete this._drywet,delete this.wet};return c.prototype=Object.create(b.prototype),c.prototype.amp=function(){console.warn("`amp()` is not available for p5.EQ bands. Use `.gain()`")},c.prototype.drywet=function(){console.warn("`drywet()` is not available for p5.EQ bands.")},c.prototype.connect=function(f){var d=f||aT.soundOut.input;this.biquad?this.biquad.connect(d.input?d.input:d):this.output.connect(d.input?d.input:d)},c.prototype.disconnect=function(){this.biquad&&this.biquad.disconnect()},c.prototype.dispose=function(){var d=a.soundArray.indexOf(this);a.soundArray.splice(d,1),this.disconnect(),delete this.biquad},c}(aN,bg);var ak;ak=function(){var b=ab,a=ad;return aT.EQ=function(d){b.call(this),d=3===d||8===d?d:3;var c;c=3===d?Math.pow(2,3):2,this.bands=[];for(var g,f,e=0;d>e;e++){e===d-1?(g=21000,f=0.01):0===e?(g=100,f=0.1):1===e?(g=3===d?360*c:360,f=1):(g=this.bands[e-1].freq()*c,f=1),this.bands[e]=this._newBand(g,f),e>0?this.bands[e-1].connect(this.bands[e].biquad):this.input.connect(this.bands[e].biquad)}this.bands[d-1].connect(this.output)},aT.EQ.prototype=Object.create(b.prototype),aT.EQ.prototype.process=function(c){c.connect(this.input)},aT.EQ.prototype.set=function(){if(arguments.length===2*this.bands.length){for(var c=0;c<arguments.length;c+=2){this.bands[c/2].freq(arguments[c]),this.bands[c/2].gain(arguments[c+1])}}else{console.error("Argument mismatch. .set() should be called with "+2*this.bands.length+" arguments. (one frequency and gain value pair for each band of the eq)")}},aT.EQ.prototype._newBand=function(c,d){return new a(c,d)},aT.EQ.prototype.dispose=function(){if(b.prototype.dispose.apply(this),this.bands){for(;this.bands.length>0;){delete this.bands.pop().dispose()}delete this.bands}},aT.EQ}(ab,ad);var aw;aw=function(){var a=ab;return aT.Panner3D=function(){a.call(this),this.panner=this.ac.createPanner(),this.panner.panningModel="HRTF",this.panner.distanceModel="linear",this.panner.connect(this.output),this.input.connect(this.panner)},aT.Panner3D.prototype=Object.create(a.prototype),aT.Panner3D.prototype.process=function(b){b.connect(this.input)},aT.Panner3D.prototype.set=function(c,d,b,f){return this.positionX(c,f),this.positionY(d,f),this.positionZ(b,f),[this.panner.positionX.value,this.panner.positionY.value,this.panner.positionZ.value]},aT.Panner3D.prototype.positionX=function(c,d){var b=d||0;return"number"==typeof c?(this.panner.positionX.value=c,this.panner.positionX.cancelScheduledValues(this.ac.currentTime+0.01+b),this.panner.positionX.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):c&&c.connect(this.panner.positionX),this.panner.positionX.value},aT.Panner3D.prototype.positionY=function(c,d){var b=d||0;return"number"==typeof c?(this.panner.positionY.value=c,this.panner.positionY.cancelScheduledValues(this.ac.currentTime+0.01+b),this.panner.positionY.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):c&&c.connect(this.panner.positionY),this.panner.positionY.value},aT.Panner3D.prototype.positionZ=function(c,d){var b=d||0;return"number"==typeof c?(this.panner.positionZ.value=c,this.panner.positionZ.cancelScheduledValues(this.ac.currentTime+0.01+b),this.panner.positionZ.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):c&&c.connect(this.panner.positionZ),this.panner.positionZ.value},aT.Panner3D.prototype.orient=function(c,d,b,f){return this.orientX(c,f),this.orientY(d,f),this.orientZ(b,f),[this.panner.orientationX.value,this.panner.orientationY.value,this.panner.orientationZ.value]},aT.Panner3D.prototype.orientX=function(c,d){var b=d||0;return"number"==typeof c?(this.panner.orientationX.value=c,this.panner.orientationX.cancelScheduledValues(this.ac.currentTime+0.01+b),this.panner.orientationX.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):c&&c.connect(this.panner.orientationX),this.panner.orientationX.value},aT.Panner3D.prototype.orientY=function(c,d){var b=d||0;return"number"==typeof c?(this.panner.orientationY.value=c,this.panner.orientationY.cancelScheduledValues(this.ac.currentTime+0.01+b),this.panner.orientationY.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):c&&c.connect(this.panner.orientationY),this.panner.orientationY.value},aT.Panner3D.prototype.orientZ=function(c,d){var b=d||0;return"number"==typeof c?(this.panner.orientationZ.value=c,this.panner.orientationZ.cancelScheduledValues(this.ac.currentTime+0.01+b),this.panner.orientationZ.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):c&&c.connect(this.panner.orientationZ),this.panner.orientationZ.value},aT.Panner3D.prototype.setFalloff=function(b,c){this.maxDist(b),this.rolloff(c)},aT.Panner3D.prototype.maxDist=function(b){return"number"==typeof b&&(this.panner.maxDistance=b),this.panner.maxDistance},aT.Panner3D.prototype.rolloff=function(b){return"number"==typeof b&&(this.panner.rolloffFactor=b),this.panner.rolloffFactor},aT.Panner3D.dispose=function(){a.prototype.dispose.apply(this),this.panner&&(this.panner.disconnect(),delete this.panner)},aT.Panner3D}(bg,ab);var aM;aM=function(){var a=bg;return aT.Listener3D=function(b){this.ac=a.audiocontext,this.listener=this.ac.listener},aT.Listener3D.prototype.process=function(b){b.connect(this.input)},aT.Listener3D.prototype.position=function(c,d,b,f){return this.positionX(c,f),this.positionY(d,f),this.positionZ(b,f),[this.listener.positionX.value,this.listener.positionY.value,this.listener.positionZ.value]},aT.Listener3D.prototype.positionX=function(c,d){var b=d||0;return"number"==typeof c?(this.listener.positionX.value=c,this.listener.positionX.cancelScheduledValues(this.ac.currentTime+0.01+b),this.listener.positionX.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):c&&c.connect(this.listener.positionX),this.listener.positionX.value},aT.Listener3D.prototype.positionY=function(c,d){var b=d||0;return"number"==typeof c?(this.listener.positionY.value=c,this.listener.positionY.cancelScheduledValues(this.ac.currentTime+0.01+b),this.listener.positionY.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):c&&c.connect(this.listener.positionY),this.listener.positionY.value},aT.Listener3D.prototype.positionZ=function(c,d){var b=d||0;return"number"==typeof c?(this.listener.positionZ.value=c,this.listener.positionZ.cancelScheduledValues(this.ac.currentTime+0.01+b),this.listener.positionZ.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):c&&c.connect(this.listener.positionZ),this.listener.positionZ.value},aT.Listener3D.prototype.orient=function(c,g,b,j,h,f,d){return 3===arguments.length||4===arguments.length?(d=arguments[3],this.orientForward(c,g,b,d)):(6===arguments.length||7===arguments)&&(this.orientForward(c,g,b),this.orientUp(j,h,f,d)),[this.listener.forwardX.value,this.listener.forwardY.value,this.listener.forwardZ.value,this.listener.upX.value,this.listener.upY.value,this.listener.upZ.value]},aT.Listener3D.prototype.orientForward=function(c,d,b,f){return this.forwardX(c,f),this.forwardY(d,f),this.forwardZ(b,f),[this.listener.forwardX,this.listener.forwardY,this.listener.forwardZ]},aT.Listener3D.prototype.orientUp=function(c,d,b,f){return this.upX(c,f),this.upY(d,f),this.upZ(b,f),[this.listener.upX,this.listener.upY,this.listener.upZ]},aT.Listener3D.prototype.forwardX=function(c,d){var b=d||0;return"number"==typeof c?(this.listener.forwardX.value=c,this.listener.forwardX.cancelScheduledValues(this.ac.currentTime+0.01+b),this.listener.forwardX.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):c&&c.connect(this.listener.forwardX),this.listener.forwardX.value},aT.Listener3D.prototype.forwardY=function(c,d){var b=d||0;return"number"==typeof c?(this.listener.forwardY.value=c,this.listener.forwardY.cancelScheduledValues(this.ac.currentTime+0.01+b),this.listener.forwardY.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):c&&c.connect(this.listener.forwardY),this.listener.forwardY.value},aT.Listener3D.prototype.forwardZ=function(c,d){var b=d||0;return"number"==typeof c?(this.listener.forwardZ.value=c,this.listener.forwardZ.cancelScheduledValues(this.ac.currentTime+0.01+b),this.listener.forwardZ.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):c&&c.connect(this.listener.forwardZ),this.listener.forwardZ.value},aT.Listener3D.prototype.upX=function(c,d){var b=d||0;return"number"==typeof c?(this.listener.upX.value=c,this.listener.upX.cancelScheduledValues(this.ac.currentTime+0.01+b),this.listener.upX.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):c&&c.connect(this.listener.upX),this.listener.upX.value},aT.Listener3D.prototype.upY=function(c,d){var b=d||0;return"number"==typeof c?(this.listener.upY.value=c,this.listener.upY.cancelScheduledValues(this.ac.currentTime+0.01+b),this.listener.upY.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):c&&c.connect(this.listener.upY),this.listener.upY.value},aT.Listener3D.prototype.upZ=function(c,d){var b=d||0;return"number"==typeof c?(this.listener.upZ.value=c,this.listener.upZ.cancelScheduledValues(this.ac.currentTime+0.01+b),this.listener.upZ.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):c&&c.connect(this.listener.upZ),this.listener.upZ.value},aT.Listener3D}(bg,ab);var ar;ar=function(){var b=aN,a=ab;aT.Delay=function(){a.call(this),this._split=this.ac.createChannelSplitter(2),this._merge=this.ac.createChannelMerger(2),this._leftGain=this.ac.createGain(),this._rightGain=this.ac.createGain(),this.leftDelay=this.ac.createDelay(),this.rightDelay=this.ac.createDelay(),this._leftFilter=new b,this._rightFilter=new b,this._leftFilter.disconnect(),this._rightFilter.disconnect(),this._leftFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime),this._rightFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime),this._leftFilter.biquad.Q.setValueAtTime(0.3,this.ac.currentTime),this._rightFilter.biquad.Q.setValueAtTime(0.3,this.ac.currentTime),this.input.connect(this._split),this.leftDelay.connect(this._leftGain),this.rightDelay.connect(this._rightGain),this._leftGain.connect(this._leftFilter.input),this._rightGain.connect(this._rightFilter.input),this._merge.connect(this.wet),this._leftFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime),this._rightFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime),this.setType(0),this._maxDelay=this.leftDelay.delayTime.maxValue,this.feedback(0.5)},aT.Delay.prototype=Object.create(a.prototype),aT.Delay.prototype.process=function(d,g,c,j){var h=c||0,f=g||0;if(h>=1){throw new Error("Feedback value will force a positive feedback loop.")}if(f>=this._maxDelay){throw new Error("Delay Time exceeds maximum delay time of "+this._maxDelay+" second.")}d.connect(this.input),this.leftDelay.delayTime.setValueAtTime(f,this.ac.currentTime),this.rightDelay.delayTime.setValueAtTime(f,this.ac.currentTime),this._leftGain.gain.value=h,this._rightGain.gain.value=h,j&&(this._leftFilter.freq(j),this._rightFilter.freq(j))},aT.Delay.prototype.delayTime=function(c){"number"!=typeof c?(c.connect(this.leftDelay.delayTime),c.connect(this.rightDelay.delayTime)):(this.leftDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.rightDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.leftDelay.delayTime.linearRampToValueAtTime(c,this.ac.currentTime),this.rightDelay.delayTime.linearRampToValueAtTime(c,this.ac.currentTime))},aT.Delay.prototype.feedback=function(c){if(c&&"number"!=typeof c){c.connect(this._leftGain.gain),c.connect(this._rightGain.gain)}else{if(c>=1){throw new Error("Feedback value will force a positive feedback loop.")}"number"==typeof c&&(this._leftGain.gain.value=c,this._rightGain.gain.value=c)}return this._leftGain.gain.value},aT.Delay.prototype.filter=function(c,d){this._leftFilter.set(c,d),this._rightFilter.set(c,d)},aT.Delay.prototype.setType=function(c){switch(1===c&&(c="pingPong"),this._split.disconnect(),this._leftFilter.disconnect(),this._rightFilter.disconnect(),this._split.connect(this.leftDelay,0),this._split.connect(this.rightDelay,1),c){case"pingPong":this._rightFilter.setType(this._leftFilter.biquad.type),this._leftFilter.output.connect(this._merge,0,0),this._rightFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.rightDelay),this._rightFilter.output.connect(this.leftDelay);break;default:this._leftFilter.output.connect(this._merge,0,0),this._rightFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.leftDelay),this._rightFilter.output.connect(this.rightDelay)}},aT.Delay.prototype.dispose=function(){a.prototype.dispose.apply(this),this._split.disconnect(),this._leftFilter.dispose(),this._rightFilter.dispose(),this._merge.disconnect(),this._leftGain.disconnect(),this._rightGain.disconnect(),this.leftDelay.disconnect(),this.rightDelay.disconnect(),this._split=void 0,this._leftFilter=void 0,this._rightFilter=void 0,this._merge=void 0,this._leftGain=void 0,this._rightGain=void 0,this.leftDelay=void 0,this.rightDelay=void 0}}(aN,ab);var aq;aq=function(){var b=be,a=ab;aT.Reverb=function(){a.call(this),this._initConvolverNode(),this.input.gain.value=0.5,this._seconds=3,this._decay=2,this._reverse=!1,this._buildImpulse()},aT.Reverb.prototype=Object.create(a.prototype),aT.Reverb.prototype._initConvolverNode=function(){this.convolverNode=this.ac.createConvolver(),this.input.connect(this.convolverNode),this.convolverNode.connect(this.wet)},aT.Reverb.prototype._teardownConvolverNode=function(){this.convolverNode&&(this.convolverNode.disconnect(),delete this.convolverNode)},aT.Reverb.prototype._setBuffer=function(c){this._teardownConvolverNode(),this._initConvolverNode(),this.convolverNode.buffer=c},aT.Reverb.prototype.process=function(d,f,c,h){d.connect(this.input);var g=!1;f&&(this._seconds=f,g=!0),c&&(this._decay=c),h&&(this._reverse=h),g&&this._buildImpulse()},aT.Reverb.prototype.set=function(d,f,c){var g=!1;d&&(this._seconds=d,g=!0),f&&(this._decay=f),c&&(this._reverse=c),g&&this._buildImpulse()},aT.Reverb.prototype._buildImpulse=function(){var f,j,d=this.ac.sampleRate,l=d*this._seconds,k=this._decay,h=this.ac.createBuffer(2,l,d),g=h.getChannelData(0),c=h.getChannelData(1);for(j=0;l>j;j++){f=this._reverse?l-j:j,g[j]=(2*Math.random()-1)*Math.pow(1-f/l,k),c[j]=(2*Math.random()-1)*Math.pow(1-f/l,k)}this._setBuffer(h)},aT.Reverb.prototype.dispose=function(){a.prototype.dispose.apply(this),this._teardownConvolverNode()},aT.Convolver=function(d,c,f){aT.Reverb.call(this),this._initConvolverNode(),this.input.gain.value=0.5,d?(this.impulses=[],this._loadBuffer(d,c,f)):(this._seconds=3,this._decay=2,this._reverse=!1,this._buildImpulse())},aT.Convolver.prototype=Object.create(aT.Reverb.prototype),aT.prototype.registerPreloadMethod("createConvolver",aT.prototype),aT.prototype.createConvolver=function(f,c,h){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var g=this,d=new aT.Convolver(f,function(e){"function"==typeof c&&c(e),"function"==typeof g._decrementPreload&&g._decrementPreload()},h);return d.impulses=[],d},aT.Convolver.prototype._loadBuffer=function(e,j,h){var e=aT.prototype._checkFileFormats(e),g=this,f=(new Error).stack,c=aT.prototype.getAudioContext(),d=new XMLHttpRequest;d.open("GET",e,!0),d.responseType="arraybuffer",d.onload=function(){if(200===d.status){c.decodeAudioData(d.response,function(l){var m={},n=e.split("/");m.name=n[n.length-1],m.audioBuffer=l,g.impulses.push(m),g._setBuffer(m.audioBuffer),j&&j(m)},function(){var m=new b("decodeAudioData",f,g.url),l="AudioContext error at decodeAudioData for "+g.url;h?(m.msg=l,h(m)):console.error(l+"\n The error stack trace includes: \n"+m.stack)})}else{var i=new b("loadConvolver",f,g.url),k="Unable to load "+g.url+". The request status was: "+d.status+" ("+d.statusText+")";h?(i.message=k,h(i)):console.error(k+"\n The error stack trace includes: \n"+i.stack)}},d.onerror=function(){var l=new b("loadConvolver",f,g.url),k="There was no response from the server at "+g.url+". Check the url and internet connectivity.";h?(l.message=k,h(l)):console.error(k+"\n The error stack trace includes: \n"+l.stack)},d.send()},aT.Convolver.prototype.set=null,aT.Convolver.prototype.process=function(c){c.connect(this.input)},aT.Convolver.prototype.impulses=[],aT.Convolver.prototype.addImpulse=function(d,f,c){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this._loadBuffer(d,f,c)},aT.Convolver.prototype.resetImpulse=function(d,f,c){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this.impulses=[],this._loadBuffer(d,f,c)},aT.Convolver.prototype.toggleImpulse=function(c){if("number"==typeof c&&c<this.impulses.length&&this._setBuffer(this.impulses[c].audioBuffer),"string"==typeof c){for(var d=0;d<this.impulses.length;d++){if(this.impulses[d].name===c){this._setBuffer(this.impulses[d].audioBuffer);break}}}},aT.Convolver.prototype.dispose=function(){aT.Reverb.prototype.dispose.apply(this);for(var c in this.impulses){this.impulses[c]&&(this.impulses[c]=null)}}}(be,ab);var ba;ba=function(a){return a.TimelineState=function(b){a.Timeline.call(this),this._initial=b},a.extend(a.TimelineState,a.Timeline),a.TimelineState.prototype.getValueAtTime=function(b){var c=this.get(b);return null!==c?c.state:this._initial},a.TimelineState.prototype.setStateAtTime=function(b,c){this.add({state:b,time:c})},a.TimelineState}(a1,az);var aX;aX=function(a){return a.Clock=function(){a.Emitter.call(this);var b=this.optionsObject(arguments,["callback","frequency"],a.Clock.defaults);this.callback=b.callback,this._nextTick=0,this._lastState=a.State.Stopped,this.frequency=new a.TimelineSignal(b.frequency,a.Type.Frequency),this._readOnly("frequency"),this.ticks=0,this._state=new a.TimelineState(a.State.Stopped),this._boundLoop=this._loop.bind(this),this.context.on("tick",this._boundLoop)},a.extend(a.Clock,a.Emitter),a.Clock.defaults={callback:a.noOp,frequency:1,lookAhead:"auto"},Object.defineProperty(a.Clock.prototype,"state",{get:function(){return this._state.getValueAtTime(this.now())}}),a.Clock.prototype.start=function(c,b){return c=this.toSeconds(c),this._state.getValueAtTime(c)!==a.State.Started&&this._state.add({state:a.State.Started,time:c,offset:b}),this},a.Clock.prototype.stop=function(b){return b=this.toSeconds(b),this._state.cancel(b),this._state.setStateAtTime(a.State.Stopped,b),this},a.Clock.prototype.pause=function(b){return b=this.toSeconds(b),this._state.getValueAtTime(b)===a.State.Started&&this._state.setStateAtTime(a.State.Paused,b),this},a.Clock.prototype._loop=function(){for(var h=this.now(),d=this.context.lookAhead,k=this.context.updateInterval,j=2*this.context.lag,g=h+d+k+j;g>this._nextTick&&this._state;){var f=this._state.getValueAtTime(this._nextTick);if(f!==this._lastState){this._lastState=f;var b=this._state.get(this._nextTick);f===a.State.Started?(this._nextTick=b.time,this.isUndef(b.offset)||(this.ticks=b.offset),this.emit("start",b.time,this.ticks)):f===a.State.Stopped?(this.ticks=0,this.emit("stop",b.time)):f===a.State.Paused&&this.emit("pause",b.time)}var c=this._nextTick;this.frequency&&(this._nextTick+=1/this.frequency.getValueAtTime(this._nextTick),f===a.State.Started&&(this.callback(c),this.ticks++))}},a.Clock.prototype.getStateAtTime=function(b){return b=this.toSeconds(b),this._state.getValueAtTime(b)},a.Clock.prototype.dispose=function(){a.Emitter.prototype.dispose.call(this),this.context.off("tick",this._boundLoop),this._writable("frequency"),this.frequency.dispose(),this.frequency=null,this._boundLoop=null,this._nextTick=1/0,this.callback=null,this._state.dispose(),this._state=null},a.Clock}(a1,aW,ba,aZ);var aH;aH=function(){var b=bg,a=aX;aT.Metro=function(){this.clock=new a({callback:this.ontick.bind(this)}),this.syncedParts=[],this.bpm=120,this._init(),this.prevTick=0,this.tatumTime=0,this.tickCallback=function(){}},aT.Metro.prototype.ontick=function(d){var c=d-this.prevTick,f=d-b.audiocontext.currentTime;if(!(c-this.tatumTime<=-0.02)){this.prevTick=d;var e=this;this.syncedParts.forEach(function(g){g.isPlaying&&(g.incrementStep(f),g.phrases.forEach(function(j){var k=j.sequence,h=e.metroTicks%k.length;0!==k[h]&&(e.metroTicks<k.length||!j.looping)&&j.callback(f,k[h])}))}),this.metroTicks+=1,this.tickCallback(f)}},aT.Metro.prototype.setBPM=function(d,c){var f=60/(d*this.tatums),e=b.audiocontext.currentTime;this.tatumTime=f;var c=c||0;this.clock.frequency.setValueAtTime(this.clock.frequency.value,e),this.clock.frequency.linearRampToValueAtTime(d,e+c),this.bpm=d},aT.Metro.prototype.getBPM=function(){return this.clock.getRate()/this.tatums*60},aT.Metro.prototype._init=function(){this.metroTicks=0},aT.Metro.prototype.resetSync=function(c){this.syncedParts=[c]},aT.Metro.prototype.pushSync=function(c){this.syncedParts.push(c)},aT.Metro.prototype.start=function(d){var c=d||0,e=b.audiocontext.currentTime;this.clock.start(e+c),this.setBPM(this.bpm)},aT.Metro.prototype.stop=function(d){var c=d||0,e=b.audiocontext.currentTime;this.clock.stop(e+c)},aT.Metro.prototype.beatLength=function(c){this.tatums=1/c/4}}(bg,aX);var a5;a5=function(){function b(d){d.currentPart++,d.currentPart>=d.parts.length?(d.scoreStep=0,d.onended()):(d.scoreStep=0,d.parts[d.currentPart-1].stop(),d.parts[d.currentPart].start())}var a=bg,c=120;aT.prototype.setBPM=function(d,f){c=d;for(var g in a.parts){a.parts[g]&&a.parts[g].setBPM(d,f)}},aT.Phrase=function(f,g,d){this.phraseStep=0,this.name=f,this.callback=g,this.sequence=d},aT.Part=function(d,f){this.length=d||0,this.partStep=0,this.phrases=[],this.isPlaying=!1,this.noLoop(),this.tatums=f||0.0625,this.metro=new aT.Metro,this.metro._init(),this.metro.beatLength(this.tatums),this.metro.setBPM(c),a.parts.push(this),this.callback=function(){}},aT.Part.prototype.setBPM=function(d,f){this.metro.setBPM(d,f)},aT.Part.prototype.getBPM=function(){return this.metro.getBPM()},aT.Part.prototype.start=function(d){if(!this.isPlaying){this.isPlaying=!0,this.metro.resetSync(this);var f=d||0;this.metro.start(f)}},aT.Part.prototype.loop=function(d){this.looping=!0,this.onended=function(){this.partStep=0};var f=d||0;this.start(f)},aT.Part.prototype.noLoop=function(){this.looping=!1,this.onended=function(){this.stop()}},aT.Part.prototype.stop=function(d){this.partStep=0,this.pause(d)},aT.Part.prototype.pause=function(d){this.isPlaying=!1;var f=d||0;this.metro.stop(f)},aT.Part.prototype.addPhrase=function(f,d,h){var g;if(3===arguments.length){g=new aT.Phrase(f,d,h)}else{if(!(arguments[0] instanceof aT.Phrase)){throw"invalid input. addPhrase accepts name, callback, array or a p5.Phrase"}g=arguments[0]}this.phrases.push(g),g.sequence.length>this.length&&(this.length=g.sequence.length)},aT.Part.prototype.removePhrase=function(d){for(var f in this.phrases){this.phrases[f].name===d&&this.phrases.splice(f,1)}},aT.Part.prototype.getPhrase=function(d){for(var f in this.phrases){if(this.phrases[f].name===d){return this.phrases[f]}}},aT.Part.prototype.replaceSequence=function(f,g){for(var d in this.phrases){this.phrases[d].name===f&&(this.phrases[d].sequence=g)}},aT.Part.prototype.incrementStep=function(d){this.partStep<this.length-1?(this.callback(d),this.partStep+=1):this.looping||this.partStep!==this.length-1||(console.log("done"),this.onended())},aT.Part.prototype.onStep=function(d){this.callback=d},aT.Score=function(){this.parts=[],this.currentPart=0;var e=this;for(var d in arguments){arguments[d]&&this.parts[d]&&(this.parts[d]=arguments[d],this.parts[d].nextPart=this.parts[d+1],this.parts[d].onended=function(){e.resetPart(d),b(e)})}this.looping=!1},aT.Score.prototype.onended=function(){this.looping?this.parts[0].start():this.parts[this.parts.length-1].onended=function(){this.stop(),this.resetParts()},this.currentPart=0},aT.Score.prototype.start=function(){this.parts[this.currentPart].start(),this.scoreStep=0},aT.Score.prototype.stop=function(){this.parts[this.currentPart].stop(),this.currentPart=0,this.scoreStep=0},aT.Score.prototype.pause=function(){this.parts[this.currentPart].stop()},aT.Score.prototype.loop=function(){this.looping=!0,this.start()},aT.Score.prototype.noLoop=function(){this.looping=!1},aT.Score.prototype.resetParts=function(){var d=this;this.parts.forEach(function(f){d.resetParts[f]})},aT.Score.prototype.resetPart=function(d){this.parts[d].stop(),this.parts[d].partStep=0;for(var f in this.parts[d].phrases){this.parts[d]&&(this.parts[d].phrases[f].phraseStep=0)}},aT.Score.prototype.setBPM=function(f,g){for(var d in this.parts){this.parts[d]&&this.parts[d].setBPM(f,g)}}}(bg);var aJ;aJ=function(){var b=bg,a=aX;return aT.SoundLoop=function(c,e){this.callback=c,this.musicalTimeMode="number"==typeof this._interval?!1:!0,this._interval=e||1,this._timeSignature=4,this._bpm=60,this.isPlaying=!1,this.maxIterations=1/0;var d=this;this.clock=new a({callback:function(g){var f=g-b.audiocontext.currentTime;f>0&&d.iterations<=d.maxIterations&&d.callback(f)},frequency:this._calcFreq()})},aT.SoundLoop.prototype.start=function(d){var c=d||0,e=b.audiocontext.currentTime;this.isPlaying||(this.clock.start(e+c),this.isPlaying=!0)},aT.SoundLoop.prototype.stop=function(d){var c=d||0,e=b.audiocontext.currentTime;this.isPlaying&&(this.clock.stop(e+c),this.isPlaying=!1)},aT.SoundLoop.prototype.pause=function(d){var c=d||0,e=b.audiocontext.currentTime;this.isPlaying&&(this.clock.pause(e+c),this.isPlaying=!1)},aT.SoundLoop.prototype.syncedStart=function(d,c){var g=c||0,f=b.audiocontext.currentTime;if(d.isPlaying){if(d.isPlaying){var e=d.clock._nextTick-b.audiocontext.currentTime;this.clock.start(f+e),this.isPlaying=!0}}else{d.clock.start(f+g),d.isPlaying=!0,this.clock.start(f+g),this.isPlaying=!0}},aT.SoundLoop.prototype._update=function(){this.clock.frequency.value=this._calcFreq()},aT.SoundLoop.prototype._calcFreq=function(){return"number"==typeof this._interval?(this.musicalTimeMode=!1,1/this._interval):"string"==typeof this._interval?(this.musicalTimeMode=!0,this._bpm/60/this._convertNotation(this._interval)*(this._timeSignature/4)):void 0},aT.SoundLoop.prototype._convertNotation=function(c){var d=c.slice(-1);switch(c=Number(c.slice(0,-1)),d){case"m":return this._measure(c);case"n":return this._note(c);default:console.warn("Specified interval is not formatted correctly. See Tone.js timing reference for more info: https://github.com/Tonejs/Tone.js/wiki/Time")}},aT.SoundLoop.prototype._measure=function(c){return c*this._timeSignature},aT.SoundLoop.prototype._note=function(c){return this._timeSignature/c},Object.defineProperty(aT.SoundLoop.prototype,"bpm",{get:function(){return this._bpm},set:function(c){this.musicalTimeMode||console.warn('Changing the BPM in "seconds" mode has no effect. BPM is only relevant in musicalTimeMode when the interval is specified as a string ("2n", "4n", "1m"...etc)'),this._bpm=c,this._update()}}),Object.defineProperty(aT.SoundLoop.prototype,"timeSignature",{get:function(){return this._timeSignature},set:function(c){this.musicalTimeMode||console.warn('Changing the timeSignature in "seconds" mode has no effect. BPM is only relevant in musicalTimeMode when the interval is specified as a string ("2n", "4n", "1m"...etc)'),this._timeSignature=c,this._update()}}),Object.defineProperty(aT.SoundLoop.prototype,"interval",{get:function(){return this._interval},set:function(c){this.musicalTimeMode="Number"==typeof c?!1:!0,this._interval=c,this._update()}}),Object.defineProperty(aT.SoundLoop.prototype,"iterations",{get:function(){return this.clock.ticks}}),aT.SoundLoop}(bg,aX);var aK;aK=function(){var a=ab;return aT.Compressor=function(){a.call(this),this.compressor=this.ac.createDynamicsCompressor(),this.input.connect(this.compressor),this.compressor.connect(this.wet)},aT.Compressor.prototype=Object.create(a.prototype),aT.Compressor.prototype.process=function(c,f,b,h,g,d){c.connect(this.input),this.set(f,b,h,g,d)},aT.Compressor.prototype.set=function(c,d,b,g,f){"undefined"!=typeof c&&this.attack(c),"undefined"!=typeof d&&this.knee(d),"undefined"!=typeof b&&this.ratio(b),"undefined"!=typeof g&&this.threshold(g),"undefined"!=typeof f&&this.release(f)},aT.Compressor.prototype.attack=function(c,d){var b=d||0;return"number"==typeof c?(this.compressor.attack.value=c,this.compressor.attack.cancelScheduledValues(this.ac.currentTime+0.01+b),this.compressor.attack.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):"undefined"!=typeof c&&c.connect(this.compressor.attack),this.compressor.attack.value},aT.Compressor.prototype.knee=function(c,d){var b=d||0;return"number"==typeof c?(this.compressor.knee.value=c,this.compressor.knee.cancelScheduledValues(this.ac.currentTime+0.01+b),this.compressor.knee.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):"undefined"!=typeof c&&c.connect(this.compressor.knee),this.compressor.knee.value},aT.Compressor.prototype.ratio=function(c,d){var b=d||0;return"number"==typeof c?(this.compressor.ratio.value=c,this.compressor.ratio.cancelScheduledValues(this.ac.currentTime+0.01+b),this.compressor.ratio.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):"undefined"!=typeof c&&c.connect(this.compressor.ratio),this.compressor.ratio.value},aT.Compressor.prototype.threshold=function(c,d){var b=d||0;return"number"==typeof c?(this.compressor.threshold.value=c,this.compressor.threshold.cancelScheduledValues(this.ac.currentTime+0.01+b),this.compressor.threshold.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):"undefined"!=typeof c&&c.connect(this.compressor.threshold),this.compressor.threshold.value},aT.Compressor.prototype.release=function(c,d){var b=d||0;return"number"==typeof c?(this.compressor.release.value=c,this.compressor.release.cancelScheduledValues(this.ac.currentTime+0.01+b),this.compressor.release.linearRampToValueAtTime(c,this.ac.currentTime+0.02+b)):"undefined"!=typeof number&&c.connect(this.compressor.release),this.compressor.release.value},aT.Compressor.prototype.reduction=function(){return this.compressor.reduction.value},aT.Compressor.prototype.dispose=function(){a.prototype.dispose.apply(this),this.compressor&&(this.compressor.disconnect(),delete this.compressor)},aT.Compressor}(bg,ab,be);var ax;ax=function(){var b=bg,a=aS.convertToWav,c=b.audiocontext;aT.SoundRecorder=function(){this.input=c.createGain(),this.output=c.createGain(),this.recording=!1,this.bufferSize=1024,this._channels=2,this._clear(),this._jsNode=c.createScriptProcessor(this.bufferSize,this._channels,2),this._jsNode.onaudioprocess=this._audioprocess.bind(this),this._callback=function(){},this._jsNode.connect(aT.soundOut._silentNode),this.setInput(),b.soundArray.push(this)},aT.SoundRecorder.prototype.setInput=function(d){this.input.disconnect(),this.input=null,this.input=c.createGain(),this.input.connect(this._jsNode),this.input.connect(this.output),d?d.connect(this.input):aT.soundOut.output.connect(this.input)},aT.SoundRecorder.prototype.record=function(f,g,d){this.recording=!0,g&&(this.sampleLimit=Math.round(g*c.sampleRate)),f&&d?this._callback=function(){this.buffer=this._getBuffer(),f.setBuffer(this.buffer),d()}:f&&(this._callback=function(){this.buffer=this._getBuffer(),f.setBuffer(this.buffer)})},aT.SoundRecorder.prototype.stop=function(){this.recording=!1,this._callback(),this._clear()},aT.SoundRecorder.prototype._clear=function(){this._leftBuffers=[],this._rightBuffers=[],this.recordedSamples=0,this.sampleLimit=null},aT.SoundRecorder.prototype._audioprocess=function(f){if(this.recording!==!1&&this.recording===!0){if(this.sampleLimit&&this.recordedSamples>=this.sampleLimit){this.stop()}else{var g=f.inputBuffer.getChannelData(0),d=f.inputBuffer.getChannelData(1);this._leftBuffers.push(new Float32Array(g)),this._rightBuffers.push(new Float32Array(d)),this.recordedSamples+=this.bufferSize}}},aT.SoundRecorder.prototype._getBuffer=function(){var d=[];return d.push(this._mergeBuffers(this._leftBuffers)),d.push(this._mergeBuffers(this._rightBuffers)),d},aT.SoundRecorder.prototype._mergeBuffers=function(f){for(var h=new Float32Array(this.recordedSamples),d=0,k=f.length,j=0;k>j;j++){var g=f[j];h.set(g,d),d+=g.length}return h},aT.SoundRecorder.prototype.dispose=function(){this._clear();var d=b.soundArray.indexOf(this);b.soundArray.splice(d,1),this._callback=function(){},this.input&&this.input.disconnect(),this.input=null,this._jsNode=null},aT.prototype.saveSound=function(d,g){const f=a(d.buffer);aT.prototype.writeFile([f],g,"wav")}}(bg,aS);var ah;ah=function(){aT.PeakDetect=function(b,c,a,d){this.framesPerPeak=d||20,this.framesSinceLastPeak=0,this.decayRate=0.95,this.threshold=a||0.35,this.cutoff=0,this.cutoffMult=1.5,this.energy=0,this.penergy=0,this.currentValue=0,this.isDetected=!1,this.f1=b||40,this.f2=c||20000,this._onPeak=function(){}},aT.PeakDetect.prototype.update=function(a){var b=this.energy=a.getEnergy(this.f1,this.f2)/255;b>this.cutoff&&b>this.threshold&&b-this.penergy>0?(this._onPeak(),this.isDetected=!0,this.cutoff=b*this.cutoffMult,this.framesSinceLastPeak=0):(this.isDetected=!1,this.framesSinceLastPeak<=this.framesPerPeak?this.framesSinceLastPeak++:(this.cutoff*=this.decayRate,this.cutoff=Math.max(this.cutoff,this.threshold))),this.currentValue=b,this.penergy=b},aT.PeakDetect.prototype.onPeak=function(b,c){var a=this;a._onPeak=function(){b(a.energy,c)}}}();var aL;aL=function(){var a=bg;aT.Gain=function(){this.ac=a.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.input.gain.value=0.5,this.input.connect(this.output),a.soundArray.push(this)},aT.Gain.prototype.setInput=function(b){b.connect(this.input)},aT.Gain.prototype.connect=function(c){var b=c||aT.soundOut.input;this.output.connect(b.input?b.input:b)},aT.Gain.prototype.disconnect=function(){this.output&&this.output.disconnect()},aT.Gain.prototype.amp=function(c,b,f){var b=b||0,f=f||0,e=a.audiocontext.currentTime,d=this.output.gain.value;this.output.gain.cancelScheduledValues(e),this.output.gain.linearRampToValueAtTime(d,e+f),this.output.gain.linearRampToValueAtTime(c,e+f+b)},aT.Gain.prototype.dispose=function(){var b=a.soundArray.indexOf(this);a.soundArray.splice(b,1),this.output&&(this.output.disconnect(),delete this.output),this.input&&(this.input.disconnect(),delete this.input)}}(bg);var aF;aF=function(){var a=bg;return aT.AudioVoice=function(){this.ac=a.audiocontext,this.output=this.ac.createGain(),this.connect(),a.soundArray.push(this)},aT.AudioVoice.prototype.play=function(c,d,b,f){},aT.AudioVoice.prototype.triggerAttack=function(c,d,b){},aT.AudioVoice.prototype.triggerRelease=function(b){},aT.AudioVoice.prototype.amp=function(b,c){},aT.AudioVoice.prototype.connect=function(c){var b=c||a.input;this.output.connect(b.input?b.input:b)},aT.AudioVoice.prototype.disconnect=function(){this.output.disconnect()},aT.AudioVoice.prototype.dispose=function(){this.output&&(this.output.disconnect(),delete this.output)},aT.AudioVoice}(bg);var au;au=function(){var b=bg,a=aF,d=aS.noteToFreq,c=0.15;aT.MonoSynth=function(){a.call(this),this.oscillator=new aT.Oscillator,this.env=new aT.Envelope,this.env.setRange(1,0),this.env.setExp(!0),this.setADSR(0.02,0.25,0.05,0.35),this.oscillator.disconnect(),this.oscillator.connect(this.output),this.env.disconnect(),this.env.setInput(this.output.gain),this.oscillator.output.gain.value=1,this.oscillator.start(),this.connect(),b.soundArray.push(this)},aT.MonoSynth.prototype=Object.create(aT.AudioVoice.prototype),aT.MonoSynth.prototype.play=function(g,h,f,j){this.triggerAttack(g,h,~~f),this.triggerRelease(~~f+(j||c))},aT.MonoSynth.prototype.triggerAttack=function(g,j,f){var f=~~f,k=d(g),h=j||0.1;this.oscillator.freq(k,0,f),this.env.ramp(this.output.gain,f,h)},aT.MonoSynth.prototype.triggerRelease=function(e){var e=e||0;this.env.ramp(this.output.gain,e,0)},aT.MonoSynth.prototype.setADSR=function(g,h,f,j){this.env.setADSR(g,h,f,j)},Object.defineProperties(aT.MonoSynth.prototype,{attack:{get:function(){return this.env.aTime},set:function(e){this.env.setADSR(e,this.env.dTime,this.env.sPercent,this.env.rTime)}},decay:{get:function(){return this.env.dTime},set:function(e){this.env.setADSR(this.env.aTime,e,this.env.sPercent,this.env.rTime)}},sustain:{get:function(){return this.env.sPercent},set:function(e){this.env.setADSR(this.env.aTime,this.env.dTime,e,this.env.rTime)}},release:{get:function(){return this.env.rTime},set:function(e){this.env.setADSR(this.env.aTime,this.env.dTime,this.env.sPercent,e)}}}),aT.MonoSynth.prototype.amp=function(g,h){var f=h||0;return"undefined"!=typeof g&&this.oscillator.amp(g,f),this.oscillator.amp().value},aT.MonoSynth.prototype.connect=function(f){var e=f||b.input;this.output.connect(e.input?e.input:e)},aT.MonoSynth.prototype.disconnect=function(){this.output&&this.output.disconnect()},aT.MonoSynth.prototype.dispose=function(){a.prototype.dispose.apply(this),this.env&&this.env.dispose(),this.oscillator&&this.oscillator.dispose()}}(bg,aF,aS);var a0;a0=function(){var b=bg,a=aW,c=aS.noteToFreq;aT.PolySynth=function(e,d){this.audiovoices=[],this.notes={},this._newest=0,this._oldest=0,this.maxVoices=d||8,this.AudioVoice=void 0===e?aT.MonoSynth:e,this._voicesInUse=new a(0),this.output=b.audiocontext.createGain(),this.connect(),this._allocateVoices(),b.soundArray.push(this)},aT.PolySynth.prototype._allocateVoices=function(){for(var d=0;d<this.maxVoices;d++){this.audiovoices.push(new this.AudioVoice),this.audiovoices[d].disconnect(),this.audiovoices[d].connect(this.output)}},aT.PolySynth.prototype.play=function(f,g,d,h){var h=h||1;this.noteAttack(f,g,d),this.noteRelease(f,d+h)},aT.PolySynth.prototype.noteADSR=function(g,f,l,k,j,h){var d=b.audiocontext.currentTime,h=h||0,e=d+h;this.audiovoices[this.notes[g].getValueAtTime(e)].setADSR(f,l,k,j)},aT.PolySynth.prototype.setADSR=function(f,g,d,h){this.audiovoices.forEach(function(e){e.setADSR(f,g,d,h)})},aT.PolySynth.prototype.noteAttack=function(g,d,t){var n,t=~~t,q=b.audiocontext.currentTime+t,m=c(g),e=d||0.1;if(this.notes[m]&&null!==this.notes[m].getValueAtTime(q)&&this.noteRelease(m,0),this._voicesInUse.getValueAtTime(q)<this.maxVoices){n=Math.max(~~this._voicesInUse.getValueAtTime(q),0)}else{n=this._oldest;var j=aT.prototype.freqToMidi(this.audiovoices[this._oldest].oscillator.freq().value);this.noteRelease(j),this._oldest=(this._oldest+1)%(this.maxVoices-1)}this.notes[m]=new a,this.notes[m].setValueAtTime(n,q);var i=null===this._voicesInUse._searchBefore(q)?0:this._voicesInUse._searchBefore(q).value;if(this._voicesInUse.setValueAtTime(i+1,q),this._updateAfter(q,1),this._newest=n,"number"==typeof e){var k=1/this._voicesInUse.getValueAtTime(q)*2;e=e>k?k:e}this.audiovoices[n].triggerAttack(m,e,t)},aT.PolySynth.prototype._updateAfter=function(f,g){if(null!==this._voicesInUse._searchAfter(f)){this._voicesInUse._searchAfter(f).value+=g;var d=this._voicesInUse._searchAfter(f).time;this._updateAfter(d,g)}},aT.PolySynth.prototype.noteRelease=function(g,f){var k=b.audiocontext.currentTime,j=f||0,h=k+j;if(g){var d=c(g);if(this.notes[d]&&null!==this.notes[d].getValueAtTime(h)){var e=Math.max(~~this._voicesInUse.getValueAtTime(h).value,1);this._voicesInUse.setValueAtTime(e-1,h),e>0&&this._updateAfter(h,-1),this.audiovoices[this.notes[d].getValueAtTime(h)].triggerRelease(j),this.notes[d].dispose(),delete this.notes[d],this._newest=0===this._newest?0:(this._newest-1)%(this.maxVoices-1)}else{console.warn("Cannot release a note that is not already playing")}}else{this.audiovoices.forEach(function(i){i.triggerRelease(j)}),this._voicesInUse.setValueAtTime(0,h);for(var l in this.notes){this.notes[l].dispose(),delete this.notes[l]}}},aT.PolySynth.prototype.connect=function(e){var d=e||b.input;this.output.connect(d.input?d.input:d)},aT.PolySynth.prototype.disconnect=function(){this.output&&this.output.disconnect()},aT.PolySynth.prototype.dispose=function(){this.audiovoices.forEach(function(d){d.dispose()}),this.output&&(this.output.disconnect(),delete this.output)}}(bg,aW,aS);var aI;aI=function(){function b(d){for(var h,c="number"==typeof d?d:50,k=44100,j=new Float32Array(k),g=Math.PI/180,f=0;k>f;++f){h=2*f/k-1,j[f]=(3+c)*h*20*g/(Math.PI+c*Math.abs(h))}return j}var a=ab;aT.Distortion=function(e,d){if(a.call(this),"undefined"==typeof e&&(e=0.25),"number"!=typeof e){throw new Error("amount must be a number")}if("undefined"==typeof d&&(d="2x"),"string"!=typeof d){throw new Error("oversample must be a String")}var c=aT.prototype.map(e,0,1,0,2000);this.waveShaperNode=this.ac.createWaveShaper(),this.amount=c,this.waveShaperNode.curve=b(c),this.waveShaperNode.oversample=d,this.input.connect(this.waveShaperNode),this.waveShaperNode.connect(this.wet)},aT.Distortion.prototype=Object.create(a.prototype),aT.Distortion.prototype.process=function(d,f,c){d.connect(this.input),this.set(f,c)},aT.Distortion.prototype.set=function(c,e){if(c){var d=aT.prototype.map(c,0,1,0,2000);this.amount=d,this.waveShaperNode.curve=b(d)}e&&(this.waveShaperNode.oversample=e)},aT.Distortion.prototype.getAmount=function(){return this.amount},aT.Distortion.prototype.getOversample=function(){return this.waveShaperNode.oversample},aT.Distortion.prototype.dispose=function(){a.prototype.dispose.apply(this),this.waveShaperNode&&(this.waveShaperNode.disconnect(),this.waveShaperNode=null)}}(ab);var aG;aG=function(){var a=bg;return a}(bc,aU,bg,aS,be,aY,a8,a3,bb,a4,am,ao,aA,ae,aj,aN,ak,aw,aM,ar,aq,aH,a5,aJ,aK,ax,ah,aL,au,a0,aI,aF,au,a0)});