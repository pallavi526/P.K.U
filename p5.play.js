(function(a,b){if(typeof define==="function"&&define.amd){define("p5.play",["@code-dot-org/p5"],function(c){(b(c))})}else{if(typeof exports==="object"){b(require("@code-dot-org/p5"))}else{b(a.p5)}}}(this,function(B){var q=30;B.prototype.registerMethod("init",function s(){this.camera=new f(this,0,0,1);this.camera.init=false;this.angleMode(this.DEGREES);this.frameRate(q);this._defaultCanvasSize={width:400,height:400};var C=new Date();this._startTime=C.getTime();this._tempCanvas=document.createElement("canvas")});function i(D,C){Object.defineProperty(B.prototype,D,{configurable:true,enumerable:true,get:function(){var E=(this instanceof B&&!this._isGlobal)?this:window;if(typeof(E._p5PlayProperties)==="undefined"){E._p5PlayProperties={}}if(!(D in E._p5PlayProperties)){E._p5PlayProperties[D]=C.call(E)}return E._p5PlayProperties[D]}})}function v(C){if(typeof(C)!=="function"){throw new Error("constructor must be a function")}return function D(){var E=this;function G(){var F=Array.prototype.slice.call(arguments);return C.apply(this,[E].concat(F))}G.prototype=C.prototype;return G}}function c(C){return function D(E){var F=C[E];if(typeof(F)!=="function"){throw new Error('"'+E+'" is not a p5 method')}return F.bind(C)}}var m=B.prototype.abs;var A=B.prototype.radians;var r=B.prototype.degrees;if(!B.prototype.originalCreateCanvas_){B.prototype.originalCreateCanvas_=B.prototype.createCanvas;B.prototype.createCanvas=function(){var C=this.originalCreateCanvas_.apply(this,arguments);this.fill(this.color(127,127,127));return C}}if(!B.prototype.originalEllipse_){B.prototype.originalEllipse_=B.prototype.ellipse;B.prototype.ellipse=function(C,F,D,E){D=(D)?D:50;E=(D&&!E)?D:E;this.originalEllipse_(C,F,D,E)}}if(!B.prototype.originalRect_){B.prototype.originalRect_=B.prototype.rect;B.prototype.rect=function(C,F,D,E){D=(D)?D:50;E=(D&&!E)?D:E;this.originalRect_(C,F,D,E)}}B.prototype._ontouchstart=function(G){if(!this._curElement){return}var F;for(var E=0;E<G.touches.length;E++){F=e(this._curElement.elt,G,E);if(F){break}}if(!F){return}var D=this._isGlobal?window:this;var C;this._updateNextTouchCoords(G);this._updateNextMouseCoords(G);this._setProperty("touchIsDown",true);if(typeof D.touchStarted==="function"){C=D.touchStarted(G);if(C===false){G.preventDefault()}}else{if(typeof D.mousePressed==="function"){C=D.mousePressed(G);if(C===false){G.preventDefault()}}}};B.prototype._updateNextTouchCoords=function(H){var C=this.touchX;var I=this.touchY;if(H.type==="mousedown"||H.type==="mousemove"||H.type==="mouseup"||!H.touches){C=this.mouseX;I=this.mouseY}else{if(this._curElement!==null){var E=e(this._curElement.elt,H,0);if(E){C=E.x;I=E.y}var G=[];var F=0;for(var D=0;D<H.touches.length;D++){E=e(this._curElement.elt,H,D);if(E){G[F]=E;F++}}this._setProperty("touches",G)}}this._setProperty("touchX",C);this._setProperty("touchY",I);if(!this._hasTouchInteracted){this._updateTouchCoords();this._setProperty("_hasTouchInteracted",true)}};function e(C,G,D){D=D||0;var F=C.getBoundingClientRect();var I=G.touches[D]||G.changedTouches[D];var H=I.clientX-F.left;var E=I.clientY-F.top;if(H>=0&&H<F.width&&E>=0&&E<F.height){return{x:Math.round(H*C.offsetWidth/F.width),y:Math.round(E*C.offsetHeight/F.height),id:I.identifier}}}B.prototype._onmousedown=function(E){if(!this._curElement){return}if(!p(this._curElement.elt,E)){return}var D=this._isGlobal?window:this;var C;this._setProperty("isMousePressed",true);this._setProperty("mouseIsPressed",true);this._setMouseButton(E);this._updateNextMouseCoords(E);this._updateNextTouchCoords(E);if(typeof D.mousePressed==="function"){C=D.mousePressed(E);if(C===false){E.preventDefault()}}else{if(typeof D.touchStarted==="function"){C=D.touchStarted(E);if(C===false){E.preventDefault()}}}};B.prototype._updateNextMouseCoords=function(E){var D=this.mouseX;var F=this.mouseY;if(E.type==="touchstart"||E.type==="touchmove"||E.type==="touchend"||E.touches){D=this.touchX;F=this.touchY}else{if(this._curElement!==null){var C=p(this._curElement.elt,E);if(C){D=C.x;F=C.y}}}this._setProperty("mouseX",D);this._setProperty("mouseY",F);this._setProperty("winMouseX",E.pageX);this._setProperty("winMouseY",E.pageY);if(!this._hasMouseInteracted){this._updateMouseCoords();this._setProperty("_hasMouseInteracted",true)}};function p(D,C){var F=D.getBoundingClientRect();var G=C.clientX-F.left;var E=C.clientY-F.top;if(G>=0&&G<F.width&&E>=0&&E<F.height){return{x:Math.round(G*D.offsetWidth/F.width),y:Math.round(E*D.offsetHeight/F.height)}}}B.Vector.project=function(D,C){return B.Vector.mult(C,B.Vector.dot(D,C)/B.Vector.dot(C,C))};B.Vector.prototype.isParallel=function(D,C){C=typeof C==="number"?C:1e-14;return(Math.abs(this.x)<C&&Math.abs(D.x)<C)||(Math.abs(this.y)<C&&Math.abs(D.y)<C)||(Math.abs(this.x/D.x-this.y/D.y)<C)};B.prototype.loadImageElement=function(F,C,G){var D=new Image();var E=B._getDecrementPreload.apply(this,arguments);D.onload=function(){if(typeof C==="function"){C(D)}if(E&&(C!==E)){E()}};D.onerror=function(H){B._friendlyFileLoadError(0,D.src);if((typeof G==="function")&&(G!==E)){G(H)}};if(F.indexOf("data:image/")!==0){D.crossOrigin="Anonymous"}D.src=F;return D};B.prototype.imageElement=function(D,M,L,E,H,O,N,J,F){function G(P,Q){if(P>0&&P<Q){return P}else{return Q}}function I(Q,P,T,S,R){if(R===B.prototype.CORNER){return{x:Q,y:P,w:T,h:S}}else{if(R===B.prototype.CORNERS){return{x:Q,y:P,w:T-Q,h:S-P}}else{if(R===B.prototype.RADIUS){return{x:Q-T,y:P-S,w:2*T,h:2*S}}else{if(R===B.prototype.CENTER){return{x:Q-T*0.5,y:P-S*0.5,w:T,h:S}}}}}}if(arguments.length<=5){O=M||0;N=L||0;M=0;L=0;J=E||D.width;F=H||D.height;E=D.width;H=D.height}else{if(arguments.length===9){M=M||0;L=L||0;E=G(E,D.width);H=G(H,D.height);O=O||0;N=N||0;J=J||D.width;F=F||D.height}else{throw"Wrong number of arguments to imageElement()"}}var K=I(O,N,J,F,this._renderer._imageMode);if(this._renderer._tint){var C=this._tempCanvas.getContext("2d");if(this._tempCanvas.width<K.w||this._tempCanvas.height<K.h){this._tempCanvas.width=Math.max(this._tempCanvas.width,K.w);this._tempCanvas.height=Math.max(this._tempCanvas.height,K.h)}else{C.clearRect(0,0,K.w,K.h)}C.drawImage(D,M,L,E,H,0,0,K.w,K.h);this._renderer.image({canvas:this._tempCanvas},0,0,K.w,K.h,K.x,K.y,K.w,K.h)}else{this._renderer.image({elt:D},M,L,E,H,K.x,K.y,K.w,K.h)}};i("allSprites",function(){return new B.prototype.Group()});B.prototype._mouseButtonIsPressed=function(C){return(this.mouseIsPressed&&this.mouseButton===C)||(this.touchIsDown&&C===this.LEFT)};B.prototype.mouseDidMove=function(){return this.pmouseX!==this.mouseX||this.pmouseY!==this.mouseY};B.prototype.mouseIsOver=function(C){if(!C){return false}if(!C.collider){C.setDefaultCollider()}var D;if(this.camera.active){D=this.createVector(this.camera.mouseX,this.camera.mouseY)}else{D=this.createVector(this.mouseX,this.mouseY)}return C.collider.overlap(new window.p5.PointCollider(D))};B.prototype.mousePressedOver=function(C){return(this.mouseIsPressed||this.touchIsDown)&&this.mouseIsOver(C)};var h="rgba(0,0,0,0)";B.Renderer2D.prototype.regularPolygon=function(I,H,C,L,J){var K=this.drawingContext;var E=this._doFill,G=this._doStroke;if(E&&!G){if(K.fillStyle===h){return this}}else{if(!E&&G){if(K.strokeStyle===h){return this}}}if(C<3){return}K.beginPath();K.moveTo(I+L*Math.cos(J),H+L*Math.sin(J));for(var F=1;F<C;F++){var D=J+(F*2*Math.PI/C);K.lineTo(I+L*Math.cos(D),H+L*Math.sin(D))}K.closePath();if(E){K.fill()}if(G){K.stroke()}};B.prototype.regularPolygon=function(C,I,H,G,F){if(!this._renderer._doStroke&&!this._renderer._doFill){return this}var D=new Array(arguments.length);for(var E=0;E<D.length;++E){D[E]=arguments[E]}if(typeof F==="undefined"){F=-(Math.PI/2);if(0===H%2){F+=Math.PI/H}}else{if(this._angleMode===this.DEGREES){F=this.radians(F)}}if(!this._renderer.isP3D){this._validateParameters("regularPolygon",D,[["Number","Number","Number","Number"],["Number","Number","Number","Number","Number"]]);this._renderer.regularPolygon(D[0],D[1],D[2],D[3],F)}return this};B.Renderer2D.prototype.shape=function(){var D=this.drawingContext;var C=this._doFill,G=this._doStroke;if(C&&!G){if(D.fillStyle===h){return this}}else{if(!C&&G){if(D.strokeStyle===h){return this}}}var F=arguments.length/2;if(F<1){return}D.beginPath();D.moveTo(arguments[0],arguments[1]);for(var E=1;E<F;E++){D.lineTo(arguments[E*2],arguments[E*2+1])}D.closePath();if(C){D.fill()}if(G){D.stroke()}};B.prototype.shape=function(){if(!this._renderer._doStroke&&!this._renderer._doFill){return this}if(!this._renderer.isP3D){this._renderer.shape.apply(this._renderer,arguments)}return this};B.prototype.rgb=function(F,E,C,D){if(!D){D=1}D=D*255;return this.color(F,E,C,D)};B.prototype.createGroup=function(){return new this.Group()};i("World",function(){var D={pInst:this};function C(E){Object.defineProperty(D,E,{enumerable:true,get:function(){return this.pInst[E]}})}C("width");C("height");C("mouseX");C("mouseY");C("allSprites");C("frameCount");Object.defineProperty(D,"frameRate",{enumerable:true,get:function(){return this.pInst.frameRate()},set:function(E){this.pInst.frameRate(E)}});Object.defineProperty(D,"seconds",{enumerable:true,get:function(){var E=new Date();var F=E.getTime();return Math.round((F-this.pInst._startTime)/1000)}});return D});B.prototype.spriteUpdate=true;B.prototype.createSprite=function(D,G,F,C){var E=new l(this,D,G,F,C);E.depth=this.allSprites.maxDepth()+1;this.allSprites.add(E);return E};B.prototype.removeSprite=function(C){C.remove()};B.prototype.updateSprites=function(D){if(D===false){this.spriteUpdate=false}if(D===true){this.spriteUpdate=true}if(this.spriteUpdate){for(var C=0;C<this.allSprites.size();C++){this.allSprites.get(C).update()}}};B.prototype.getSprites=function(){if(arguments.length===0){return this.allSprites.toArray()}else{var C=[];for(var D=0;D<arguments.length;D++){for(var E=0;E<this.allSprites.size();E++){if(this.allSprites.get(E).isTagged(arguments[D])){C.push(this.allSprites.get(E))}}}return C}};B.prototype.drawSprites=function(C){C=C||this.allSprites;if(typeof C.draw!=="function"){throw ("Error: with drawSprites you can only draw all sprites or a group")}C.draw()};B.prototype.drawSprite=function(C){if(C){C.display()}};B.prototype.loadAnimation=function(){return n(this.Animation,arguments)};B.prototype.loadSpriteSheet=function(){return n(this.SpriteSheet,arguments)};B.prototype.animation=function(D,C,E){D.draw(C,E)};i("_p5play",function(){return{keyStates:{},mouseStates:{}}});var a=0;var w=1;var z=2;var g=3;B.prototype.keyWentDown=function(C){return this._isKeyInState(C,w)};B.prototype.keyWentUp=function(C){return this._isKeyInState(C,g)};B.prototype.keyDown=function(C){return this._isKeyInState(C,z)};B.prototype._isKeyInState=function(D,E){var F;var C=this._p5play.keyStates;if(typeof D==="string"){F=this._keyCodeFromAlias(D)}else{F=D}if(C[F]===undefined){if(this.keyIsDown(F)){C[F]=z}else{C[F]=a}}return(C[F]===E)};B.prototype.mouseDown=function(C){return this._isMouseButtonInState(C,z)};B.prototype.mouseUp=function(C){return this._isMouseButtonInState(C,a)};B.prototype.mouseWentUp=function(C){return this._isMouseButtonInState(C,g)};B.prototype.mouseWentDown=function(C){return this._isMouseButtonInState(C,w)};B.prototype._clickKeyFromString=function(C){if(this.CLICK_KEY[C]){return this.CLICK_KEY[C]}else{return C}};B.prototype.CLICK_KEY={leftButton:B.prototype.LEFT,rightButton:B.prototype.RIGHT,centerButton:B.prototype.CENTER};B.prototype._isMouseButtonInState=function(D,E){var C=this._p5play.mouseStates;D=this._clickKeyFromString(D);if(D===undefined){D=this.LEFT}if(C[D]===undefined){if(this._mouseButtonIsPressed(D)){C[D]=z}else{C[D]=a}}return(C[D]===E)};B.prototype.KEY={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32," ":32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,LEFT:37,UP_ARROW:38,UP:38,RIGHT_ARROW:39,RIGHT:39,DOWN_ARROW:40,DOWN:40,INSERT:45,DELETE:46,"0":48,"1":49,"2":50,"3":51,"4":52,"5":53,"6":54,"7":55,"8":56,"9":57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"0NUMPAD":96,"1NUMPAD":97,"2NUMPAD":98,"3NUMPAD":99,"4NUMPAD":100,"5NUMPAD":101,"6NUMPAD":102,"7NUMPAD":103,"8NUMPAD":104,"9NUMPAD":105,MULTIPLY:106,PLUS:107,MINUS:109,DOT:110,SLASH1:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,EQUAL:187,COMMA:188,SLASH:191,BACKSLASH:220};B.prototype.KEY_DEPRECATIONS={MINUT:"MINUS",COMA:"COMMA"};B.prototype._keyCodeFromAlias=function(C){C=C.toUpperCase();if(this.KEY_DEPRECATIONS[C]){this._warn('Key literal "'+C+'" is deprecated and may be removed in a future version of p5.play. Please use "'+this.KEY_DEPRECATIONS[C]+'" instead.');C=this.KEY_DEPRECATIONS[C]}return this.KEY[C]};B.prototype.readPresses=function(){var D=this._p5play.keyStates;var C=this._p5play.mouseStates;for(var F in D){if(this.keyIsDown(F)){if(D[F]===a){D[F]=w}else{D[F]=z}}else{if(D[F]===z){D[F]=g}else{D[F]=a}}}for(var E in C){if(this._mouseButtonIsPressed(E)){if(C[E]===a){C[E]=w}else{C[E]=z}}else{if(C[E]===z){C[E]=g}else{C[E]=a}}}};B.prototype.useQuadTree=function(C){if(this.quadTree!==undefined){if(C===undefined){return this.quadTree.active}else{if(C){this.quadTree.active=true}else{this.quadTree.active=false}}}else{return false}};i("quadTree",function(){var C=new k({x:0,y:0,width:0,height:0},4);C.active=false;return C});function l(an,ah,ag,ai,ap){var M=c(an);var J=M("createVector");var T=M("color");var ao=M("print");var al=M("push");var ad=M("pop");var K=M("colorMode");var O=M("tint");var L=M("lerpColor");var ar=M("noStroke");var X=M("rectMode");var am=M("ellipseMode");var D=M("imageMode");var C=M("translate");var ac=M("scale");var aq=M("rotate");var W=M("stroke");var R=M("strokeWeight");var H=M("line");var ab=M("noFill");var N=M("fill");var G=M("textAlign");var V=M("textSize");var U=M("text");var Y=M("rect");var F=M("cos");var I=M("sin");var Q=M("atan2");var E=an.quadTree;var P=an.camera;var ae=B.prototype.RGB;var aa=B.prototype.CENTER;var S=B.prototype.LEFT;var Z=B.prototype.BOTTOM;this.position=J(ah,ag);this.previousPosition=J(ah,ag);this.newPosition=J(ah,ag);this.deltaX=0;this.deltaY=0;this.velocity=J(0,0);this.maxSpeed=-1;this.friction=0;this.collider=undefined;this.touching={};this.touching.left=false;this.touching.right=false;this.touching.top=false;this.touching.bottom=false;this.mass=1;this.immovable=false;this.restitution=1;Object.defineProperty(this,"rotation",{enumerable:true,get:function(){return this._rotation},set:function(au){this._rotation=au;if(this.rotateToDirection){this.setSpeed(this.getSpeed(),au)}}});this._rotation=0;this.rotationSpeed=0;this.rotateToDirection=false;this.depth=0;this.scale=1;var ak=1;var aj=1;this.visible=true;this.mouseActive=false;this.mouseIsOver=false;this.mouseIsPressed=false;this._internalWidth=ai;this._internalHeight=ap;this._horizontalStretch=1;this._verticalStretch=1;Object.defineProperty(this,"width",{enumerable:true,configurable:true,get:function(){if(this._internalWidth===undefined){return 100}else{if(this.animation&&an._fixedSpriteAnimationFrameSizes){return this._internalWidth*this._horizontalStretch}else{return this._internalWidth}}},set:function(au){if(this.animation&&an._fixedSpriteAnimationFrameSizes){this._horizontalStretch=au/this._internalWidth}else{this._internalWidth=au}}});if(ai===undefined){this.width=100}else{this.width=ai}Object.defineProperty(this,"height",{enumerable:true,configurable:true,get:function(){if(this._internalHeight===undefined){return 100}else{if(this.animation&&an._fixedSpriteAnimationFrameSizes){return this._internalHeight*this._verticalStretch}else{return this._internalHeight}}},set:function(au){if(this.animation&&an._fixedSpriteAnimationFrameSizes){this._verticalStretch=au/this._internalHeight}else{this._internalHeight=au}}});if(ap===undefined){this.height=100}else{this.height=ap}this.originalWidth=this._internalWidth;this.originalHeight=this._internalHeight;this.getScaledWidth=function(){return this.width*this.scale};this.getScaledHeight=function(){return this.height*this.scale};this.removed=false;this.life=-1;this.debug=false;this.shapeColor=T(127,127,127);this.groups=[];var at={};var af="";this.animation=undefined;this._sweptCollider=undefined;Object.defineProperty(this,"x",{enumerable:true,get:function(){return this.position.x},set:function(au){this.position.x=au}});Object.defineProperty(this,"y",{enumerable:true,get:function(){return this.position.y},set:function(au){this.position.y=au}});Object.defineProperty(this,"velocityX",{enumerable:true,get:function(){return this.velocity.x},set:function(au){this.velocity.x=au}});Object.defineProperty(this,"velocityY",{enumerable:true,get:function(){return this.velocity.y},set:function(au){this.velocity.y=au}});Object.defineProperty(this,"lifetime",{enumerable:true,get:function(){return this.life},set:function(au){this.life=au}});Object.defineProperty(this,"bounciness",{enumerable:true,get:function(){return this.restitution},set:function(au){this.restitution=au}});Object.defineProperty(this,"frameDelay",{enumerable:true,get:function(){return this.animation&&this.animation.frameDelay},set:function(au){if(this.animation){this.animation.frameDelay=au}}});this._getBroadPhaseCollider=function(){return(this.velocity.magSq()>0)?this._sweptCollider:this.collider};this._doSweptCollidersOverlap=function(av){var au=this._getBroadPhaseCollider().collide(av._getBroadPhaseCollider());return au.x!==0||au.y!==0};this._syncAnimationSizes=function(av,au){if(an._fixedSpriteAnimationFrameSizes){return}if(av[au].frameChanged||this.width===undefined||this.height===undefined){this._internalWidth=av[au].getWidth()*m(this._getScaleX());this._internalHeight=av[au].getHeight()*m(this._getScaleY())}};this.update=function(){if(!this.removed){if(this._sweptCollider&&this.velocity.magSq()>0){this._sweptCollider.updateSweptColliderFromSprite(this)}if(this.newPosition!==this.position){this.previousPosition=J(this.newPosition.x,this.newPosition.y)}else{this.previousPosition=J(this.position.x,this.position.y)}this.velocity.x*=1-this.friction;this.velocity.y*=1-this.friction;if(this.maxSpeed!==-1){this.limitSpeed(this.maxSpeed)}if(this.rotateToDirection&&this.velocity.mag()>0){this._rotation=this.getDirection()}this.rotation+=this.rotationSpeed;this.position.x+=this.velocity.x;this.position.y+=this.velocity.y;this.newPosition=J(this.position.x,this.position.y);this.deltaX=this.position.x-this.previousPosition.x;this.deltaY=this.position.y-this.previousPosition.y;if(at[af]){at[af].update();this._syncAnimationSizes(at,af)}if(this.collider){this.collider.updateFromSprite(this)}if(this.mouseActive){if(!this.collider){this.setDefaultCollider()}this.mouseUpdate()}else{if(typeof(this.onMouseOver)==="function"||typeof(this.onMouseOut)==="function"||typeof(this.onMousePressed)==="function"||typeof(this.onMouseReleased)==="function"){this.mouseActive=true;if(!this.collider){this.setDefaultCollider()}this.mouseUpdate()}}if(this.life>0){this.life--}if(this.life===0){this.remove()}}};this.setDefaultCollider=function(){if(at[af]&&at[af].getWidth()===1&&at[af].getHeight()===1){return}this.setCollider("rectangle")};this.mouseUpdate=function(){var au=this.mouseIsOver;var av=this.mouseIsPressed;this.mouseIsOver=false;this.mouseIsPressed=false;if(this.collider){var aw;if(P.active){aw=J(P.mouseX,P.mouseY)}else{aw=J(an.mouseX,an.mouseY)}this.mouseIsOver=this.collider.overlap(new B.PointCollider(aw));if(this.mouseIsOver&&(an.mouseIsPressed||an.touchIsDown)){this.mouseIsPressed=true}if(!au&&this.mouseIsOver&&this.onMouseOver!==undefined){if(typeof(this.onMouseOver)==="function"){this.onMouseOver.call(this,this)}else{ao("Warning: onMouseOver should be a function")}}if(au&&!this.mouseIsOver&&this.onMouseOut!==undefined){if(typeof(this.onMouseOut)==="function"){this.onMouseOut.call(this,this)}else{ao("Warning: onMouseOut should be a function")}}if(!av&&this.mouseIsPressed&&this.onMousePressed!==undefined){if(typeof(this.onMousePressed)==="function"){this.onMousePressed.call(this,this)}else{ao("Warning: onMousePressed should be a function")}}if(av&&!an.mouseIsPressed&&!this.mouseIsPressed&&this.onMouseReleased!==undefined){if(typeof(this.onMouseReleased)==="function"){this.onMouseReleased.call(this,this)}else{ao("Warning: onMouseReleased should be a function")}}}};this.setCollider=function(az,av,aB,ay,au,ax){var aw=az?az.toLowerCase():"";if(aw==="rectangle"){aw="obb"}if(!(aw==="point"||aw==="circle"||aw==="obb"||aw==="aabb")){throw new TypeError('setCollider expects the first argument to be one of "point", "circle", "rectangle", "aabb" or "obb"')}else{if(aw==="point"&&!(arguments.length===1||arguments.length===3)){throw new TypeError('Usage: setCollider("'+az+'"[, offsetX, offsetY])')}else{if(aw==="circle"&&!(arguments.length===1||arguments.length===3||arguments.length===4)){throw new TypeError('Usage: setCollider("'+az+'"[, offsetX, offsetY[, radius]])')}else{if(aw==="aabb"&&!(arguments.length===1||arguments.length===3||arguments.length===5)){throw new TypeError('Usage: setCollider("'+az+'"[, offsetX, offsetY[, width, height]])')}else{if(aw==="obb"&&!(arguments.length===1||arguments.length===3||arguments.length===5||arguments.length===6)){throw new TypeError('Usage: setCollider("'+az+'"[, offsetX, offsetY[, width, height[, rotation]]])')}}}}}var aA=J(av,aB);if(aw==="point"){this.collider=B.PointCollider.createFromSprite(this,aA)}else{if(aw==="circle"){this.collider=B.CircleCollider.createFromSprite(this,aA,ay)}else{if(aw==="aabb"){this.collider=B.AxisAlignedBoundingBoxCollider.createFromSprite(this,aA,ay,au)}else{if(aw==="obb"){this.collider=B.OrientedBoundingBoxCollider.createFromSprite(this,aA,ay,au,A(ax))}}}}this._sweptCollider=new B.OrientedBoundingBoxCollider()};this.mirrorX=function(au){if(au===1||au===-1){ak=au}else{return ak}};this.mirrorY=function(au){if(au===1||au===-1){aj=au}else{return aj}};this._getScaleX=function(){if(an._fixedSpriteAnimationFrameSizes){return this.scale*this._horizontalStretch}return this.scale};this._getScaleY=function(){if(an._fixedSpriteAnimationFrameSizes){return this.scale*this._verticalStretch}return this.scale};this.display=function(){if(this.visible&&!this.removed){al();K(ae);ar();X(aa);am(aa);D(aa);C(this.position.x,this.position.y);if(an._angleMode===an.RADIANS){aq(A(this.rotation))}else{aq(this.rotation)}ac(this._getScaleX()*ak,this._getScaleY()*aj);this.draw();ad();if(this.debug){al();W(0,255,0);R(1);H(this.position.x-10,this.position.y,this.position.x+10,this.position.y);H(this.position.x,this.position.y-10,this.position.x,this.position.y+10);ab();ar();N(0,255,0);G(S,Z);V(16);U(this.depth+"",this.position.x+4,this.position.y-2);ab();W(0,255,0);if(this.collider===undefined){this.setDefaultCollider()}if(this.collider){this.collider.draw(an)}ad()}}};this.draw=function(){if(af!==""&&at){if(at[af]){if(this.tint){al();O(this.tint)}at[af].draw(0,0,0);if(this.tint){ad()}}}else{var au=this.shapeColor;if(this.tint){au=L(T(au),T(this.tint),0.5)}ar();N(au);Y(0,0,this._internalWidth,this._internalHeight)}};this.remove=function(){this.removed=true;E.removeObject(this);while(this.groups.length>0){this.groups[0].remove(this)}};this.destroy=this.remove;this.setVelocity=function(au,av){this.velocity.x=au;this.velocity.y=av};this.getSpeed=function(){return this.velocity.mag()};this.getDirection=function(){var au=Q(this.velocity.y,this.velocity.x);if(isNaN(au)){au=0}if(an._angleMode===an.RADIANS){au=r(au)}return au};this.addToGroup=function(au){if(au instanceof Array){au.add(this)}else{ao("addToGroup error: "+au+" is not a group")}};this.limitSpeed=function(au){var aw=this.getSpeed();if(m(aw)>au){var av=au/m(aw);this.velocity.x*=av;this.velocity.y*=av}};this.setSpeed=function(av,aw){var au;if(typeof aw==="undefined"){if(this.velocity.x!==0||this.velocity.y!==0){au=an.atan2(this.velocity.y,this.velocity.x)}else{if(an._angleMode===an.RADIANS){au=A(this._rotation)}else{au=this._rotation}}}else{if(an._angleMode===an.RADIANS){au=A(aw)}else{au=aw}}this.velocity.x=F(au)*av;this.velocity.y=I(au)*av};this.setSpeedAndDirection=this.setSpeed;this.setFrame=function(au){if(this.animation){this.animation.changeFrame(au)}};this.nextFrame=function(){if(this.animation){this.animation.nextFrame()}};this.previousFrame=function(){if(this.animation){this.animation.previousFrame()}};this.pause=function(){if(this.animation){this.animation.stop()}};this.play=function(){if(!this.animation){return}if(!this.animation.looping&&!this.animation.playing&&this.animation.getFrame()===this.animation.images.length-1){this.animation.rewind()}this.animation.play()};this.frameDidChange=function(){return this.animation?this.animation.frameChanged:false};this.pointTo=function(au,ay){var av=ay-this.position.y;var aw=au-this.position.x;if(!isNaN(aw)&&!isNaN(av)&&(aw!==0||av!==0)){var ax=Math.atan2(av,aw);this.rotation=360*ax/(2*Math.PI)}};this.addSpeed=function(av,aw){var au;if(an._angleMode===an.RADIANS){au=A(aw)}else{au=aw}this.velocity.x+=F(au)*av;this.velocity.y+=I(au)*av};this.attractionPoint=function(au,ax,aw){var av=Q(aw-this.position.y,ax-this.position.x);this.velocity.x+=F(av)*au;this.velocity.y+=I(av)*au};this.addImage=function(){if(typeof arguments[0]==="string"&&arguments[1] instanceof B.Image){this.addAnimation(arguments[0],arguments[1])}else{if(arguments[0] instanceof B.Image){this.addAnimation("normal",arguments[0])}else{throw ("addImage error: allowed usages are <image> or <label>, <image>")}}};this.addAnimation=function(av){var ay;if(typeof av!=="string"){ao("Sprite.addAnimation error: the first argument must be a label (String)");return -1}else{if(arguments.length<2){ao("addAnimation error: you must specify a label and n frame images");return -1}else{if(arguments[1] instanceof y){var az=arguments[1];var au=az.clone();at[av]=au;if(af===""){af=av;this.animation=au}au.isSpriteAnimation=true;this._internalWidth=au.getWidth()*m(this._getScaleX());this._internalHeight=au.getHeight()*m(this._getScaleY());return au}else{var ax=[];for(var aw=1;aw<arguments.length;aw++){ax.push(arguments[aw])}ay=n(an.Animation,ax);at[av]=ay;if(af===""){af=av;this.animation=ay}ay.isSpriteAnimation=true;this._internalWidth=ay.getWidth()*m(this._getScaleX());this._internalHeight=ay.getHeight()*m(this._getScaleY());return ay}}}};this.changeImage=function(au){this.changeAnimation(au)};this.getAnimationLabel=function(){return af};this.changeAnimation=function(au){if(!at[au]){ao("changeAnimation error: no animation labeled "+au)}else{af=au;this.animation=at[au]}};this.setAnimation=function(au){if(au===this.getAnimationLabel()){return}var av=an._predefinedSpriteAnimations&&an._predefinedSpriteAnimations[au];if(typeof av==="undefined"){throw new Error('Unable to find an animation named "'+au+'".  Please make sure the animation exists.')}this.addAnimation(au,av);this.changeAnimation(au);if(an._pauseSpriteAnimationsByDefault){this.pause()}};this.overlapPixel=function(ay,ax){var au=J(ay,ax);var aw=this.animation.getFrameImage();au.x-=this.position.x-aw.width/2;au.y-=this.position.y-aw.height/2;if(au.x<0||au.x>aw.width||au.y<0||au.y>aw.height){return false}else{if(this.rotation===0&&this.scale===1){var av=aw.get(au.x,au.y);return av[3]===255}else{ao("Error: overlapPixel doesn't work with scaled or rotated sprites yet");return false}}};this.overlapPoint=function(aw,av){if(!this.collider){this.setDefaultCollider()}if(this.collider){var au=new B.PointCollider(new B.Vector(aw,av));return this.collider.overlap(au)}return false};this.overlap=function(au,av){return this._collideWith("overlap",au,av)};this.isTouching=this.overlap;this.collide=function(au,av){return this._collideWith("collide",au,av)};this.displace=function(au,av){return this._collideWith("displace",au,av)};this.bounce=function(au,av){return this._collideWith("bounce",au,av)};this.bounceOff=function(au,av){return this._collideWith("bounceOff",au,av)};this._collideWith=function(ax,ay,az){this.touching.left=false;this.touching.right=false;this.touching.top=false;this.touching.bottom=false;if(this.removed){return false}var aw=[];if(ay instanceof l){aw.push(ay)}else{if(ay instanceof Array){if(an.quadTree!==undefined&&an.quadTree.active){aw=an.quadTree.retrieveFromGroup(this,ay)}if(aw.length===0){aw=ay}}else{throw ("Error: overlap can only be checked between sprites or groups")}}var au=false;for(var av=0;av<aw.length;av++){au=this._collideWithOne(ax,aw[av],az)||au}return au};this._collideWithOne=function(aD,aC,aK){if(aC===this||aC.removed){return false}if(this.collider===undefined){this.setDefaultCollider()}if(aC.collider===undefined){aC.setDefaultCollider()}if(!this.collider||!aC.collider){return false}var aI=this._findDisplacement(aC);if(aI.x===0&&aI.y===0){return false}if(aI.x>0){this.touching.left=true}if(aI.x<0){this.touching.right=true}if(aI.y<0){this.touching.bottom=true}if(aI.y>0){this.touching.top=true}if(aD==="displace"&&!aC.immovable){aC.position.sub(aI)}else{if((aD==="collide"||aD==="bounce"||aD==="bounceOff")&&!this.immovable){this.position.add(aI);this.previousPosition=J(this.position.x,this.position.y);this.newPosition=J(this.position.x,this.position.y);this.collider.updateFromSprite(this)}}var aw=aD;var az=this.immovable;var au=aC.immovable;var aB=aC.restitution;if(aw==="collide"){aD="bounce";aC.immovable=true;aC.restitution=0}else{if(aw==="bounceOff"){aD="bounce";aC.immovable=true}}if(aD==="bounce"){var aF=B.Vector.project(this.velocity,aI);var ax=B.Vector.project(aC.velocity,aI);var aH=this.mass;var aG=aC.mass;if(this.immovable){aH=1;aG=0}else{if(aC.immovable){aH=0;aG=1}}var aJ=aH+aG;var aE=this.restitution*aC.restitution;var av=B.Vector.add(B.Vector.mult(aF,aH),B.Vector.mult(ax,aG));var aA=B.Vector.sub(ax,aF).mult(aG*aE).add(av).div(aJ);var ay=B.Vector.sub(aF,ax).mult(aH*aE).add(av).div(aJ);this.velocity.sub(aF).add(aA);aC.velocity.sub(ax).add(ay)}aD=aw;this.immovable=az;aC.immovable=au;aC.restitution=aB;if(typeof aK==="function"&&aD!=="isTouching"){aK.call(this,this,aC)}return true};this._findDisplacement=function(aA){if(this._doSweptCollidersOverlap(aA)){var aB=Math.max(this.collider._getMinRadius(),aA.collider._getMinRadius());var av=B.Vector.sub(this.velocity,aA.velocity).mag();var au=Math.max(0.015,aB/av);if(au<1){var az=this.position.copy();var aD=aA.position.copy();this.position.set(this.previousPosition);aA.position.set(aA.previousPosition);var aw=B.Vector.sub(az,this.previousPosition).mult(au);var ay=B.Vector.sub(aD,aA.previousPosition).mult(au);for(var ax=au;ax<1;ax+=au){this.position.add(aw);aA.position.add(ay);this.collider.updateFromSprite(this);aA.collider.updateFromSprite(aA);var aC=this.collider.collide(aA.collider);if(aC.x!==0||aC.y!==0){if(this.immovable){this.position.set(az)}if(aA.immovable){aA.position.set(aD)}return aC}}this.position.set(az);aA.position.set(aD)}}this.collider.updateFromSprite(this);aA.collider.updateFromSprite(aA);return this.collider.collide(aA.collider)}}i("Sprite",v(l));function f(D,C,F,E){this.position=D.createVector(C,F);Object.defineProperty(this,"x",{enumerable:true,get:function(){return this.position.x},set:function(G){this.position.x=G}});Object.defineProperty(this,"y",{enumerable:true,get:function(){return this.position.y},set:function(G){this.position.y=G}});this.zoom=E;this.mouseX=D.mouseX;this.mouseY=D.mouseY;this.active=false;this.isActive=function(){return this.active};this.on=function(){if(!this.active){j.call(D);this.active=true}};this.off=function(){if(this.active){u.call(D);this.active=false}}}i("Camera",v(f));function j(){var D=this;var C=D.camera;if(!C.init&&C.position.x===0&&C.position.y===0){C.position.x=D.width/2;C.position.y=D.height/2;C.init=true}C.mouseX=D.mouseX+C.position.x-D.width/2;C.mouseY=D.mouseY+C.position.y-D.height/2;if(!C.active){C.active=true;D.push();D.scale(C.zoom);D.translate(-C.position.x+D.width/2/C.zoom,-C.position.y+D.height/2/C.zoom)}}function u(){var C=this;if(C.camera.active){C.pop();C.camera.active=false}}function o(){var E=[];E.get=function(F){return E[F]};E.contains=function(F){return this.indexOf(F)>-1};E.indexOf=function(H){for(var G=0,F=E.length;G<F;++G){if(C(H,E[G])){return G}}return -1};E.add=function(F){if(!(F instanceof l)){throw ("Error: you can only add sprites to a group")}if(-1===this.indexOf(F)){E.push(F);F.groups.push(this)}};E.size=function(){return E.length};E.removeSprites=function(){while(E.length>0){E[0].remove()}};E.clear=function(){E.length=0};E.remove=function(G){if(!(G instanceof l)){throw ("Error: you can only remove sprites from a group")}var F,H=false;for(F=E.length-1;F>=0;F--){if(E[F]===G){E.splice(F,1);H=true}}if(H){for(F=G.groups.length-1;F>=0;F--){if(G.groups[F]===this){G.groups.splice(F,1)}}}return H};E.toArray=function(){return E.slice(0)};E.maxDepth=function(){if(E.length===0){return 0}return E.reduce(function(G,F){return Math.max(G,F.depth)},-Infinity)};E.minDepth=function(){if(E.length===0){return 99999}return E.reduce(function(G,F){return Math.min(G,F.depth)},Infinity)};E.draw=function(){this.sort(function(H,G){return H.depth-G.depth});for(var F=0;F<this.size();F++){this.get(F).display()}};function C(G,F){if(G===null||F===null){return(G===null)&&(F===null)}if(typeof(G)==="string"){return G===F}if(typeof(G)!=="object"){return G===F}if(G.equals instanceof Function){return G.equals(F)}return G===F}function D(G,H,J){var I=false;for(var F=0;F<this.size();F++){I=this.get(F)._collideWith(G,H,J)||I}return I}E.overlap=D.bind(E,"overlap");E.isTouching=E.overlap;E.collide=D.bind(E,"collide");E.displace=D.bind(E,"displace");E.bounce=D.bind(E,"bounce");E.bounceOff=D.bind(E,"bounceOff");E.setPropertyEach=function(H,G){for(var F=0;F<this.length;F++){this[F][H]=G}};E.callMethodEach=function(G){var F=Array.prototype.slice.call(arguments,1);var I=[].concat(this);for(var H=0;H<I.length;H++){I[H][G].apply(I[H],F)}};E.setDepthEach=E.setPropertyEach.bind(E,"depth");E.setLifetimeEach=E.setPropertyEach.bind(E,"lifetime");E.setRotateToDirectionEach=E.setPropertyEach.bind(E,"rotateToDirection");E.setRotationEach=E.setPropertyEach.bind(E,"rotation");E.setRotationSpeedEach=E.setPropertyEach.bind(E,"rotationSpeed");E.setScaleEach=E.setPropertyEach.bind(E,"scale");E.setColorEach=E.setPropertyEach.bind(E,"shapeColor");E.setTintEach=E.setPropertyEach.bind(E,"tint");E.setVisibleEach=E.setPropertyEach.bind(E,"visible");E.setVelocityXEach=E.setPropertyEach.bind(E,"velocityX");E.setVelocityYEach=E.setPropertyEach.bind(E,"velocityY");E.setHeightEach=E.setPropertyEach.bind(E,"height");E.setWidthEach=E.setPropertyEach.bind(E,"width");E.destroyEach=E.callMethodEach.bind(E,"destroy");E.pointToEach=E.callMethodEach.bind(E,"pointTo");E.setAnimationEach=E.callMethodEach.bind(E,"setAnimation");E.setColliderEach=E.callMethodEach.bind(E,"setCollider");E.setSpeedAndDirectionEach=E.callMethodEach.bind(E,"setSpeedAndDirection");E.setVelocityEach=E.callMethodEach.bind(E,"setVelocity");E.setMirrorXEach=E.callMethodEach.bind(E,"mirrorX");E.setMirrorYEach=E.callMethodEach.bind(E,"mirrorY");return E}B.prototype.Group=o;B.prototype.createEdgeSprites=function(){if(this.edges){return this.edges}var D=100;var E=this._curElement.elt.offsetWidth;var C=this._curElement.elt.offsetHeight;this.leftEdge=this.createSprite(-D/2,C/2,D,C);this.rightEdge=this.createSprite(E+(D/2),C/2,D,C);this.topEdge=this.createSprite(E/2,-D/2,E,D);this.bottomEdge=this.createSprite(E/2,C+(D/2),E,D);this.edges=this.createGroup();this.edges.add(this.leftEdge);this.edges.add(this.rightEdge);this.edges.add(this.topEdge);this.edges.add(this.bottomEdge);return this.edges};function y(J){var U=Array.prototype.slice.call(arguments,1);var P;var T=B.prototype.CENTER;this.images=[];var L=0;var E=0;var D=-1;this.offX=0;this.offY=0;this.frameDelay=4;this.playing=true;this.visible=true;this.looping=true;this.frameChanged=false;this.imageCollider=false;if(U.length===2&&typeof U[0]==="string"&&typeof U[1]==="string"){var M=U[0];var C=U[1];var R=M.substring(M.length-4,M.length);if(R!==".png"){J.print("Animation error: you need to use .png files (filename "+M+")");M=-1}var Q=C.substring(C.length-4,C.length);if(Q!==".png"){J.print("Animation error: you need to use .png files (filename "+C+")");C=-1}if(M!==-1&&C!==-1){var I=0;var H=0;for(P=M.length-5;P>=0;P--){if(M.charAt(P)>="0"&&M.charAt(P)<="9"){I++}}for(P=C.length-5;P>=0;P--){if(C.charAt(P)>="0"&&C.charAt(P)<="9"){H++}}var G=M.substring(0,M.length-(4+I));var F=C.substring(0,C.length-(4+H));var O=parseInt(M.substring(M.length-(4+I),M.length-4),10);var N=parseInt(C.substring(C.length-(4+H),C.length-4),10);if(N<O){var K=N;N=O;O=K}if(G!==F){this.images.push(J.loadImage(M));this.images.push(J.loadImage(C))}else{var S;if(I===H){for(P=O;P<=N;P++){S=G+J.nf(P,I)+".png";this.images.push(J.loadImage(S))}}else{for(P=O;P<=N;P++){S=G+P+".png";this.images.push(J.loadImage(S))}}}}}else{if(U.length===1&&(U[0] instanceof d)){this.spriteSheet=U[0];this.images=this.spriteSheet.frames.map(function(V){if(V.spriteSourceSize&&V.sourceSize){return Object.assign(V.frame,{width:V.frame.w,height:V.frame.h,sourceX:V.spriteSourceSize.x,sourceY:V.spriteSourceSize.y,sourceW:V.sourceSize.w,sourceH:V.sourceSize.h})}return V.frame})}else{if(U.length!==0){for(P=0;P<U.length;P++){if(U[P] instanceof B.Image){this.images.push(U[P])}else{this.images.push(J.loadImage(U[P]))}}}}}this.clone=function(){var V=new y(J);V.images=[];if(this.spriteSheet){V.spriteSheet=this.spriteSheet.clone()}V.images=this.images.slice();V.offX=this.offX;V.offY=this.offY;V.frameDelay=this.frameDelay;V.playing=this.playing;V.looping=this.looping;return V};this.draw=function(ad,aa,V){this.xpos=ad;this.ypos=aa;this.rotation=V||0;if(this.visible){if(!this.isSpriteAnimation){this.update()}J.push();J.imageMode(T);var ab=this.xpos;var W=this.ypos;var X=this.images[L];var ac=this.spriteSheet&&X;if(ac){var Z=(ac.sourceW||ac.width)-ac.width;var Y=(ac.sourceH||ac.height)-ac.height;ab+=((ac.sourceX||0)-Z/2);W+=((ac.sourceY||0)-Y/2)}J.translate(ab,W);if(J._angleMode===J.RADIANS){J.rotate(A(this.rotation))}else{J.rotate(this.rotation)}if(ac){if(this.spriteSheet.image instanceof Image){J.imageElement(this.spriteSheet.image,ac.x,ac.y,ac.width,ac.height,this.offX,this.offY,ac.width,ac.height)}else{J.image(this.spriteSheet.image,ac.x,ac.y,ac.width,ac.height,this.offX,this.offY,ac.width,ac.height)}}else{if(X){if(X instanceof Image){J.imageElement(X,this.offX,this.offY)}else{J.image(X,this.offX,this.offY)}}else{J.print("Warning undefined frame "+L)}}J.pop()}};this.update=function(){E++;var V=L;this.frameChanged=false;if(this.images.length===1){this.playing=false;L=0}if(this.playing&&E%this.frameDelay===0){if(D>L&&D!==-1){L++}else{if(D<L&&D!==-1){L--}else{if(D===L&&D!==-1){this.playing=false}else{if(this.looping){if(L>=this.images.length-1){L=0}else{L++}}else{if(L<this.images.length-1){L++}else{this.playing=false}}}}}}if(V!==L){this.frameChanged=true}};this.play=function(){this.playing=true;D=-1};this.stop=function(){this.playing=false};this.rewind=function(){L=0};this.changeFrame=function(V){if(V<this.images.length){L=V}else{L=this.images.length-1}D=-1};this.nextFrame=function(){if(L<this.images.length-1){L=L+1}else{if(this.looping){L=0}}D=-1;this.playing=false};this.previousFrame=function(){if(L>0){L=L-1}else{if(this.looping){L=this.images.length-1}}D=-1;this.playing=false};this.goToFrame=function(V){if(V<0||V>=this.images.length){return}D=V;if(D!==L){this.playing=true}};this.getFrame=function(){return L};this.getLastFrame=function(){return this.images.length-1};this.getFrameImage=function(){return this.images[L]};this.getImageAt=function(V){return this.images[V]};this.getWidth=function(){if(this.images[L]){return this.images[L].sourceW||this.images[L].width}else{return 1}};this.getHeight=function(){if(this.images[L]){return this.images[L].sourceH||this.images[L].height}else{return 1}}}i("Animation",v(y));function d(E){var F=Array.prototype.slice.call(arguments,1);this.image=null;this.frames=[];this.frame_width=0;this.frame_height=0;this.num_frames=0;this._generateSheetFrames=function(){var K=0,J=0;for(var I=0;I<this.num_frames;I++){this.frames.push({name:I,frame:{x:K,y:J,width:this.frame_width,height:this.frame_height}});K+=this.frame_width;if(K>=this.image.width){K=0;J+=this.frame_height;if(J>=this.image.height){J=0}}}};var C=F.length===2||F.length===3;var D=F.length===4||F.length===5;if(C&&Array.isArray(F[1])){this.frames=F[1];this.num_frames=this.frames.length}else{if(D&&(typeof F[1]==="number")&&(typeof F[2]==="number")&&(typeof F[3]==="number")){this.frame_width=F[1];this.frame_height=F[2];this.num_frames=F[3]}}if(F[0] instanceof B.Image||F[0] instanceof Image){this.image=F[0];if(D){this._generateSheetFrames()}}else{var H;if(C){if(F[2]){if(typeof F[2]==="function"){H=F[2]}this.image=E.loadImageElement(F[0],function(I){if(H){return H(I)}},function(){if(H){return H(null)}})}else{this.image=E.loadImage(F[0])}}else{if(D){var G=this._generateSheetFrames.bind(this);if(F[4]){if(typeof F[4]==="function"){H=F[4]}this.image=E.loadImageElement(F[0],function(I){G(I);if(H){return H(I)}},function(){if(H){return H(null)}})}else{this.image=E.loadImage(F[0],G)}}}}this.drawFrame=function(Q,T,R,K,U){var O;if(typeof Q==="number"){O=this.frames[Q]}else{for(var N=0;N<this.frames.length;N++){if(this.frames[N].name===Q){O=this.frames[N];break}}}var S=O.frame.width||O.frame.w;var L=O.frame.height||O.frame.h;var P=K||S;var M=U||L;if(O.spriteSourceSize&&O.sourceSize){var J=S/O.sourceSize.w;var I=L/O.sourceSize.h;if(K){T+=(O.spriteSourceSize.x*P/O.sourceSize.w);P=K*J}else{T+=O.spriteSourceSize.x}if(U){R+=(O.spriteSourceSize.y*M/O.sourceSize.h);M=U*I}else{R+=O.spriteSourceSize.y}}if(this.image instanceof Image){E.imageElement(this.image,O.frame.x,O.frame.y,O.frame.width,O.frame.height,T,R,P,M)}else{E.image(this.image,O.frame.x,O.frame.y,O.frame.width,O.frame.height,T,R,P,M)}};this.clone=function(){var K=new d(E);for(var J=0;J<this.frames.length;J++){var L=this.frames[J].frame;var I={name:L.name,frame:{x:L.x,y:L.y,width:L.width,height:L.height}};K.frames.push(I)}K.image=this.image;K.frame_width=this.frame_width;K.frame_height=this.frame_height;K.num_frames=this.num_frames;return K}}i("SpriteSheet",v(d));function n(D,C){function E(){return D.apply(this,C)}E.prototype=D.prototype;return new E()}function k(E,D,C,F){this.active=true;this.max_objects=D||10;this.max_levels=C||4;this.level=F||0;this.bounds=E;this.objects=[];this.object_refs=[];this.nodes=[]}k.prototype.updateBounds=function(){var G=this.getAll();var C=10000;var H=10000;var D=-10000;var F=-10000;for(var E=0;E<G.length;E++){if(G[E].position.x<C){C=G[E].position.x}if(G[E].position.y<H){H=G[E].position.y}if(G[E].position.x>D){D=G[E].position.x}if(G[E].position.y>F){F=G[E].position.y}}this.bounds={x:C,y:H,width:D,height:F}};k.prototype.split=function(){var E=this.level+1,D=Math.round(this.bounds.width/2),F=Math.round(this.bounds.height/2),C=Math.round(this.bounds.x),G=Math.round(this.bounds.y);this.nodes[0]=new k({x:C+D,y:G,width:D,height:F},this.max_objects,this.max_levels,E);this.nodes[1]=new k({x:C,y:G,width:D,height:F},this.max_objects,this.max_levels,E);this.nodes[2]=new k({x:C,y:G+F,width:D,height:F},this.max_objects,this.max_levels,E);this.nodes[3]=new k({x:C+D,y:G+F,width:D,height:F},this.max_objects,this.max_levels,E)};k.prototype.getIndex=function(D){if(!D.collider){return -1}else{var G=D.collider.getBoundingBox();var C=-1,F=this.bounds.x+(this.bounds.width/2),H=this.bounds.y+(this.bounds.height/2),E=(G.top<H&&G.bottom<H),I=(G.top>H);if(G.left<F&&G.right<F){if(E){C=1}else{if(I){C=2}}}else{if(G.left>F){if(E){C=0}else{if(I){C=3}}}}return C}};k.prototype.insert=function(E){if(this.objects.indexOf(E)===-1){var D=0,C;if(typeof this.nodes[0]!=="undefined"){C=this.getIndex(E);if(C!==-1){this.nodes[C].insert(E);return}}this.objects.push(E);if(this.objects.length>this.max_objects&&this.level<this.max_levels){if(typeof this.nodes[0]==="undefined"){this.split()}while(D<this.objects.length){C=this.getIndex(this.objects[D]);if(C!==-1){this.nodes[C].insert(this.objects.splice(D,1)[0])}else{D=D+1}}}}};k.prototype.retrieve=function(E){var C=this.getIndex(E),F=this.objects;if(typeof this.nodes[0]!=="undefined"){if(C!==-1){F=F.concat(this.nodes[C].retrieve(E))}else{for(var D=0;D<this.nodes.length;D=D+1){F=F.concat(this.nodes[D].retrieve(E))}}}return F};k.prototype.retrieveFromGroup=function(E,G){var D=[];var F=this.retrieve(E);for(var C=0;C<F.length;C++){if(G.contains(F[C])){D.push(F[C])}}return D};k.prototype.getAll=function(){var D=this.objects;for(var C=0;C<this.nodes.length;C=C+1){D=D.concat(this.nodes[C].getAll())}return D};k.prototype.getObjectNode=function(E){var C;if(!this.nodes.length){return this}else{C=this.getIndex(E);if(C===-1){return this}else{var D=this.nodes[C].getObjectNode(E);if(D){return D}}}return false};k.prototype.removeObject=function(E){var D=this.getObjectNode(E),C=D.objects.indexOf(E);if(C===-1){return false}D.objects.splice(C,1)};k.prototype.clear=function(){this.objects=[];if(!this.nodes.length){return}for(var C=0;C<this.nodes.length;C=C+1){this.nodes[C].clear()}this.nodes=[]};k.prototype.cleanup=function(){var D=this.getAll();this.clear();for(var C=0;C<D.length;C++){this.insert(D[C])}};function t(){if(this.quadTree.active){this.quadTree.updateBounds();this.quadTree.cleanup()}}B.prototype.registerMethod("pre",B.prototype.readPresses);B.prototype.registerMethod("pre",B.prototype.updateSprites);B.prototype.registerMethod("post",t);B.prototype.registerMethod("pre",j);B.prototype.registerMethod("post",u);B.prototype.registerPreloadMethod("loadImageElement",B.prototype);B.prototype._warn=function(D){var C=window.console;if(C){if("function"===typeof C.warn){C.warn(D)}else{if("function"===typeof C.log){C.log("Warning: "+D)}}}};B.CollisionShape=function(C,D){this._localTransform=new B.Transform2D();if(D){this._localTransform.rotate(D)}if(C){this._localTransform.translate(C)}this._parentTransform=new B.Transform2D();this._center=new B.Vector();this._offset=new B.Vector();this._rotation=0;this._scale=new B.Vector(1,1);this.getsDimensionsFromSprite=false;Object.defineProperties(this,{center:{enumerable:true,get:function(){return this._center.copy()}.bind(this),set:function(E){this._localTransform.translate(B.Vector.mult(this._center,-1)).translate(E);this._onTransformChanged()}.bind(this)},offset:{enumerable:true,get:function(){return this._offset.copy()}.bind(this),set:function(E){this._localTransform.translate(B.Vector.mult(this._offset,-1)).translate(E);this._onTransformChanged()}.bind(this)},rotation:{enumerable:true,get:function(){return this._rotation}.bind(this),set:function(E){this._localTransform.clear().scale(this._scale).rotate(E).translate(this._offset);this._onTransformChanged()}.bind(this)},scale:{enumerable:true,get:function(){return this._scale.copy()}.bind(this),set:function(E){this._localTransform.clear().scale(E).rotate(this._rotation).translate(this._offset);this._onTransformChanged()}.bind(this)}});this._onTransformChanged()};B.CollisionShape.prototype.updateFromSprite=function(C){this.setParentTransform(C)};B.CollisionShape.prototype.setParentTransform=function(C){if(C instanceof l){this._parentTransform.clear().scale(C._getScaleX(),C._getScaleY()).rotate(A(C.rotation)).translate(C.position)}else{if(C instanceof B.Transform2D){this._parentTransform=C.copy()}else{throw new TypeError("Bad argument to setParentTransform: "+C)}}this._onTransformChanged()};B.CollisionShape.prototype._onTransformChanged=function(){this._rotation=this._localTransform.getRotation();this._scale=this._localTransform.getScale();this._offset.set(0,0).transform(this._localTransform);this._center.set(this._offset.x,this._offset.y).transform(this._parentTransform)};B.CollisionShape.prototype.collide=function(K){var J=this,P=K;var N=Infinity;var C=null;var I=B.Vector.sub(P.center,J.center);var O=B.CollisionShape._getCandidateAxesForShapes(J,P);var F,M,G;for(var H=0;H<O.length;H++){F=O[H];M=B.Vector.project(I,F);G=M.mag();var E=J._getRadiusOnAxis(F);var D=P._getRadiusOnAxis(F);var L=E+D-G;if(L<=0){return new B.Vector()}else{if(L<N){N=L;if(M.x===0&&M.y===0){C=F}else{C=M}}}}return C.copy().setMag(-N)};B.CollisionShape.prototype.overlap=function(C){var D=this.collide(C);return D.x!==0||D.y!==0};B.CollisionShape._getCandidateAxesForShapes=function(D,C){var E=D._getCandidateAxes(C).concat(C._getCandidateAxes(D)).map(function(F){if(F.x===0&&F.y===0){return B.CollisionShape.X_AXIS}return F});return b(E)};function b(C){return C.filter(function(E,D){return !C.some(function(F,G){return D<G&&E.isParallel(F)})})}B.CollisionShape.prototype._getCandidateAxes=function(){return[]};B.CollisionShape.prototype._getRadiusOnAxis=function(){return 0};B.CollisionShape.prototype._getMinRadius=function(){return 0};B.CollisionShape.X_AXIS=new B.Vector(1,0);B.CollisionShape.Y_AXIS=new B.Vector(0,1);B.CollisionShape.WORLD_AXES=[B.CollisionShape.X_AXIS,B.CollisionShape.Y_AXIS];B.CollisionShape.prototype.getBoundingBox=function(){var D=this._getRadiusOnAxis(B.CollisionShape.X_AXIS);var C=this._getRadiusOnAxis(B.CollisionShape.Y_AXIS);return{top:this.center.y-C,bottom:this.center.y+C,left:this.center.x-D,right:this.center.x+D,width:D*2,height:C*2}};B.PointCollider=function(C){B.CollisionShape.call(this,C)};B.PointCollider.prototype=Object.create(B.CollisionShape.prototype);B.PointCollider.createFromSprite=function(D,E){var C=new B.PointCollider(E);C.setParentTransform(D);return C};B.PointCollider.prototype.draw=function(C){C.push();C.rectMode(C.CENTER);C.translate(this.center.x,this.center.y);C.noStroke();C.fill(0,255,0);C.ellipse(0,0,2,2);C.pop()};B.CircleCollider=function(D,C){B.CollisionShape.call(this,D);this.radius=C;this._scaledRadius=0;this._computeScaledRadius()};B.CircleCollider.prototype=Object.create(B.CollisionShape.prototype);B.CircleCollider.createFromSprite=function(E,G,C){var F=typeof C==="number";var D=new B.CircleCollider(G,F?C:1);D.getsDimensionsFromSprite=!F;D.updateFromSprite(E);return D};B.CircleCollider.prototype.updateFromSprite=function(C){if(this.getsDimensionsFromSprite){if(C.animation){this.radius=Math.max(C.animation.getWidth(),C.animation.getHeight())/2}else{this.radius=Math.max(C.width,C.height)/2}}this.setParentTransform(C)};B.CircleCollider.prototype._onTransformChanged=function(){B.CollisionShape.prototype._onTransformChanged.call(this);this._computeScaledRadius()};B.CircleCollider.prototype._computeScaledRadius=function(){this._scaledRadius=new B.Vector(this.radius,0).transform(this._localTransform).transform(this._parentTransform).sub(this.center).mag()};B.CircleCollider.prototype.draw=function(C){C.push();C.noFill();C.stroke(0,255,0);C.rectMode(C.CENTER);C.ellipse(this.center.x,this.center.y,this._scaledRadius*2,this._scaledRadius*2);C.pop()};B.CircleCollider.prototype.setParentTransform=function(C){if(C instanceof l){this._parentTransform.clear().scale(Math.max(C._getScaleX(),C._getScaleY())).rotate(A(C.rotation)).translate(C.position)}else{if(C instanceof B.Transform2D){this._parentTransform=C.copy()}else{throw new TypeError("Bad argument to setParentTransform: "+C)}}this._onTransformChanged()};B.CircleCollider.prototype._getCandidateAxes=function(D){if(D instanceof B.OrientedBoundingBoxCollider||D instanceof B.AxisAlignedBoundingBoxCollider){var E=Infinity;var C=null;var F=D.halfDiagonals;[B.Vector.add(D.center,F[0]),B.Vector.add(D.center,F[1]),B.Vector.sub(D.center,F[0]),B.Vector.sub(D.center,F[1])].map(function(G){return G.sub(this.center)}.bind(this)).forEach(function(G){var H=G.magSq();if(H<E){E=H;C=G}});return[C]}return[B.Vector.sub(D.center,this.center)]};B.CircleCollider.prototype._getRadiusOnAxis=function(){return this._scaledRadius};B.CircleCollider.prototype._getMinRadius=function(){return this._scaledRadius};B.AxisAlignedBoundingBoxCollider=function(D,E,C){B.CollisionShape.call(this,D);this._width=E;this._height=C;this._halfDiagonals=[];Object.defineProperties(this,{width:{enumerable:true,get:function(){return this._width}.bind(this),set:function(F){this._width=F;this._halfDiagonals=this._computeHalfDiagonals()}.bind(this)},height:{enumerable:true,get:function(){return this._height}.bind(this),set:function(F){this._height=F;this._halfDiagonals=this._computeHalfDiagonals()}.bind(this)},halfDiagonals:{enumerable:true,get:function(){return this._halfDiagonals}.bind(this)}});this._computeHalfDiagonals()};B.AxisAlignedBoundingBoxCollider.prototype=Object.create(B.CollisionShape.prototype);B.AxisAlignedBoundingBoxCollider.createFromSprite=function(D,H,E,C){var G=typeof E==="number"&&typeof C==="number";var F=new B.AxisAlignedBoundingBoxCollider(H,G?E:1,G?C:1);F.getsDimensionsFromSprite=!G;F.updateFromSprite(D);return F};B.AxisAlignedBoundingBoxCollider.prototype.updateFromSprite=function(C){if(this.getsDimensionsFromSprite){if(C.animation){this._width=C.animation.getWidth();this._height=C.animation.getHeight()}else{this._width=C.width;this._height=C.height}}this.setParentTransform(C)};B.AxisAlignedBoundingBoxCollider.prototype._onTransformChanged=function(){B.CollisionShape.prototype._onTransformChanged.call(this);this._computeHalfDiagonals()};B.AxisAlignedBoundingBoxCollider.prototype._computeHalfDiagonals=function(){var D=B.Transform2D.mult(this._parentTransform,this._localTransform);var E=[new B.Vector(this._width/2,-this._height/2),new B.Vector(this._width/2,this._height/2),new B.Vector(-this._width/2,this._height/2)].map(function(G){return G.transform(D).sub(this.center)}.bind(this));var F=Math.max(Math.abs(E[0].x),Math.abs(E[1].x));var C=Math.max(Math.abs(E[1].y),Math.abs(E[2].y));this._halfDiagonals=[new B.Vector(F,-C),new B.Vector(F,C)]};B.AxisAlignedBoundingBoxCollider.prototype.draw=function(C){C.push();C.rectMode(C.CENTER);C.translate(this.center.x,this.center.y);C.noFill();C.stroke(0,255,0);C.strokeWeight(1);C.rect(0,0,Math.abs(this._halfDiagonals[0].x)*2,Math.abs(this._halfDiagonals[0].y)*2);C.pop()};B.AxisAlignedBoundingBoxCollider.prototype._getCandidateAxes=function(){return B.CollisionShape.WORLD_AXES};B.AxisAlignedBoundingBoxCollider.prototype._getRadiusOnAxis=function(C){return Math.max(B.Vector.project(this._halfDiagonals[0],C).mag(),B.Vector.project(this._halfDiagonals[1],C).mag())};B.AxisAlignedBoundingBoxCollider.prototype._getMinRadius=function(){return Math.min(this._width,this._height)};B.OrientedBoundingBoxCollider=function(D,F,C,E){B.CollisionShape.call(this,D,E);this._width=F;this._height=C;this._potentialAxes=[];this._halfDiagonals=[];Object.defineProperties(this,{width:{enumerable:true,get:function(){return this._width}.bind(this),set:function(G){this._width=G;this._onTransformChanged()}.bind(this)},height:{enumerable:true,get:function(){return this._height}.bind(this),set:function(G){this._height=G;this._onTransformChanged()}.bind(this)},halfDiagonals:{enumerable:true,get:function(){return this._halfDiagonals}.bind(this)}});this._onTransformChanged()};B.OrientedBoundingBoxCollider.prototype=Object.create(B.CollisionShape.prototype);B.OrientedBoundingBoxCollider.createFromSprite=function(E,I,F,C,D){var H=typeof F==="number"&&typeof C==="number";var G=new B.OrientedBoundingBoxCollider(I,H?F:1,H?C:1,D);G.getsDimensionsFromSprite=!H;G.updateFromSprite(E);return G};B.OrientedBoundingBoxCollider.prototype.updateFromSprite=B.AxisAlignedBoundingBoxCollider.prototype.updateFromSprite;B.OrientedBoundingBoxCollider.prototype.updateSweptColliderFromSprite=function(E){var D=E.velocity.mag();var F=new B.Vector(E.velocity.y,-E.velocity.x);this._width=D+2*E.collider._getRadiusOnAxis(E.velocity);this._height=2*E.collider._getRadiusOnAxis(F);var G=A(E.getDirection());var C=new B.Vector(E.newPosition.x+0.5*E.velocity.x,E.newPosition.y+0.5*E.velocity.y);this._localTransform.clear().scale(this._scale).rotate(G).translate(this._offset).translate(B.Vector.mult(this._center,-1)).translate(C);this._onTransformChanged()};B.OrientedBoundingBoxCollider.prototype._onTransformChanged=function(){B.CollisionShape.prototype._onTransformChanged.call(this);var C=B.Transform2D.mult(this._parentTransform,this._localTransform);var D=[new B.Vector(this._width/2,-this._height/2),new B.Vector(this._width/2,this._height/2),new B.Vector(-this._width/2,this._height/2)].map(function(E){return E.transform(C)});this._halfDiagonals=[B.Vector.sub(D[0],this.center),B.Vector.sub(D[1],this.center)];this._potentialAxes=[B.Vector.sub(D[1],D[2]),B.Vector.sub(D[1],D[0])]};B.OrientedBoundingBoxCollider.prototype.draw=function(F){var C=B.Transform2D.mult(this._localTransform,this._parentTransform);var E=C.getScale();var D=C.getRotation();F.push();F.translate(this.center.x,this.center.y);F.scale(E.x,E.y);if(F._angleMode===F.RADIANS){F.rotate(D)}else{F.rotate(r(D))}F.noFill();F.stroke(0,255,0);F.strokeWeight(1);F.rectMode(F.CENTER);F.rect(0,0,this._width,this._height);F.pop()};B.OrientedBoundingBoxCollider.prototype._getCandidateAxes=function(){return this._potentialAxes};B.OrientedBoundingBoxCollider.prototype._getRadiusOnAxis=B.AxisAlignedBoundingBoxCollider.prototype._getRadiusOnAxis;B.OrientedBoundingBoxCollider.prototype._getMinRadius=B.AxisAlignedBoundingBoxCollider.prototype._getMinRadius;B.Transform2D=function(C){C=C||[1,0,0,0,1,0];if(C.length!==6){throw new TypeError("Transform2D must have six components")}this.length=6;this[0]=C[0];this[1]=C[1];this[2]=C[2];this[3]=C[3];this[4]=C[4];this[5]=C[5]};B.Transform2D.prototype=Object.create(Array.prototype);B.Transform2D.prototype.clear=function(){this[0]=1;this[1]=0;this[2]=0;this[3]=0;this[4]=1;this[5]=0;return this};B.Transform2D.prototype.copy=function(){return new B.Transform2D(this)};B.Transform2D.prototype.equals=function(C){if(!(C instanceof B.Transform2D||Array.isArray(C))){return false}for(var D=0;D<6;D++){if(this[D]!==C[D]){return false}}return true};B.Transform2D.mult=function(P,O,Q){Q=Q||new B.Transform2D();var I,G,F,E,D,C;I=P[0];G=P[1];F=P[2];E=P[3];D=P[4];C=P[5];var N,M,L,K,J,H;N=O[0];M=O[1];L=O[2];K=O[3];J=O[4];H=O[5];Q[0]=I*N+G*K;Q[1]=I*M+G*J;Q[2]=I*L+G*H+F;Q[3]=E*N+D*K;Q[4]=E*M+D*J;Q[5]=E*L+D*H+C;return Q};B.Transform2D.prototype.mult=function(C){return B.Transform2D.mult(this,C,this)};B.Transform2D.prototype.translate=function(G,E){var C,H;if(G instanceof B.Vector){C=G.x;H=G.y}else{if(typeof G==="number"&&typeof E==="number"){C=G;H=E}else{var D="";for(var F=0;F<arguments.length;F++){D+=arguments[F]+", "}throw new TypeError("Invalid arguments to Transform2D.translate: "+D)}}return B.Transform2D.mult([1,0,C,0,1,H],this,this)};B.Transform2D.prototype.getTranslation=function(){return new B.Vector(this[2],this[5])};B.Transform2D.prototype.scale=function(D,C){var F,E;if(D instanceof B.Vector){F=D.x;E=D.y}else{if(typeof D==="number"&&typeof C==="number"){F=D;E=C}else{if(typeof D==="number"){F=D;E=D}else{throw new TypeError("Invalid arguments to Transform2D.scale: "+arguments)}}}return B.Transform2D.mult([F,0,0,0,E,0],this,this)};B.Transform2D.prototype.getScale=function(){var D=this[0],C=this[1],F=this[3],E=this[4];return new B.Vector(x(D)*Math.sqrt(D*D+C*C),x(E)*Math.sqrt(F*F+E*E))};function x(C){C=+C;if(C===0||isNaN(C)){return Number(C)}return C>0?1:-1}B.Transform2D.prototype.rotate=function(D){if(typeof D!=="number"){throw new TypeError("Invalid arguments to Transform2D.rotate: "+arguments)}var E=Math.sin(D);var C=Math.cos(D);return B.Transform2D.mult([C,-E,0,E,C,0],this,this)};B.Transform2D.prototype.getRotation=function(){return Math.atan2(-this[1],this[0])};B.Vector.transform=function(C,D){return C.copy().transform(D)};B.Vector.prototype.transform=function(D){var C=this.x;var E=this.y;this.x=D[0]*C+D[1]*E+D[2];this.y=D[3]*C+D[4]*E+D[5];return this}}));